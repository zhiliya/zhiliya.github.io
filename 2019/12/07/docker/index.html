<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=2">
<meta name="theme-color" content="#222">
<meta name="generator" content="Hexo 4.2.0">
  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png">
  <link rel="mask-icon" href="/images/logo.svg" color="#222">
  <link rel="alternate" href="/atom.xml" title="zhiliya" type="application/atom+xml">

<link rel="stylesheet" href="/css/main.css">


<link rel="stylesheet" href="/lib/font-awesome/css/font-awesome.min.css">


<script id="hexo-configurations">
  var NexT = window.NexT || {};
  var CONFIG = {
    root: '/',
    scheme: 'Muse',
    version: '7.5.0',
    exturl: false,
    sidebar: {"position":"left","display":"post","offset":12,"onmobile":false},
    copycode: {"enable":false,"show_result":false,"style":null},
    back2top: {"enable":true,"sidebar":false,"scrollpercent":false},
    bookmark: {"enable":false,"color":"#222","save":"auto"},
    fancybox: false,
    mediumzoom: false,
    lazyload: false,
    pangu: false,
    algolia: {
      appID: '',
      apiKey: '',
      indexName: '',
      hits: {"per_page":10},
      labels: {"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}
    },
    localsearch: {"enable":false,"trigger":"auto","top_n_per_article":1,"unescape":false,"preload":false},
    path: '',
    motion: {"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}},
    translation: {
      copy_button: '复制',
      copy_success: '复制成功',
      copy_failure: '复制失败'
    },
    sidebarPadding: 40
  };
</script>

  <meta name="description" content="netstat  -anp  |grep   端netstat   -nultp 1234567891011121314151617docker run -itd centos &#x2F;bin&#x2F;bashdocker exec  -it centos env LANG&#x3D;C.UTF-8   bash安装net-toolsnetstat -nriptables -t nat –v">
<meta property="og:type" content="article">
<meta property="og:title" content="docker">
<meta property="og:url" content="http://yoursite.com/2019/12/07/docker/index.html">
<meta property="og:site_name" content="zhiliya">
<meta property="og:description" content="netstat  -anp  |grep   端netstat   -nultp 1234567891011121314151617docker run -itd centos &#x2F;bin&#x2F;bashdocker exec  -it centos env LANG&#x3D;C.UTF-8   bash安装net-toolsnetstat -nriptables -t nat –v">
<meta property="og:locale" content="zh_CN">
<meta property="article:published_time" content="2019-12-07T08:32:21.000Z">
<meta property="article:modified_time" content="2020-07-31T08:34:30.432Z">
<meta property="article:author" content="zhiliya">
<meta name="twitter:card" content="summary">

<link rel="canonical" href="http://yoursite.com/2019/12/07/docker/">


<script id="page-configurations">
  // https://hexo.io/docs/variables.html
  CONFIG.page = {
    sidebar: "",
    isHome: false,
    isPost: true,
    isPage: false,
    isArchive: false
  };
</script>

  <title>docker | zhiliya</title>
  






  <noscript>
  <style>
  .use-motion .brand,
  .use-motion .menu-item,
  .sidebar-inner,
  .use-motion .post-block,
  .use-motion .pagination,
  .use-motion .comments,
  .use-motion .post-header,
  .use-motion .post-body,
  .use-motion .collection-header { opacity: initial; }

  .use-motion .site-title,
  .use-motion .site-subtitle {
    opacity: initial;
    top: initial;
  }

  .use-motion .logo-line-before i { left: initial; }
  .use-motion .logo-line-after i { right: initial; }
  </style>
</noscript>

</head>

<body itemscope itemtype="http://schema.org/WebPage">
  <div class="container use-motion">
    <div class="headband"></div>

    <header class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-container">
  <div class="site-meta">

    <div>
      <a href="/" class="brand" rel="start">
        <span class="logo-line-before"><i></i></span>
        <span class="site-title">zhiliya</span>
        <span class="logo-line-after"><i></i></span>
      </a>
    </div>
        <p class="site-subtitle">欢迎访问我的博客</p>
  </div>

  <div class="site-nav-toggle">
    <div class="toggle" aria-label="切换导航栏">
      <span class="toggle-line toggle-line-first"></span>
      <span class="toggle-line toggle-line-middle"></span>
      <span class="toggle-line toggle-line-last"></span>
    </div>
  </div>
</div>


<nav class="site-nav">
  
  <ul id="menu" class="menu">
        <li class="menu-item menu-item-home">

    <a href="/" rel="section"><i class="fa fa-fw fa-home"></i>首页</a>

  </li>
        <li class="menu-item menu-item-archives">

    <a href="/archives/" rel="section"><i class="fa fa-fw fa-archive"></i>归档</a>

  </li>
  </ul>

</nav>
</div>
    </header>

    
  <div class="back-to-top">
    <i class="fa fa-arrow-up"></i>
    <span>0%</span>
  </div>


    <main class="main">
      <div class="main-inner">
        <div class="content-wrap">
          

          <div class="content">
            

  <div class="posts-expand">
      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block " lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2019/12/07/docker/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="zhiliya">
      <meta itemprop="description" content="emmmm 感觉没啥好说的">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="zhiliya">
    </span>
      <header class="post-header">
        <h1 class="post-title" itemprop="name headline">
          docker
        </h1>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2019-12-07 16:32:21" itemprop="dateCreated datePublished" datetime="2019-12-07T16:32:21+08:00">2019-12-07</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="fa fa-calendar-check-o"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2020-07-31 16:34:30" itemprop="dateModified" datetime="2020-07-31T16:34:30+08:00">2020-07-31</time>
              </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
        <p>netstat  -anp  |grep   端<br>netstat   -nultp</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">docker run -itd centos &#x2F;bin&#x2F;bash</span><br><span class="line">docker exec  -it centos env LANG&#x3D;C.UTF-8   bash</span><br><span class="line">安装net-tools</span><br><span class="line">netstat -nr</span><br><span class="line">iptables -t nat –vnL  没用</span><br><span class="line">yum update &amp;&amp; yum install wget -y</span><br><span class="line">wget http:&#x2F;&#x2F;soft.vpser.net&#x2F;lnmp&#x2F;lnmp1.6.tar.gz -cO lnmp1.6.tar.gz &amp;&amp; tar zxf lnmp1.6.tar.gz &amp;&amp; cd lnmp1.6 &amp;&amp; .&#x2F;install.sh lnmp</span><br><span class="line">docker commit -m &quot;centos_lnmp&quot; -a &quot;zhiliya&quot;   xxx lnmp:1.0</span><br><span class="line">docker tag 6ce4aedd12cd wangshibo&#x2F;myubuntu:v1</span><br><span class="line">docker push wangshibo&#x2F;myubuntu:v1</span><br><span class="line">docker load --input k.tar</span><br><span class="line">docker save -o bachang.tar bachang:1.0 </span><br><span class="line"></span><br><span class="line"># 设置lnmp:1.0镜像创建的容器</span><br><span class="line"># 容器80端口映射到宿主7777端口</span><br><span class="line"># 宿主的目录&#x2F;Users&#x2F;sunsheng&#x2F;www&#x2F;wwwroot映射到容器目录&#x2F;home&#x2F;www&#x2F;wwwroot </span><br><span class="line">docker run -dit -p 80:7777 -v &#x2F;root&#x2F;Desktop&#x2F;www:&#x2F;root&#x2F;Desktop&#x2F;www lnmp:1.0 &#x2F;bin&#x2F;bash</span><br></pre></td></tr></table></figure>

<h4 id="redis"><a href="#redis" class="headerlink" title="redis"></a>redis</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">wget http:&#x2F;&#x2F;download.redis.io&#x2F;releases&#x2F;redis-4.0.6.tar.gz</span><br><span class="line">tar -zxvf redis-4.0.6.tar.gz</span><br><span class="line"> cd redis-4.0.6</span><br><span class="line">make MALLOC&#x3D;libc　　</span><br><span class="line">cd src &amp;&amp; make install</span><br></pre></td></tr></table></figure>





<p>$ sudo pip install gunicorn<br>$ sudo gunicorn –bind 0.0.0.0:8000 -w 1 “CTFd:create_app()”</p>
<p>这里我复现的题目是SUSCTF 2018的题目，下面是github地址<br><a href="https://github.com/susers/Writeups/" target="_blank" rel="noopener">https://github.com/susers/Writeups/</a><br>docker build -t=镜像名字 .<br>docker run –name=容器名字 -p 9999:22  -d 镜像名 </p>
<p>docker run -d -p 4003:80  ctftraining/ciscn_2019_northern_china_day1_web1   –name=</p>
<p>docker run -d -p 100:80 -p 3307:3306 tutum/lamp   </p>
<p>docker-compose.yml只要输入以下两条命令即可:</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">docker-compose build</span><br><span class="line">docker-compose up -d</span><br></pre></td></tr></table></figure>

<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker run -i -d -P --restart unless-stopped  --name&#x3D;HITCON_CTF_2017-BabyFirst_Revenge  lamp:1.0</span><br></pre></td></tr></table></figure>

<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"> docker run -dit   -P   --restart unless-stopped  --name&#x3D;minlingzhixing1  lamp:1.0  &#x2F;bin&#x2F;bash </span><br><span class="line">  docker container rename tender_swanson md5</span><br><span class="line"> docker exec -it d9b76bff6551  &#x2F;bin&#x2F;bash </span><br><span class="line">docker cp robots.php   c08682b7bde9:&#x2F;var&#x2F;www&#x2F;html&#x2F;</span><br></pre></td></tr></table></figure>





<p>git clone <a href="https://github.com/CTFTraining/https://github.com/CTFTraining/ciscn_2019_web_northern_china_day1_web1.git" target="_blank" rel="noopener">https://github.com/CTFTraining/https://github.com/CTFTraining/ciscn_2019_web_northern_china_day1_web1.git</a><br>docker-compose up -d<br>open <a href="http://127.0.0.1:8302/" target="_blank" rel="noopener">http://127.0.0.1:8302/</a></p>
<p>docker-compose up<br>CTFd 将在http：//localhost：8000 上运行。</p>
<p>然后使用以下命令启动 Flask 调试服务器：<br>python serve.py<br>CTFd 现在将在http：//localhost：4000 上运行。</p>
<p>容器可以被创建、启动、停止、删除、暂停<br>{<br>  “registry-mirrors”: [“<a href="https://docker.mirrors.ustc.edu.cn/&quot;,&quot;http://4e70ba5d.m.daocloud.io&quot;]" target="_blank" rel="noopener">https://docker.mirrors.ustc.edu.cn/&quot;,&quot;http://4e70ba5d.m.daocloud.io&quot;]</a><br>}</p>
<p>docker images　　　　　　　　　　　　　　#查看本地已有镜像<br>docker run -i -t httpd /bin/bash　　#运行容器并进入<br>docker run -d -p 80:8080 httpd     #后台运行容器，容器8080端口映射到主机80端口<br>docker run -it -p 23946:23946 ubuntu/17.04.amd64 /bin/bash<br>docker exec -it [container-id] /bin/bash   #进入已有容器<br>docker exec -it [container-id] /bin/bash   #进入已有容器<br>docker exec -it 1b1394e77de7  /bin/bash<br>docker ps -a　　　　　　　　　　　　　　　#查看当前正在运行的镜像</p>
<p>docker start运行对应容器<br>docker stop httpd　　　#关闭容器<br>docker rm 05f5afa34243  删除容器<br>docker rmi 67fa590cfc1c  删除镜像</p>
<p>docker container rename nostalgic_raman ubuntu.17.04.amd64  重命名<br>docker container cp linux_server udocker commit buntu.17.04.i386:/root/linux_server<br>docker container cp linux_server ubuntu.17.04.i386:/root/linux_server<br>docker cp sqli1/ 96630df2cbdf:/var/www/html/<br>container ls  显示对应容器 docker container ls -a</p>
<p>docker search  centos:7  搜索镜像<br>docker pull centos:latest</p>
<p>docker commit +容器id +要生成的镜像名字 把容器转换成镜像</p>
<p>docker system df 查看镜像、容器、数据卷所占用的空间。</p>
<h4 id="screen"><a href="#screen" class="headerlink" title="screen"></a>screen</h4><p>screen -ls<br>screen -r 10992　　//重新建立会话<br>screen -S [会话名称]　　指定建立会话的名称<br>screen -r [会话ID|会话名称]　　回到指定会话，可以是会话名称，也可以是会话ID</p>
<h4 id="时差"><a href="#时差" class="headerlink" title="时差"></a>时差</h4><p>docker exec -it f83573b2a54b  env LANG=C.UTF-8 /bin/bash1<br>如果此时想设置成北京的时间的话，有两种解决方案，第一个是修改容器时区</p>
<p><strong>CentOS</strong></p>
<p>RUN echo “Asia/shanghai” &gt; /etc/timezone;</p>
<p><strong>Ubuntu</strong></p>
<p>RUN cp /usr/share/zoneinfo/Asia/Shanghai /etc/localtime<br>第二种方案，更简单，直接把宿主机的时间设置挂载到容器里面，通过docker run -v的方式直接挂载<br>-v /etc/localtime:/etc/localtime:ro 1<br>这种方案需要注意/etc/timezone内容，因为代码中会用到这个设置，也要改成上海时区。最后测试一下，两种方案都是可行的。</p>
<h4 id="docker-for-windows"><a href="#docker-for-windows" class="headerlink" title="docker for windows"></a>docker for windows</h4><p>另外，如果想要关闭Hyper-v来使用vmware之类的虚拟机的话，需要在之前勾选Hyper-v处取消勾选，并以管理员方式打开powershell输入<br>bcdedit /set hypervisorlaunchtype off<br>之后重启即可正常使用其他虚拟软件。<br>重新开启hyper-v需要重新勾选之前取消的Hyper-v选项，然后以管理员方式打开powershell输入<br>bcdedit /set hypervisorlaunchtype auto</p>
<p>（System has not been booted with systemd as init system (PID 1). Can’t operat）</p>
<p>解决方案：/sbin/init</p>
<p>例如：Ubuntu 18.04 ，</p>
<p>docker run -tid –name test –privileged=true ubuntu:18.04 /sbin/init<br>docker exec -it lnmp env LANG=C.UTF-8   /bin/bash</p>
<p>docker run –rm -v <code>pwd</code>/fonts:/usr/share/fonts \</p>
<p>​        -v <code>pwd</code>/output:/app/output \</p>
<p>​        gitbook   “<a href="http://self-publishing.ebookchain.org&quot;" target="_blank" rel="noopener">http://self-publishing.ebookchain.org&quot;</a></p>
<p>如果你觉得上面这条命令太过复杂，更喜欢使用 <code>docker-compose</code> 来简化操作，可以使用下面的配置：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">version: &#39;2&#39;</span><br><span class="line"></span><br><span class="line">services:</span><br><span class="line"></span><br><span class="line">  pdf-generator:</span><br><span class="line">    image: soulteary&#x2F;docker-gitbook-pdf-generator</span><br><span class="line">    volumes:</span><br><span class="line">      - .&#x2F;output:&#x2F;root&#x2F;Desktop&#x2F;output:rw</span><br><span class="line">      - .&#x2F;fonts&#x2F;:&#x2F;root&#x2F;Desktop&#x2F;fonts:ro</span><br><span class="line">    # 下面的URL替换为你想生成电子书的地址即可</span><br><span class="line">    command: &quot;http:&#x2F;&#x2F;www.0-sec.org&#x2F;&quot;</span><br></pre></td></tr></table></figure>

<p>将上面的内容保存为 <code>docker-compose.yml</code>，然后执行 <code>docker-compose up</code> 等待电子书生成完毕即可。</p>
<h1 id="0x02-基本指令"><a href="#0x02-基本指令" class="headerlink" title="0x02 基本指令"></a>0x02 基本指令</h1><p>参数：<br> –name  指定容器的名字<br> –rm      容器运行完毕会自动删除<br> -i -t       创建一个提供交互式shell的容器。<br> -d         在后台运行容器，并且打印出容器的ID。<br> -v        目录挂载 前面的是主机后面的是容器<br> –privileged 拥有真正的root权限<br> 后面加的是容器刚生成是运行的程序默认是/bin/bash</p>
<h2 id="0x1-容器生成"><a href="#0x1-容器生成" class="headerlink" title="0x1 容器生成"></a>0x1 容器生成</h2><p><code>docker run --name  weblogic -i -t centos</code><br> 上述命令会生成一个名字为weblogic 的交互式容器，默认执行的是/bin/bash，所以会进入交互界面。如果本地没有centos的镜像会从远程下载到本地。</p>
<h2 id="0x2-生成容器时的其他属性"><a href="#0x2-生成容器时的其他属性" class="headerlink" title="0x2 生成容器时的其他属性"></a>0x2 生成容器时的其他属性</h2><p>docker run 命令用于生成容器 ，生成容器的属性之后不能再改变</p>
<h3 id="端口映射"><a href="#端口映射" class="headerlink" title="端口映射"></a>端口映射</h3><p>一般拥有web服务的容器都进行端口映射，将docker的80端口映射到主机的8000端口<br> <code>docker run -d -p 8000:80  foo/live /bin/bash</code></p>
<h3 id="环境变量"><a href="#环境变量" class="headerlink" title="环境变量"></a>环境变量</h3><p>在配置mysql  docker的时候使用-e参数设置环境变量<br> <code>docker run --name first-mysql -p 3306:3306 -e MYSQL\_ROOT\_PASSWORD=123456 -d mysql</code></p>
<h2 id="0x3-打开-关闭-附加-删除"><a href="#0x3-打开-关闭-附加-删除" class="headerlink" title="0x3 打开/关闭/附加/删除"></a>0x3 打开/关闭/附加/删除</h2><p><code>docker  start  id  使上述生成的容器启动</code><br> <code>docker  stop id  使上述生成的容器关闭</code><br> <code>docker exec -it id  /bin/bash  附加正在运行的容器</code><br> <code>docker attach continer id/name</code><br> 当重新启动容器时，会沿用创建容器（docker run）命令时指定的参数来运行，可能需要按回车才进入。<br> 这时就已经相当于在容器内部了的shell操作了。如果操作过程中，退出了shell。容器也会随之停止。</p>
<p>exec与attach的区别是当exit容器的时候exec不停止容器，而attach会将容器停止</p>
<hr>
<p>删除时必须保证容器时关闭的<br> <code>docker  rm name/id 删除指定容器</code><br> 删除所有镜像<br> <code>docker rmi $(docker images -q)1</code><br> 根据格式删除所有镜像<br> <code>docker rm $(docker ps -qf status=exited)</code></p>
<h2 id="0x4-压缩-导出-上传"><a href="#0x4-压缩-导出-上传" class="headerlink" title="0x4 压缩/导出/上传"></a>0x4 压缩/导出/上传</h2><p>我们用镜像生成了容器，然后我们可以将容器生成镜像，然后将镜像打成压缩包方便导入导出，同时也可以把镜像上传至dockerhub，供别人下载使用</p>
<h3 id="压缩-容器"><a href="#压缩-容器" class="headerlink" title="压缩(容器)"></a>压缩(容器)</h3><p>我们使用容器 furious_bell，现在要将这个容器保存为一个文件 myunbuntu-export-1204.tar<br> <code>docker export furious_bell &gt; /home/myubuntu-export-1204.tar</code></p>
<h3 id="导入"><a href="#导入" class="headerlink" title="导入"></a>导入</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker import  &#x2F;home&#x2F;myubuntu-export-1204.tar  alias</span><br></pre></td></tr></table></figure>

<h3 id="压缩（镜像）"><a href="#压缩（镜像）" class="headerlink" title="压缩（镜像）"></a>压缩（镜像）</h3><p>这里有个基础镜像：ubuntu:12.04，现在要将这个镜像保存为一个文件myubuntu-save-1204.tar<br> <code>docker save 9610cfc68e8d &gt; /home/myubuntu-save-1204.tar</code><br> 有点慢，稍微等待一下，没有任何warn信息就表示保存OK。9610cfc68e8d 是镜像ID</p>
<h3 id="导入-1"><a href="#导入-1" class="headerlink" title="导入"></a>导入</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker load &#x2F;home&#x2F;myubuntu-export-1204.tar  alias</span><br></pre></td></tr></table></figure>

<h3 id="上传至远程仓库"><a href="#上传至远程仓库" class="headerlink" title="上传至远程仓库"></a>上传至远程仓库</h3><p>首先拥有一个dockerhub账号<br> 上传之前要登录<br> <code>docker login</code><br> 然后输入用户名密码</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">docker login&#96; </span><br><span class="line"> &#96;docker tag id username&#x2F;repositoryname:tag&#96; </span><br><span class="line"> &#96;docker push username&#x2F;repositoryname:tag</span><br></pre></td></tr></table></figure>

<p>关于docker file的编写，有时间再补上</p>
<h1 id="0x3-Dockerfile-编写"><a href="#0x3-Dockerfile-编写" class="headerlink" title="0x3 Dockerfile 编写"></a>0x3 Dockerfile 编写</h1><blockquote>
<p>Dockfile是一种被Docker程序解释的脚本，Dockerfile由一条一条的指令组成，每条指令对应Linux下面的一条命令。Docker程序将这些Dockerfile指令翻译真正的Linux命令。Dockerfile有自己书写格式和支持的命令，Docker程序解决这些命令间的依赖关系，类似于Makefile。</p>
</blockquote>
<p>首先给个实例<br> 运行指令<code>docker build -t name .</code></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><span class="line">FROM ubuntu:16.04 </span><br><span class="line"></span><br><span class="line">MAINTAINER 4t10n &lt;act01n@163.com&gt;</span><br><span class="line">ENV DEBIAN_FRONTEND noninteractive </span><br><span class="line">#这里添加更新源 </span><br><span class="line">RUN sed -i &#39;s&#x2F;archive.ubuntu.com&#x2F;mirrors.ustc.edu.cn&#x2F;g&#39; &#x2F;etc&#x2F;apt&#x2F;sources.list</span><br><span class="line"></span><br><span class="line">RUN apt-get update -y &amp;&amp; \ </span><br><span class="line">    apt-get install -y apache2 \</span><br><span class="line">    vim \</span><br><span class="line">    tar \</span><br><span class="line">    php7.0-fpm \</span><br><span class="line">    php7.0-mcrypt \ </span><br><span class="line">    php7.0-mysql  \ </span><br><span class="line">    mysql-client \</span><br><span class="line">    mysql-server   \</span><br><span class="line">    &amp;&amp; &#x2F;etc&#x2F;init.d&#x2F;mysql start \</span><br><span class="line">    &amp;&amp; mysqladmin -uroot password root  \</span><br><span class="line">    &amp;&amp; rm -rf &#x2F;var&#x2F;lib&#x2F;apt&#x2F;lists&#x2F;* </span><br><span class="line"></span><br><span class="line">WORKDIR &#x2F;tmp  </span><br><span class="line">#COPY  .&#x2F;start.sh  &#x2F;tmp&#x2F;</span><br><span class="line">#COPY  .&#x2F;init.sql  &#x2F;tmp&#x2F; </span><br><span class="line">#RUN  chmod a+x start.sh </span><br><span class="line"></span><br><span class="line">#设置数据库 </span><br><span class="line">RUN set -x \</span><br><span class="line">    &amp;&amp; service mysql start \ </span><br><span class="line">    &amp;&amp; mysql  -e &quot;CREATE DATABASE  blog  DEFAULT CHARACTER SET utf8;&quot;  -uroot  -proot \ </span><br><span class="line">    &amp;&amp;  mysql -e &quot;grant select,insert on blog.* to &#39;admin&#39;@&#39;localhost&#39; identified by &#39;password&#39; &quot;  -uroot -proot  </span><br><span class="line"></span><br><span class="line"># copy 源码</span><br><span class="line">#COPY  .&#x2F;default &#x2F;etc&#x2F;nginx&#x2F;sites-available&#x2F;default</span><br><span class="line">#COPY .&#x2F;src &#x2F;usr&#x2F;share&#x2F;nginx&#x2F;html&#x2F;</span><br><span class="line">COPY .&#x2F;1.php &#x2F;var&#x2F;www&#x2F;html&#x2F;</span><br><span class="line"></span><br><span class="line"># 设置可写权限 </span><br><span class="line">RUN chown -R  www-data:www-data &#x2F;var&#x2F;www&#x2F;html&#x2F;</span><br><span class="line">EXPOSE 80 3306 </span><br><span class="line"></span><br><span class="line">CMD [&quot;&#x2F;tmp&#x2F;start.sh&quot;]1234567891011121314151617181920212223242526272829303132333435363738394041</span><br></pre></td></tr></table></figure>

<p>贴上一个环境较为完整的docker镜像的dockerfile</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line">FROM ubuntu:16.04 </span><br><span class="line"></span><br><span class="line">MAINTAINER 4t10n &lt;act01n@163.com&gt;</span><br><span class="line">ENV DEBIAN_FRONTEND noninteractive </span><br><span class="line"></span><br><span class="line">RUN sed -i &#39;s&#x2F;archive.ubuntu.com&#x2F;mirrors.ustc.edu.cn&#x2F;g&#39; &#x2F;etc&#x2F;apt&#x2F;sources.list</span><br><span class="line"></span><br><span class="line">RUN apt-get update -y &amp;&amp; \ </span><br><span class="line">    apt-get install -y software-properties-common  &amp;&amp; \ </span><br><span class="line">    apt-get install -y python-software-properties  &amp;&amp; \ </span><br><span class="line">    add-apt-repository ppa:ondrej&#x2F;php -y &amp;&amp; \</span><br><span class="line">    apt-get update -y &amp;&amp; \ </span><br><span class="line">    apt-get install -y apache2 \</span><br><span class="line">    vim \</span><br><span class="line">    tar \</span><br><span class="line">    php7.0-fpm \</span><br><span class="line">    php7.0-mcrypt \ </span><br><span class="line">    php7.0-mysql  \ </span><br><span class="line">    mysql-client \</span><br><span class="line">    mysql-server   \</span><br><span class="line">    php5.6 \</span><br><span class="line">    php5.6-fpm \</span><br><span class="line">    php5.6-mysql \</span><br><span class="line">    php5.6-mcrypt &amp;&amp; \</span><br><span class="line">    apt-get install -y zsh &amp;&amp; \ </span><br><span class="line">    apt-get install -y git  \</span><br><span class="line">    &amp;&amp; &#x2F;etc&#x2F;init.d&#x2F;mysql start \</span><br><span class="line">    &amp;&amp; sh -c &quot;$(wget https:&#x2F;&#x2F;raw.github.com&#x2F;robbyrussell&#x2F;oh-my-zsh&#x2F;master&#x2F;tools&#x2F;install.sh -O -)&quot; \</span><br><span class="line">    &amp;&amp; mysqladmin -uroot password root  </span><br><span class="line"></span><br><span class="line">12345678910111213141516171819202122232425262728293031</span><br></pre></td></tr></table></figure>

<h2 id="0x1-FROM"><a href="#0x1-FROM" class="headerlink" title="0x1 FROM"></a>0x1 FROM</h2><p>FROM指定一个基础镜像， 一般情况下一个可用的 Dockerfile一定是 FROM 为第一个指令。</p>
<h2 id="0x2-MAINTAINER"><a href="#0x2-MAINTAINER" class="headerlink" title="0x2 MAINTAINER"></a>0x2 MAINTAINER</h2><p>这里是用于指定镜像制作者的信息</p>
<h2 id="0x3-RUN"><a href="#0x3-RUN" class="headerlink" title="0x3 RUN"></a>0x3 RUN</h2><p>RUN命令将在当前image中执行任意合法命令并提交执行结果。命令执行提交后，就会自动执行Dockerfile中的下一个指令。<br> 层级 RUN 指令和生成提交是符合Docker核心理念的做法。它允许像版本控制那样，在任意一个点，对image 镜像进行定制化构建。</p>
<h2 id="0x4-ENV"><a href="#0x4-ENV" class="headerlink" title="0x4 ENV"></a>0x4 ENV</h2><p>ENV指令可以用于为docker容器设置环境变量<br> ENV设置的环境变量，可以使用 docker inspect命令来查看。同时还可以使用docker run –env =来修改环境变量。</p>
<h2 id="0x5-WORKDIR"><a href="#0x5-WORKDIR" class="headerlink" title="0x5 WORKDIR"></a>0x5 WORKDIR</h2><p>WORKDIR 用来切换工作目录的。Docker 默认的工作目录是/，只有 RUN 能执行 cd 命令切换目录，而且还只作用在当下下的  RUN，也就是说每一个 RUN 都是独立进行的。如果想让其他指令在指定的目录下执行，就得靠 WORKDIR。WORKDIR  动作的目录改变是持久的，不用每个指令前都使用一次 WORKDIR。</p>
<h2 id="0x6-COPY"><a href="#0x6-COPY" class="headerlink" title="0x6 COPY"></a>0x6 COPY</h2><p>COPY 将文件从路径<code>&lt;src&gt;</code>复制添加到容器内部路径 <code>&lt;dest&gt;</code></p>
<p><code>&lt;src&gt;</code>必须是想对于源文件夹的一个文件或目录，也可以是一个远程的url，<code>&lt;dest&gt;</code><br> 是目标容器中的绝对路径。<br> 所有的新文件和文件夹都会创建UID 和 GID 。事实上如果<code>&lt;src&gt;</code> 是一个远程文件URL，那么目标文件的权限将会是600。</p>
<h2 id="0x7-ADD"><a href="#0x7-ADD" class="headerlink" title="0x7 ADD"></a>0x7 ADD</h2><p>ADD 将文件从路径  复制添加到容器内部路径<br> 同COPY</p>
<h2 id="0x8-EXPOSE"><a href="#0x8-EXPOSE" class="headerlink" title="0x8 EXPOSE"></a>0x8 EXPOSE</h2><p>EXPOSE 指令指定在docker允许时指定的端口进行转发。</p>
<h2 id="0x9-CMD"><a href="#0x9-CMD" class="headerlink" title="0x9 CMD"></a>0x9 CMD</h2><p>Dockerfile.中只能有一个CMD指令。 如果你指定了多个，那么最后个CMD指令是生效的。<br> CMD指令的主要作用是提供默认的执行容器。这些默认值可以包括可执行文件，也可以省略可执行文件。<br> 当你使用shell或exec格式时， CMD<br> 会自动执行这个命令。</p>

    </div>

    
    
    

      <footer class="post-footer">

        

          <div class="post-nav">
            <div class="post-nav-next post-nav-item">
                <a href="/2019/11/29/php%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96/" rel="next" title="php反序列化">
                  <i class="fa fa-chevron-left"></i> php反序列化
                </a>
            </div>

            <span class="post-nav-divider"></span>

            <div class="post-nav-prev post-nav-item">
                <a href="/2019/12/09/swpuctf-wp/" rel="prev" title="swpuctf_wp">
                  swpuctf_wp <i class="fa fa-chevron-right"></i>
                </a>
            </div>
          </div>
      </footer>
    
  </article>
  
  
  

  </div>


          </div>
          

        </div>
          
  
  <div class="toggle sidebar-toggle">
    <span class="toggle-line toggle-line-first"></span>
    <span class="toggle-line toggle-line-middle"></span>
    <span class="toggle-line toggle-line-last"></span>
  </div>

  <aside class="sidebar">
    <div class="sidebar-inner">

      <ul class="sidebar-nav motion-element">
        <li class="sidebar-nav-toc">
          文章目录
        </li>
        <li class="sidebar-nav-overview">
          站点概览
        </li>
      </ul>

      <!--noindex-->
      <div class="post-toc-wrap sidebar-panel">
          <div class="post-toc motion-element"><ol class="nav"><li class="nav-item nav-level-4"><a class="nav-link" href="#redis"><span class="nav-number">1.</span> <span class="nav-text">redis</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#screen"><span class="nav-number">2.</span> <span class="nav-text">screen</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#时差"><span class="nav-number">3.</span> <span class="nav-text">时差</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#docker-for-windows"><span class="nav-number">4.</span> <span class="nav-text">docker for windows</span></a></li></ol></li></ol></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#0x02-基本指令"><span class="nav-number"></span> <span class="nav-text">0x02 基本指令</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#0x1-容器生成"><span class="nav-number"></span> <span class="nav-text">0x1 容器生成</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#0x2-生成容器时的其他属性"><span class="nav-number"></span> <span class="nav-text">0x2 生成容器时的其他属性</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#端口映射"><span class="nav-number"></span> <span class="nav-text">端口映射</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#环境变量"><span class="nav-number"></span> <span class="nav-text">环境变量</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#0x3-打开-关闭-附加-删除"><span class="nav-number"></span> <span class="nav-text">0x3 打开&#x2F;关闭&#x2F;附加&#x2F;删除</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#0x4-压缩-导出-上传"><span class="nav-number"></span> <span class="nav-text">0x4 压缩&#x2F;导出&#x2F;上传</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#压缩-容器"><span class="nav-number"></span> <span class="nav-text">压缩(容器)</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#导入"><span class="nav-number"></span> <span class="nav-text">导入</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#压缩（镜像）"><span class="nav-number"></span> <span class="nav-text">压缩（镜像）</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#导入-1"><span class="nav-number"></span> <span class="nav-text">导入</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#上传至远程仓库"><span class="nav-number"></span> <span class="nav-text">上传至远程仓库</span></a></li></ol></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#0x3-Dockerfile-编写"><span class="nav-number"></span> <span class="nav-text">0x3 Dockerfile 编写</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#0x1-FROM"><span class="nav-number"></span> <span class="nav-text">0x1 FROM</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#0x2-MAINTAINER"><span class="nav-number"></span> <span class="nav-text">0x2 MAINTAINER</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#0x3-RUN"><span class="nav-number"></span> <span class="nav-text">0x3 RUN</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#0x4-ENV"><span class="nav-number"></span> <span class="nav-text">0x4 ENV</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#0x5-WORKDIR"><span class="nav-number"></span> <span class="nav-text">0x5 WORKDIR</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#0x6-COPY"><span class="nav-number"></span> <span class="nav-text">0x6 COPY</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#0x7-ADD"><span class="nav-number"></span> <span class="nav-text">0x7 ADD</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#0x8-EXPOSE"><span class="nav-number"></span> <span class="nav-text">0x8 EXPOSE</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#0x9-CMD"><span class="nav-number"></span> <span class="nav-text">0x9 CMD</span></a></div>
      </div>
      <!--/noindex-->

      <div class="site-overview-wrap sidebar-panel">
        <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
  <p class="site-author-name" itemprop="name">zhiliya</p>
  <div class="site-description" itemprop="description">emmmm 感觉没啥好说的</div>
</div>
<div class="site-state-wrap motion-element">
  <nav class="site-state">
      <div class="site-state-item site-state-posts">
          <a href="/archives/">
        
          <span class="site-state-item-count">38</span>
          <span class="site-state-item-name">日志</span>
        </a>
      </div>
      <div class="site-state-item site-state-categories">
            <a href="/categories/">
        <span class="site-state-item-count">5</span>
        <span class="site-state-item-name">分类</span></a>
      </div>
      <div class="site-state-item site-state-tags">
            <a href="/tags/">
        <span class="site-state-item-count">15</span>
        <span class="site-state-item-name">标签</span></a>
      </div>
  </nav>
</div>
  <div class="feed-link motion-element">
    <a href="/atom.xml" rel="alternate">
      <i class="fa fa-rss"></i>RSS
    </a>
  </div>



      </div>

    </div>
  </aside>
  <div id="sidebar-dimmer"></div>


      </div>
    </main>

    <footer class="footer">
      <div class="footer-inner">
        

<div class="copyright">
  
  &copy; 
  <span itemprop="copyrightYear">2023</span>
  <span class="with-love">
    <i class="fa fa-user"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">zhiliya</span>
</div>
  <div class="powered-by">由 <a href="https://hexo.io/" class="theme-link" rel="noopener" target="_blank">Hexo</a> 强力驱动 v4.2.0
  </div>
  <span class="post-meta-divider">|</span>
  <div class="theme-info">主题 – <a href="https://muse.theme-next.org/" class="theme-link" rel="noopener" target="_blank">NexT.Muse</a> v7.5.0
  </div>

        












        
      </div>
    </footer>
  </div>

  
  <script src="/lib/anime.min.js"></script>
  <script src="/lib/velocity/velocity.min.js"></script>
  <script src="/lib/velocity/velocity.ui.min.js"></script>

<script src="/js/utils.js"></script>

<script src="/js/motion.js"></script>


<script src="/js/schemes/muse.js"></script>


<script src="/js/next-boot.js"></script>




  
















  

  

</body>
</html>
